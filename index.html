<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Railroad Guerrilla">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Railroad Guerrilla">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="潘曲阳 朱霖淇 刘浩钊">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Railroad Guerrilla</title>
  








<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Railroad Guerrilla</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录竞赛生涯</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Categories
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/12/%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86-minmax%E5%AE%B9%E6%96%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/12/%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86-minmax%E5%AE%B9%E6%96%A5/" itemprop="url">容斥原理+minmax容斥</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-05-12T11:35:46+08:00">
                2021-05-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%83%E4%B9%A0%E9%A2%98%E9%9B%86/" itemprop="url" rel="index">
                    <span itemprop="name">练习题集</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Topcoder-SRM-div1-3-12004-SetAndSet"><a href="#Topcoder-SRM-div1-3-12004-SetAndSet" class="headerlink" title="Topcoder SRM div1-3 12004. SetAndSet"></a><a href="https://vjudge.net/problem/TopCoder-12004" target="_blank" rel="noopener">Topcoder SRM div1-3 12004. SetAndSet</a></h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>将 $n\leq 50$ 个元素（大小 $\leq 1048575$）分为两个非空集合，使得集合内所有数字与的和相等，问有多少种方案。</p>
<h2 id="题解-Dfs-容斥"><a href="#题解-Dfs-容斥" class="headerlink" title="题解:Dfs+容斥"></a>题解:Dfs+容斥</h2><p>容斥的原理</p>
<p>所有位相同方案=至少有0位不同方案-至少有1位不同方案+至少有2位不同方案-…</p>
<p>具体实现通过Dfs实现，Dfs(bit,diff) 表示到第bit位为止有至少diff位不同</p>
<p>为了保证某一位不同，应该将那一位为0的所有数字提前分配到同一个集合内（也就是剩下的数字这一位一定为1），这样无论其它数字是否移动到这个集合，两个集合非空的情况下都能保证这一位一定不同。</p>
<h1 id="【ZJOI2016】小星星"><a href="#【ZJOI2016】小星星" class="headerlink" title="【ZJOI2016】小星星"></a><a href="https://www.luogu.com.cn/problem/P3349" target="_blank" rel="noopener">【ZJOI2016】小星星</a></h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>对于 $n\leq 17$ 个点，有一棵树一张图，要求构造一个数列 $\{a_i\}$ 使得若在树上有边 $(u,v)$，则图中也有边 $(a_u,a_v)$</p>
<h2 id="题解-DP-状态压缩-容斥"><a href="#题解-DP-状态压缩-容斥" class="headerlink" title="题解:DP+状态压缩+容斥"></a>题解:DP+状态压缩+容斥</h2><h3 id="首先考虑在树上进行一个朴素的DP"><a href="#首先考虑在树上进行一个朴素的DP" class="headerlink" title="首先考虑在树上进行一个朴素的DP"></a>首先考虑在树上进行一个朴素的DP</h3><p>$dp[u][a_u][sta] = \sum\limits_{(u,v)\&amp;(a_u,a_v)}dp[v][a_v][sta\oplus 2^{a_v}]$</p>
<p>表示对于边 $(u,v)$，用 $(a_u,a_v)$ 表示，sta用于记录 $\{a_i\}$ 中有哪些点用过了</p>
<p>复杂度 $O(n^23^n)$</p>
<h3 id="考虑sta存在的意义"><a href="#考虑sta存在的意义" class="headerlink" title="考虑sta存在的意义"></a>考虑sta存在的意义</h3><p>sta用于记录已经使用的点，是为了防止两个点映射到序列中的同一个元素上。<br>但实际上为了满足题目的要求，最终的结果必然是一一映射的关系，因此我们实际上不需要这一维来记录状态。那么如果在映射过程中出现了两个点映射到同一个元素的情况该怎么办呢？</p>
<p><strong>容斥</strong></p>
<p>考虑先定义一个二进制状态 $sta$ ，使其成为一个限制状态，第 $i$ 位为1表示可以将点映射到 $i$ 上，$sta$ 表示满足至多使用 $sta$ 中的点的映射的方案数。</p>
<p>那么最终的结果=至多使用 $n$ 个点的方案-至多使用 $n-1$ 个点的方案+至多使用$n - 2$ 个点的方案-…=恰好使用 $n$ 个点的方案</p>
<p>复杂度 $O(n^22^n)$</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><h3 id="Topcoder-SRM-div1-3-12004-SetAndSet-1"><a href="#Topcoder-SRM-div1-3-12004-SetAndSet-1" class="headerlink" title="Topcoder SRM div1-3 12004. SetAndSet"></a>Topcoder SRM div1-3 12004. SetAndSet</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">55</span>, MAXB = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SetAndSet</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> f[MAXN], fa, n;</span><br><span class="line">    li res;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; B[MAXB];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Getf</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> f[x] == x ? x : (f[x] = Getf(f[x]));&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> bit, <span class="keyword">int</span> diff)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(bit &gt; <span class="number">19</span>)&#123;</span><br><span class="line">            <span class="keyword">bool</span> vis[MAXN];</span><br><span class="line">            fill(vis, vis + MAXN, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">            Fore(i, <span class="number">0</span>, n)</span><br><span class="line">                <span class="keyword">if</span>(!vis[fa = Getf(i)])&#123;</span><br><span class="line">                    vis[fa] = <span class="number">1</span>;</span><br><span class="line">                    cnt++;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">if</span>(diff &amp; <span class="number">1</span>) res -= (<span class="number">1L</span>L &lt;&lt; cnt) - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span> res += (<span class="number">1L</span>L &lt;&lt; cnt) - <span class="number">2</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Dfs(bit + <span class="number">1</span>, diff);</span><br><span class="line">            <span class="keyword">if</span>(B[bit].size() == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">int</span> temp[MAXN];</span><br><span class="line">            <span class="built_in">memcpy</span>(temp, f, <span class="keyword">sizeof</span>(f));</span><br><span class="line">            fa = Getf(B[bit][<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> v : B[bit])</span><br><span class="line">                f[Getf(v)] = fa;</span><br><span class="line">            Dfs(bit + <span class="number">1</span>, diff + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">memcpy</span>(f, temp, <span class="keyword">sizeof</span>(f));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">countandset</span> <span class="params">( <span class="built_in">vector</span> &lt; <span class="keyword">int</span> &gt; A )</span>   </span>&#123;</span><br><span class="line">        n = A.size ( )  ;</span><br><span class="line">        res = <span class="number">0</span>;</span><br><span class="line">        Fore(i, <span class="number">0</span>, n) f[i] = i;</span><br><span class="line">        Fore(j, <span class="number">0</span>, n)</span><br><span class="line">            Fore(i, <span class="number">0</span>, <span class="number">20</span>)</span><br><span class="line">                <span class="keyword">if</span>(!(A[j] &gt;&gt; i &amp; <span class="number">1</span>))</span><br><span class="line">                    B[i].EP(j);</span><br><span class="line">        Dfs(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        Fore(i, <span class="number">0</span>, <span class="number">20</span>) B[i].clear();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="【ZJOI2016】-小星星"><a href="#【ZJOI2016】-小星星" class="headerlink" title="【ZJOI2016】 小星星"></a>【ZJOI2016】 小星星</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; EG[MAXN];</span><br><span class="line"><span class="keyword">int</span> able[MAXN], A;</span><br><span class="line"><span class="keyword">bool</span> mp[MAXN][MAXN];</span><br><span class="line">li dp[MAXN][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span></span>&#123;</span><br><span class="line">    Fore(i, <span class="number">0</span>, A)</span><br><span class="line">        dp[u][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> v : EG[u])</span><br><span class="line">        <span class="keyword">if</span>(v != f)Dfs(v, u);</span><br><span class="line">    li sum;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> v : EG[u])</span><br><span class="line">        <span class="keyword">if</span>(v != f)</span><br><span class="line">            Fore(i, <span class="number">0</span>, A)&#123;</span><br><span class="line">                sum = <span class="number">0</span>;</span><br><span class="line">                Fore(j, <span class="number">0</span>, A)</span><br><span class="line">                    <span class="keyword">if</span>(mp[able[i]][able[j]])</span><br><span class="line">                        sum += dp[v][j];</span><br><span class="line">                dp[u][i] *= sum;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n = input();</span><br><span class="line">    <span class="keyword">int</span> m = input(), u, v;</span><br><span class="line">    fore(i, <span class="number">1</span>, m)&#123;</span><br><span class="line">        u = input(); v = input();</span><br><span class="line">        mp[u][v] = mp[v][u] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        u = input();v = input();</span><br><span class="line">        EG[u].EP(v); EG[v].EP(u);</span><br><span class="line">    &#125;</span><br><span class="line">    li res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> maxsta = (<span class="number">1</span> &lt;&lt; n);</span><br><span class="line">    Fore(sta, <span class="number">1</span>, maxsta)&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        li sum = <span class="number">0</span>;</span><br><span class="line">        A = <span class="number">0</span>;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">            <span class="keyword">if</span>((<span class="number">1</span> &lt;&lt; (i - <span class="number">1</span>)) &amp; sta)able[A++] = i;</span><br><span class="line">            <span class="keyword">else</span> cnt++;</span><br><span class="line">        Dfs(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        Fore(i, <span class="number">0</span>, A)</span><br><span class="line">            sum += dp[<span class="number">1</span>][i];</span><br><span class="line">        <span class="keyword">if</span>(cnt &amp; <span class="number">1</span>) res -= sum;</span><br><span class="line">        <span class="keyword">else</span> res += sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/04/CF-1513/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/04/CF-1513/" itemprop="url">CF-1513</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-05-04T15:00:42+08:00">
                2021-05-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="A-Array-and-Peaks"><a href="#A-Array-and-Peaks" class="headerlink" title="A.Array and Peaks"></a><a href="https://codeforces.com/contest/1513/problem/A" target="_blank" rel="noopener">A.Array and Peaks</a></h1><h2 id="题解-贪心"><a href="#题解-贪心" class="headerlink" title="题解:贪心"></a>题解:贪心</h2><p>对于长度为 $n$ 的序列，最多有 $\lfloor\frac{n-1}{2}\rfloor$ 个极大值点，贪心构造即可</p>
<h1 id="B-AND-Sequence"><a href="#B-AND-Sequence" class="headerlink" title="B.AND Sequence"></a><a href="https://codeforces.com/contest/1513/problem/B" target="_blank" rel="noopener">B.AND Sequence</a></h1><h2 id="题解-数学"><a href="#题解-数学" class="headerlink" title="题解:数学"></a>题解:数学</h2><p>求出整个序列的与值 $v$，满足条件的序列必然是以 $v$ 开头和结尾的，统计序列中 $v$ 的个数 $c$</p>
<p>答案为 $A_c^2\times A_{n-2}^{n-2}$</p>
<h1 id="C-Add-One"><a href="#C-Add-One" class="headerlink" title="C.Add One"></a><a href="https://codeforces.com/contest/1513/problem/C" target="_blank" rel="noopener">C.Add One</a></h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>对于一个数字，定义一次操作为将该数字的每一位加一，问 $1\leq m\leq 2\cdot 10^5$ 次操作后， $1\leq n\leq 10^9$ 为多少位数字</p>
<h2 id="题解-动态规划"><a href="#题解-动态规划" class="headerlink" title="题解:动态规划"></a>题解:动态规划</h2><p>因为对于每一位数字是独立的，所以我们考虑每一位数字单独处理。</p>
<p>因为每一位都小于10，因此我们考虑将 10 操作 $m$ 次后的位数。<br>那么对于每一位数字而言，我们先将其操作到 $10$ ，再将剩余次数一次性操作完。</p>
<p>接下来考虑 $10$ 操作 $m$ 次后的位数。<br>定义 $dp[m][k]$ 为10操作 $m$ 次后含有的 $k$ 的个数，那么10操作 $m$ 次后的位数为 $\sum_k dp[m][k]$</p>
<p>转移方程</p>
<script type="math/tex; mode=display">dp[m][k] = 
\begin{cases}
dp[m][(k + 9)\mod 10] & k\neq1\\
dp[m][0] + dp[m][9] & k=1
\end{cases}</script><h1 id="D-GCD-and-MST"><a href="#D-GCD-and-MST" class="headerlink" title="D.GCD and MST"></a><a href="https://codeforces.com/contest/1513/problem/D" target="_blank" rel="noopener">D.GCD and MST</a></h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>对于一个数列 $\{a_i\}$ ，在数字之间连边。</p>
<ul>
<li>若$gcd(a_i,a_{i+1},a_{i+2},…,a_j)=min(a_i,a_{i+1},a_{i+2},…,a_j)$ ，则在 $i,j$ 间连一条权为 $min(a_i,a_{i+1},…,a_j)$ 的边</li>
<li>若 $i+1=j$ ，则在 $i,j$ 间连一条权为 $p$ 的边</li>
</ul>
<p>问最终生成图的最小生成树权值多大</p>
<h2 id="题解-贪心-1"><a href="#题解-贪心-1" class="headerlink" title="题解:贪心"></a>题解:贪心</h2><p>若 $min(a_k,…,a_i,…,a_j) = gcd(a_k,…,a_i,…,a_j)=a_i$，则 $a_k,…,a_j$ 之间所有点必然能够以 $a_i$ 大小的权连通</p>
<p>故我们从小到大枚举 $a_i&lt;p$ ，让它分别向左向右拓展（若有 $gcd(a_j,…,a_i,…,a_k)=a_i$，则有 $gcd(a_k,…,a_i)=gcd(a_i,…,a_k)=a_i$，最小值同理），用并查集维护点与点之间的联通关系。当维护到一个已经与其他点联通的点时，停止拓展（因为已经有更小的 $a_i$ 将即将拓展的点覆盖了，当前点不可能有更优覆盖）。</p>
<p>最后未与其它点联通的点用 $p$ 边连接。</p>
<h1 id="E-Cost-Equilibrium"><a href="#E-Cost-Equilibrium" class="headerlink" title="E.Cost Equilibrium"></a><a href="https://codeforces.com/contest/1513/problem/E" target="_blank" rel="noopener">E.Cost Equilibrium</a></h1><h1 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h1><p>给一个序列 $\{a_i\}$，每个点可以被当作源点或汇点（指定后不能改变类型），由源点 $u$ 分配 $k$ 至汇点 $v$ ，代价为 $|u-v|\cdot k$ ，分配后 $a_u\to a_u-k,a_v\to a_v+k$</p>
<p>现在要使得分配后得到的新序列的元素均相等，问有多少种构成序列 $\{a_i\}$ 的方式是的分配的代价唯一。</p>
<h1 id="题解-数学-1"><a href="#题解-数学-1" class="headerlink" title="题解:数学"></a>题解:数学</h1><p>令 $aver=\frac{\sum a_i}{n}$，序列中小于 $aver$ 的数字个数为 $a$，等于 $aver$ 的数字个数为 $b$ ，大于 $aver$  的数字个数为 $c$ 。</p>
<ul>
<li><p>相同的数字视为相同，令 $a_i$ 的个数为 $c_i$ ，则结果应当除以 $C=\prod{c_i!}$</p>
</li>
<li><p>若 $a=1$ 或者 $c = 1$ ， 则无论怎么排序，所有分配的方向唯一，结果为 $A_n^n\cdot\frac{1}{C}$</p>
</li>
<li>否则源点和汇点不能够相互交错，源点之间的顺序无关，汇点之间的顺序无关，等于 $aver$ 的数字的位置无关，故结果为 $2\cdot A_a^a\cdot A_b^b\cdot A_n^b\cdot\frac{1}{C}$</li>
</ul>
<h1 id="F-Swapping-Problem"><a href="#F-Swapping-Problem" class="headerlink" title="F.Swapping Problem"></a><a href="https://codeforces.com/contest/1513/problem/F" target="_blank" rel="noopener">F.Swapping Problem</a></h1><h2 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h2><p>给两个数列 $\{a_i\}$ 和 $\{b_i\}$ ，现在可以交换一对 $\{b_i\}$ 中的元素，使得$\sum\limits_i|a_i-b_i|$ 最小，问最小值为多少</p>
<h2 id="题解-贪心-2"><a href="#题解-贪心-2" class="headerlink" title="题解:贪心"></a>题解:贪心</h2><h3 id="建议用图解法对照题解进行理解"><a href="#建议用图解法对照题解进行理解" class="headerlink" title="建议用图解法对照题解进行理解"></a>建议用图解法对照题解进行理解</h3><p>仅考虑对于 $a_i&lt;b_i$ 的情况（反之则对称处理即可）</p>
<p>要使得代价变小，则必然有与 $b_i$ 交换的数字 $b_j$ 满足 $a_j&gt;b_j$ 且 $a_i<a_j，b_i>b_j$</a_j，b_i></p>
<p>此处仅考虑 $j$ 满足 $b_j\leq a_i$ 的情况（对于 $b_j &gt; a_j$ 的情况，可以在 $a_i&gt;b_i$ 的情况中用相同的办法处理）</p>
<p>此时我们希望 $a_j$ 越大越好，这样才能够使得减少的代价尽量大。</p>
<p>故我们对于每一个 $b_j$ 记录一个最大的 $a_k$ 满足 $b_k\leq b_j$ （因为满足该条件的 $k$ 必然满足 $b_k\leq a_i$)</p>
<p>则对于该情况，最大的减少代价为 $2\cdot(min(a_k,b_i)-a_i)$</p>
<p><a href="https://codeforces.com/contest/1513/my" target="_blank" rel="noopener">Code</a></p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/20/ICPC-%E4%B8%8A%E6%B5%B7-2019/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/20/ICPC-%E4%B8%8A%E6%B5%B7-2019/" itemprop="url">ICPC-上海-2019</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-04-20T13:59:24+08:00">
                2021-04-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="B-Mine-Sweeper-II"><a href="#B-Mine-Sweeper-II" class="headerlink" title="B.Mine Sweeper II"></a><a href="https://codeforces.com/gym/102900/problem/B" target="_blank" rel="noopener">B.Mine Sweeper II</a></h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>$n\times m$ 的方格中有若干个地雷，每一个非地雷格子上有一个数字，表示以它为中心的九个方格内地雷的数量。现在给定两个 $n\times m$ 的方格 A、B，一次操作可以将一个格子翻转，要求在 $\frac{n\cdot m}{2}$ 次操作内将B的所有数字之和变为和A内的一致。</p>
<h2 id="题解-对称转化"><a href="#题解-对称转化" class="headerlink" title="题解:对称转化"></a>题解:对称转化</h2><p>我们可以认为任意两个相邻（包括对角相邻）的格子之间有一条边，当格子的类型不同时，这条边权值为1，否则为0。原图里的权值就是边的权值之和。</p>
<p>当我们将图里的点权转化为边权之后，权值就与每个格子是哪一类点无关，只与这些点是不是同一类点有关。</p>
<p>因此贪心求解，优先将B转化为A，如果操作数超了，则将B转化为A的反。</p>
<h1 id="Sum-of-Log"><a href="#Sum-of-Log" class="headerlink" title="Sum of Log"></a><a href="https://codeforces.com/gym/102900/problem/C" target="_blank" rel="noopener">Sum of Log</a></h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>对 $0\leq X,Y\leq 10^9$ 求</p>
<script type="math/tex; mode=display">\sum\limits_{i=0}^{X}\sum\limits_{j=[i=0]}^{Y}[i\&j=0]\lfloor log_2(i+j)+1\rfloor\mod 10^9+7</script><h2 id="题解-数位DP"><a href="#题解-数位DP" class="headerlink" title="题解:数位DP"></a>题解:数位DP</h2><p>状态设置为  $dp[n][lim_x][lim_y]$ 表示当前到第 $n$ 位，$x$ 是否达到上限， $y$ 是否达到上限。</p>
<p>对于 $lim_x=0$ 或 $lim_y = 0$，其取值范围有 $X,Y$ 的第 $n$ 位决定。<br>否则可以随遇取值01。</p>
<p>具体看代码</p>
<h1 id="D-Walker"><a href="#D-Walker" class="headerlink" title="D.Walker"></a><a href="https://codeforces.com/gym/102900/problem/D" target="_blank" rel="noopener">D.Walker</a></h1><h2 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h2><p>在长度为 $n$ 的区间上有两个点，给定其初始位置和速度，每个点会将经过的区间染色，且可以在任意时刻转向。问最少需要多少时间才能将整个区间染色。</p>
<h2 id="题解-三分"><a href="#题解-三分" class="headerlink" title="题解:三分"></a>题解:三分</h2><p>三分区间的分割点 $P$ ，左边的点染色 $[0,P]$，右边的点染色 $[P,n]$。</p>
<h1 id="E-The-Journey-of-Geor-Autumn"><a href="#E-The-Journey-of-Geor-Autumn" class="headerlink" title="E.The Journey of Geor Autumn"></a><a href="https://codeforces.com/gym/102900/problem/E" target="_blank" rel="noopener">E.The Journey of Geor Autumn</a></h1><h2 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h2><p>对于 $1\leq n \leq 10^7, 1\leq k \leq 10^7$，计算有多少序列 $\{a_i\}$ 满足对于任意 $k<i\leq n$，$a_i>min(a_{i-k},…,a_{i-1})$，且$1～n$ 均出现且仅出现一次。</i\leq></p>
<h2 id="题解-DP"><a href="#题解-DP" class="headerlink" title="题解:DP"></a>题解:DP</h2><p>对于这类问题，我们一般考虑将新的数字插入原本的合法序列中。</p>
<p>首先考虑将一个新的最大的数字 $n$ 插入 $n-1$  的合法序列中，发现无法对插入位置进行限制。</p>
<p>那么反过来，将一个最小的数字插入原本的序列的第 $i\in[1,k]$ 位。</p>
<p>考虑插入新数字对序列造成的影响。</p>
<p>对于第 $j\in[1,i-1]$ 位数字而言没有任何影响，对于第 $j\in[i + 1,n]$ 位数字，它们与 $a_i$ 可以构成一个长度为 $n-i+1$ 的合法序列。</p>
<p>因此我们可以将原本的 $n - 1$ 的序列分为两段，前 $i-1$ 位随意取，后 $n-i+1$ 位为长度为 $n - i$ 的合法序列前面插入最小数字。</p>
<p>$dp[n] = \sum\limits_{i=1}^{min(n, k)}C_{n-1}^i\cdot A_i^i\cdot dp[n-i]$</p>
<p>显然 $O(nk)$ 复杂度是不行的，我们对方程进行化简</p>
<script type="math/tex; mode=display">dp[n]=\sum\limits_{i=1}^{min(n,k)}\frac{n-1!}{i!n-i-1!}\cdot i!\cdot dp[n - i - 1]\\
=n-1!\sum\limits_{i=1}^{min(n,k)}\frac{dp[n - i - 1]}{n-i-1!}</script><p>存一个 $\frac{dp[i]}{i!}$ 的前缀和就能 $O(1)$ 转移</p>
<p>最终复杂度 $O(n)$</p>
<h1 id="G-Fibonacci"><a href="#G-Fibonacci" class="headerlink" title="G.Fibonacci"></a><a href="https://codeforces.com/gym/102900/problem/G" target="_blank" rel="noopener">G.Fibonacci</a></h1><h2 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h2><p>对长度为 $n\leq 10^9$ 的 Fibonacci 数列 $\{f_i\}$ 计算</p>
<p>$\sum_{i=1}^n\sum_{j=i+1}^ng(f_i,f_j)$</p>
<p>其中 $g(x,y)$ 在 $x\cdot y$ 为偶数时为1， $x\cdot y$ 为奇数时为0</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>数列转化为01序列以表示奇偶 $1,1,0,1,1,0,…$</p>
<p>然后随便算算就行了</p>
<h1 id="H-Rive-Arrangement"><a href="#H-Rive-Arrangement" class="headerlink" title="H.Rive Arrangement"></a><a href="https://codeforces.com/gym/102900/problem/H" target="_blank" rel="noopener">H.Rive Arrangement</a></h1><h2 id="题意-5"><a href="#题意-5" class="headerlink" title="题意"></a>题意</h2><p>$1\leq k\leq min(1000,n)$ 碗饭不等距分布在被等分为 $1\leq n\leq 10^9$ 段的圆周上。有 $k$ 个人坐在桌子的四周。每次操作可以顺时针或逆时针地转动桌子 $\frac{2\pi}{n}$ 的弧度，当一碗饭到一个人面前时，他可以选择拿走或不拿。问至少要多少次操作才可以让每个人拿到一碗饭。</p>
<h2 id="题解-贪心"><a href="#题解-贪心" class="headerlink" title="题解:贪心"></a>题解:贪心</h2><p>首先 $O(k)$ 枚举第一个人吃第 $i$ 碗饭，那么第 $j$ 个人肯定是吃顺序的第 $i + j - 1$ 碗饭。</p>
<p>然后考虑转桌子的问题。假设一个人需要顺时针转 $a$ 次桌子能吃到饭，那么逆时针他需要转动 $n-a$ 次桌子才能吃到饭。显然我们只需要知道顺时针转动吃饭的人的最大转动次数 $a$ 和逆时针转动吃饭的人的最大次数 $b$ 就能计算出当前情况下最少的转动次数为 $a+b+min(a,b)$。</p>
<p>因此我们按照每个人的顺时针转动次数从小到大排序，枚举第 $i$ 个人为最大顺时针转动的人，那么第 $i+1$ 个人为最大逆时针转动的人，当前的结果即为 $a_i+n-a_{i+1}+min(a_i,n-a_{i+1})$。用每一种情况更新答案即可，最终复杂度 $O(n^2logn)$</p>
<h1 id="I-Sky-Garden"><a href="#I-Sky-Garden" class="headerlink" title="I.Sky Garden"></a><a href="https://codeforces.com/gym/102900/problem/I" target="_blank" rel="noopener">I.Sky Garden</a></h1><h2 id="题意-6"><a href="#题意-6" class="headerlink" title="题意"></a>题意</h2><p>对于 $n\leq 500$ 个半径分别为 $r_i=i$ 的同心圆，作 $m\leq 500$ 条过直径的直线，将其均分为 $2m$ 等份。对所有交点，求其两两相互到达的最短路径之和。</p>
<h2 id="题解-分类讨论"><a href="#题解-分类讨论" class="headerlink" title="题解:分类讨论"></a>题解:分类讨论</h2><p>首先对于同一层圆上的焦点，两个点之间有两种路径可以走，一种是走到圆心再走出来，另一种是直接走两点之间的弧（其余情况均不可能更优），那么走弧的情况应该满足对于两点间的圆心角 $\phi=k\cdot\frac{\pi}{m}$ 有</p>
<p>$\phi\cdot r\leq 2*r\\k\leq\frac{2m}{\pi}\\\to k=\lfloor\frac{2m}{\pi}\rfloor$</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/13/CF-1503/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/13/CF-1503/" itemprop="url">CF_1503</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-04-13T14:15:17+08:00">
                2021-04-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="A-Deja-Vu"><a href="#A-Deja-Vu" class="headerlink" title="A.Déjà Vu"></a>A.Déjà Vu</h1><p>显然只有全 $a$ 字符串才不能被构造，否则找一个非 $a$ 字符，在它的对称位置上插入 $a$。</p>
<h1 id="B-Flip-the-Bits"><a href="#B-Flip-the-Bits" class="headerlink" title="B.Flip the Bits"></a>B.Flip the Bits</h1><p>从前往后翻转，以前缀中01数量相等的字符串为分割点将字符串分割为许多段。分开讨论每一段能否翻转为目标即可。</p>
<h1 id="C-Balance-the-Bits"><a href="#C-Balance-the-Bits" class="headerlink" title="C.Balance the Bits"></a>C.Balance the Bits</h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>给一个长度为 $n\leq 2\times 10^5$ 01序列 $\{s_i\}$ 要求构造两个长度为 $n$ 括号序列 $\{a_i\}, \{b_i\}$，使得这两个括号序列满足</p>
<blockquote>
<p>$s_i=1\to a_i=b_i$</p>
<p>$s_i=0\to a_i \neq b_i$</p>
</blockquote>
<p>且两个括号序列合法</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>考虑将括号序列转化为 $+1 -1$ 序列，显然有合法序列任意前缀和都不小于0且最终的和等于0。</p>
<p>对于 $s_i=1$ ，两个序列的前缀和同加同减<br>对于 $s_i=0$ ，一个序列+1，一个序列-1</p>
<p>如果最终两个序列都合法，那么两个序列最终的和均为0，所以我们显然要使得两个序列的前缀和尽量接近。对于 $s_i = 1$，两个序列的前缀和差值不会发生变化，但是 $s_i=0$，两个序列的前缀和会变化1，那么此时我们只需要两个序列分别交替进行+1-1操作即可。</p>
<p>为了保证操作始终合法，对于$s_i=1$的操作，我们要让前缀和的平均值 $\frac{A+B}{2}$ 不低于1。为了让最终的序列的合法化尽量简单，应有 $\frac{A+B}{2}\leq2$。贪心构造即可。</p>
<h1 id="D-3-Coloring"><a href="#D-3-Coloring" class="headerlink" title="D.3-Coloring"></a>D.3-Coloring</h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>交互题，给一个 $n\times n$ 的格子填色，有三种颜色可选，每次由交互方决定填充时不能填充哪种颜色，由我们决定填充哪种颜色，填到哪个格子，要求相邻格子不同色。</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>首先贪心，将格子分为 $A(x_i+y_i=1\mod2)$ 和 $B(x_i+y_i=0\mod 2)$ 两类，每次必定能够填充颜色1或者2，能填充1时均填到A中，反之则填到B中。当某一类的格子被填满后，遇到无法仅用1、2填充剩余格子时，选择填充颜色3到剩余格子中。</p>
<h1 id="E-Travelling-Salesman-Problem"><a href="#E-Travelling-Salesman-Problem" class="headerlink" title="E. Travelling Salesman Problem"></a>E. Travelling Salesman Problem</h1><h2 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h2><p>有 $n\leq 10^5$ 个城市，现在要从1号城市出发，每个城市都经过且仅经过一次。<br>对于每个城市有两个值 $a_i,c_i$，从 $i$ 城市到 $j$ 城市的代价为 $max(c_i, a_j-a_i)$。</p>
<p>问最小代价。</p>
<h2 id="题解：最短路-贪心"><a href="#题解：最短路-贪心" class="headerlink" title="题解：最短路/贪心"></a>题解：最短路/贪心</h2><p>首先出发的点不重要，因为是一个循环，每个点都可以看作起点。</p>
<p>其次对于 $a_j\geq a_i$，代价恒为 $c_i$ ，因此我们可以将所有点按照 $a_i$ 从大到小排序，当我们从 $a_i$ 更大的点往下走是，代价一定最小，为 $c_i$。</p>
<p>那么我们需要考虑的问题是从 $a_i$ 最小的点走到 $a_i$ 最大的点最小代价为多少？</p>
<h3 id="最短路"><a href="#最短路" class="headerlink" title="最短路"></a>最短路</h3><p>假设当前 $a_i$ 是按照从小到大排列的，那么 $n$ 点的值最大，它为终点。</p>
<p>如果考虑类似最短路的做法，我们提前将 $c_i$ 累加，这样走到 $n$ 点后我们无需考虑剩余没有走的点，因为它们产生的额外代价为 $0$ 。</p>
<p>1、当 $a_j\leq a_i$ 时，代价不一定比 $c_i$ 更大，因此从 $i\to j$ 不一定会产生额外代价。那么贪心地讲，对于所有满足 $a_j-a_i\leq c_i$ 的 $j$ ，我们只需要连一条长度为 $0$ 的边到最大的 $j$，其余满足条件的 $j$ 都不会更优 。</p>
<p>2、当会产生额外代价时，我们希望这个额外代价尽量小，因为此时产生的是“额外代价”，因此我们连一条边到最小的满足 $a_j-a_i\geq c_i$ 的 $j$ ，长度为 $a_j-a_i-c_i$。</p>
<p>跑最短路即可。</p>
<h3 id="贪心"><a href="#贪心" class="headerlink" title="贪心"></a>贪心</h3><p>同样假设 $a_i$ 已经排序。</p>
<p>在最短路做法中，分别考虑两类边的目的：第一类边是为了以最小的代价增加所在点的 $a_i$ 值，什么时候 $a_i$ 值增加有可能不是最优解呢？ $a_i$ 增加而 $a_i+c_i$ 不增加时。第二类边实际上可以看作以最小的代价跑到 $n$ 点，当我们需要跑第二类边时，实际上是额外代价无法避免的时候，此时我们希望通过尽量增大 $a_i+c_i$ 值以减少额外代价。</p>
<p>综上，实际上我们是希望路径上的 $a_i+c_i$ 值最大。那么据此我们可以遍历 $1$ 到 $n$ ，对于点 $i$ ，我们增加代价为 $max(a_i-max_{j&lt;i}(a_j+c_j), 0)$。</p>
<p>算法正确性：当 $a_i-max_{j<i}(a_j+b_j)>0$ 时，必然有 $a_i+c_i&gt;a_j+c_j$ ，此时 $max_{j\leq i} (a_j+b_j)$ 的点必定为 $i$ ，可以视为最大值点更新。由于上述性质，最大值点的更新路径唯一，其余无法更新最大值的点可以视为额外代价为0。</i}(a_j+b_j)></p>
<p>最终解为 $\sum c_i+\sum_{i=1}^nmax(a_i-max_{j&lt;i}(a_j+c_j),0)$</p>
<h1 id="F-Flip-the-Cards"><a href="#F-Flip-the-Cards" class="headerlink" title="F.Flip the Cards"></a>F.Flip the Cards</h1><h2 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h2><p>有 $n\leq 2\cdot 10^5$ 张卡片，每张卡片正反面有两个数字，$1-2n$ 的所有数字出现且仅出现一次，将正面的数字记为 $a_i$ ，反面记为 $b_i$。现在能翻转并重新排列所有卡片，问最少翻转多少次能够使得重新排列后的卡片满足</p>
<p>$a_1<a_2<...<a_n$ $b_1>b_2&gt;…&gt;b_n$</a_2<...<a_n$></p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2>
          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/13/ICPC-%E5%8D%97%E4%BA%AC-2018/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/13/ICPC-%E5%8D%97%E4%BA%AC-2018/" itemprop="url">ICPC-南京-2018</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-03-13T08:14:53+08:00">
                2021-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ICPC/" itemprop="url" rel="index">
                    <span itemprop="name">ICPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="A-Adrien-and-Austin"><a href="#A-Adrien-and-Austin" class="headerlink" title="A.Adrien and Austin"></a>A.Adrien and Austin</h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>$N$ 个石头，标号从1到 $N$ 。每次可以选择不超过 $K$ 个连续标号的石头移除，取走最后一颗的人胜。</p>
<h2 id="题解：博弈"><a href="#题解：博弈" class="headerlink" title="题解：博弈"></a>题解：博弈</h2><p>特判 $N = 0$ 和 $K = 1$  的情况，其余情况先手可以通过取中间的石头使得剩余石头被分为相同的两端，后手取啥先手就取啥，先手必胜。</p>
<h1 id="B-Tournament"><a href="#B-Tournament" class="headerlink" title="B.Tournament"></a>B.Tournament</h1><h1 id="C-Cherry-and-Chocolate"><a href="#C-Cherry-and-Chocolate" class="headerlink" title="C.Cherry and Chocolate"></a>C.Cherry and Chocolate</h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>给一颗 $n\in[3,10^5]$ 个点的树，A取一个点标记为粉色，B取一个点标记为棕色，A再取一个点标记为粉色。记从棕色出发，需要经过粉色的点才能到达的点的个数为最终分数。A希望使分数最大，B希望使分数最小，问最大分数为多少？</p>
<h2 id="题解：树的重心"><a href="#题解：树的重心" class="headerlink" title="题解：树的重心"></a>题解：树的重心</h2><p>记 A 选择的第一个点为 $a$ ， B 选择的点为 $b$ ， A 选择的第二个点为 $c$</p>
<p>那么对于一个确定的点 $a$ ， $b$ 必然选择以 $a$ 为根时树 $tree_a=<V,E>$ 所有子树 $subtree_x=<V',E'>\in tree_a$(以 $x$ 为 $subtree_x$ 的重心) 中某一颗子树的重心，这样才能使得 $c$ 所限制的点尽量少 ， 而 $c$ 也必然选择 $subtree_x$ 的重儿子。每次处理出所有 $subtree_x$ 中得到结果最大的子树，即为 $subtree_b$ 则我们得到了对于 $a$ 的最优解 $(a,b,c)$。</V',E'></V,E></p>
<p>此时我们换根到 $a’$ ，若 $a’\in tree-subtree_b$ ，也就是选择 $subtree_b$ 以外的点，那么 $b$ 保持不变，结果必不能更优，因此仅能在 $subtree_b$ 内选择 $a’$ 。</p>
<p>每次可供选择的 $a$ 点的范围都是一个联通的子树，我们选择树的重心，就能使选择范围进一步缩小，最终选择的 $a$ 点的总数目不超过 $logn$ 个，每次在给定 $a$ 点的情况下选择最优解的复杂度为 $O(n)$ ，因此最终复杂度为 $o(nlogn)$</p>
<h1 id="D-Country-Meow"><a href="#D-Country-Meow" class="headerlink" title="D.Country Meow"></a>D.Country Meow</h1><h2 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h2><p>三维空间内给 $n\leq 100$ 个点 ， 找一个点使得它到所有点的中距离最远的点的距离最小。</p>
<h2 id="题解：最小球覆盖"><a href="#题解：最小球覆盖" class="headerlink" title="题解：最小球覆盖"></a>题解：最小球覆盖</h2><p>套板子即可，复杂度 $O(n^3)$。</p>
<p>模拟退火学习失败。</p>
<h1 id="E-Eva-and-Euro-coins"><a href="#E-Eva-and-Euro-coins" class="headerlink" title="E.Eva and Euro coins"></a>E.Eva and Euro coins</h1><h2 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h2><p>有 $n \leq 10^6$ 个硬币，顺序排列，给定它们的初始状态及目标状态。</p>
<p>每次可以选择 $k$ 个连续的硬币翻面，问能否在有限次翻面的情况下达到目标状态。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>从左到右贪心翻转即可。</p>
<h1 id="F-Frank"><a href="#F-Frank" class="headerlink" title="F.Frank"></a>F.Frank</h1><h1 id="G-Pyramid"><a href="#G-Pyramid" class="headerlink" title="G.Pyramid"></a>G.Pyramid</h1><h1 id="H-Huge-Discount"><a href="#H-Huge-Discount" class="headerlink" title="H.Huge Discount"></a>H.Huge Discount</h1><h1 id="I-Magic-Potion"><a href="#I-Magic-Potion" class="headerlink" title="I.Magic Potion"></a>I.Magic Potion</h1><h2 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h2><p>有 $n$ 个英雄，$m$ 个怪兽，$k$ 瓶药水。不同的英雄能够杀死的怪兽不同，每个英雄都能杀死能够杀死的怪兽中的一个，如果给他一瓶药水，能够多杀一个，但每个英雄只能喝一瓶药水。</p>
<p>问最多能够杀死多少怪兽。</p>
<h2 id="题解：网络流"><a href="#题解：网络流" class="headerlink" title="题解：网络流"></a>题解：网络流</h2><p>分两个源点，分别连向每一个英雄，每个英雄连向其对应的怪兽。第一个源点的流量限制为 $n$ ，第二个限制为 $k$ ，每个源点与单个英雄间流量限制为1。</p>
<h1 id="J-Prime-Game"><a href="#J-Prime-Game" class="headerlink" title="J.Prime Game"></a>J.Prime Game</h1><h2 id="题意-5"><a href="#题意-5" class="headerlink" title="题意"></a>题意</h2><p>有 $n$ 个数，定义 $mul(l, r) = \prod$</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/14/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/14/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96/" itemprop="url">斜率优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-14T17:45:41+08:00">
                2021-02-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%83%E4%B9%A0%E9%A2%98%E9%9B%86/" itemprop="url" rel="index">
                    <span itemprop="name">练习题集</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ZJOI-2007-仓库建设"><a href="#ZJOI-2007-仓库建设" class="headerlink" title="ZJOI 2007 仓库建设"></a><a href="https://www.luogu.com.cn/problem/P2120" target="_blank" rel="noopener">ZJOI 2007 仓库建设</a></h1><h2 id="题意自理"><a href="#题意自理" class="headerlink" title="题意自理"></a>题意自理</h2><h2 id="题解：斜率优化"><a href="#题解：斜率优化" class="headerlink" title="题解：斜率优化"></a>题解：斜率优化</h2><p>设 $s_i$ 为 $p_i\cdot x_i$ 的前缀和， $cnt_i$ 为 $p_i$ 的前缀和 ， $f_i$ 为在 $i$ 点建仓的最小代价，其余均为题目中的含义。</p>
<p>转移方程 $i\to j$ : $f_j = f_i + s_i - s_j + (cnt_j-cnt_i)\cdot d_j$</p>
<p>对于 $i\leq j\leq k$ ，当前要在 $k$ 点建厂，假设从 $j$ 点转移过来比 $i$ 点转移更优，则<br>$f_i-s_k+s_i+(cnt_k-cnt_i)\cdot d_k + c_k &gt; f_j-s_k+s_j+(cnt_k-cnt_j)\cdot d_k + c_k$<br>整理得到 $\frac{f_i-f_j+s_i-s_j}{cnt_i-cnt_j}&gt;x_k$</p>
<p>以 $ (cnt_i, f_i+s_i)$ 为坐标维护一个上凸包转移即可</p>
<h1 id="HDU-3507-Print-Article"><a href="#HDU-3507-Print-Article" class="headerlink" title="HDU 3507 Print Article"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=3507" target="_blank" rel="noopener">HDU 3507 Print Article</a></h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>给定一个数列 $\{C_i\}$ 和一个数字 $M$，将其分为若干段，使得 $\sum((\sum_iC_i^2)+M)$ 最小</p>
<h2 id="题解：斜率优化-1"><a href="#题解：斜率优化-1" class="headerlink" title="题解：斜率优化"></a>题解：斜率优化</h2><p>$f_i$ 为规划到第 $i$ 个数字为止的最小花费，$s_i$ 为前缀和</p>
<p>从第 $i$ 个数字转移到第 $j$ 个数字有 $f_j = f_i + (s_j - s_i)^2+M$</p>
<p>则最小花费为 $f_j = \min_{i&lt;j}(f_i+(s_j - s_i)^2+M)$</p>
<p>令 $i&lt;j&lt;k$ ，若此时要转移到 $k$ 点，$j$ 比 $i$ 更优，则有</p>
<p>$f_i+(s_k-s_i)^2+M&lt;f_j+(s_k-s_j)^2+M$</p>
<p>整理得到 $\frac{(f_i+s_i^2)-(f_j+s_j^2)}{2(s_i-s_j)}&lt;s_k$</p>
<p>由于 $s_i$ 单增，因此我们维护一个下凸包，以 $s_i$为横坐标， $f_i+s_i^2$ 为纵坐标，每次找到那个最优决策点即可</p>
<h1 id="NOI-2016-国王饮水记"><a href="#NOI-2016-国王饮水记" class="headerlink" title="NOI 2016 国王饮水记"></a><a href="https://uoj.ac/problem/223" target="_blank" rel="noopener">NOI 2016 国王饮水记</a></h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>有 $n\leq 8000$ 个水桶，存水量互不相同，每次可以选若干个水桶，将其水量均分，问在 $k\leq 10^9$ 次操作之后，第一个桶里最多有多少水，结果保留 $p\leq 3000$ 位小数。</p>
<h2 id="题解：贪心-动态规划-斜率优化"><a href="#题解：贪心-动态规划-斜率优化" class="headerlink" title="题解：贪心+动态规划+斜率优化"></a>题解：贪心+动态规划+斜率优化</h2><hr>
<p>① 水位低于第一个桶里的水的桶都没用。</p>
<blockquote>
<p>显然</p>
</blockquote>
<hr>
<p>②每次与第一个水桶均分的水位是单调递增的。</p>
<blockquote>
<p>首先举个极端的例子感性理解一下：1 2 5，如果1和5先混2就没作用了</p>
<p>然后理性证明，$s_i$ 为第 $i$ 次混合的水位之和， $c_i$ 为第 $i$ 次混合的水桶数<br>现在有 $s_1&lt;s_2&lt;s_3$ ， $s_1$ 为第一桶水的水位<br>从小到大混合结果为 $\frac{\frac{s_1+s_2}{1+c_2}+s_3}{1+c_3}$<br>从大到小混合结果为 $\frac{\frac{s_1+s_3}{1+c_3}+s_2}{1+c_2}$<br>比较一下就会发现从小到大混合更优</p>
</blockquote>
<hr>
<p>通过这两个性质可以得到 $O(n^2kp)$ 的解法，没错这个高精度小数复杂度非常恐怖</p>
<hr>
<p>③最终选择的结果除第一个桶之外，必然为连续到末尾的一段</p>
<blockquote>
<p>如果当中存在某一个桶不选的话，那么这个桶左边的决策整体右移一格必然更优</p>
</blockquote>
<hr>
<p>根据这个性质我们写一下转移方程<br>$f_{i,j}$ 表示以第 $i$ 个点作为第 $j$ 个决策的终点时的最优结果<br>则 $f_{i,k}=max_{j&lt;i}\frac{f_{j,k-1}+s_i-s_j}{i - j + 1}$ ， 其中 $s_i$ 为前缀和<br>以 $j$ 作为横坐标 ， $-f_{j,k-1}+s_j$ 作为纵坐标，这个决策便有了单调性，维护一个下凸包即可将复杂度优化到 $O(nkp)$</p>
<blockquote>
<p>关于这个单调性成立的原因：<br>注意到上式中的格式并不工整，但我们在决策时以 $(i+1,s_i)$ 作为决策点的坐标，做决策相当于是过这个决策点作凸包切线，当我们维护一个凸包时，显然切线唯一（切点就不知道了）。因此我们只需要使凸包维护时每个点格式工整，决策点与被转移点能够利用单调性即可。</p>
</blockquote>
<hr>
<p>但是这样仍然无法得到满分，需要利用到题解里的一个不等式优化，这个优化的结论是转移过程中整段的转移（选择桶的个数超过2个的转移）不超过14个，其余均为单个桶的转移，证明可以翻翻官方题解。最终复杂度 $O(nplogn)$</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="HDU3507-Print-Article"><a href="#HDU3507-Print-Article" class="headerlink" title="HDU3507 Print Article"></a>HDU3507 Print Article</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">li A[MAXN], sum[MAXN], f[MAXN];</span><br><span class="line"><span class="keyword">int</span> Q[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Judge</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j, li nsum)</span></span>&#123;<span class="keyword">return</span> <span class="number">1.0</span> * (f[j] - f[i] + sum[j] * sum[j] - sum[i] * sum[i]) &lt;= nsum * (sum[j] - sum[i]);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">li <span class="title">UP</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>&#123;<span class="keyword">return</span> (f[j] - f[i] + sum[j] * sum[j] - sum[i] * sum[i]);&#125;</span><br><span class="line"><span class="function">li <span class="title">DOWN</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>&#123;<span class="keyword">return</span> sum[j] - sum[i];&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">JU2</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> UP(i, j) * DOWN(j, k) &gt;= UP(j, k) * DOWN(i, j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r" ,stdin);</span></span><br><span class="line">    <span class="keyword">int</span> n, m, he, ta;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m) != EOF)&#123;</span><br><span class="line">        fore(i, <span class="number">1</span>, n) A[i] = input(), sum[i] = A[i] + sum[i - <span class="number">1</span>];</span><br><span class="line">        Q[he = ta = <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">            <span class="comment">// double k = slope(Q[he], Q[he + 1]);</span></span><br><span class="line">            <span class="keyword">while</span>(he &lt; ta &amp;&amp; Judge(Q[he], Q[he + <span class="number">1</span>], sum[i] * <span class="number">2</span>)) he++;</span><br><span class="line">            <span class="keyword">int</span> j = Q[he];</span><br><span class="line">            f[i] = f[j] + (sum[i] - sum[j]) * (sum[i] - sum[j]) + m;</span><br><span class="line">            <span class="keyword">while</span>(he &lt; ta &amp;&amp; JU2(Q[ta - <span class="number">1</span>], Q[ta], i)) ta--;</span><br><span class="line">            Q[++ta] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, f[n]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="NOI2016-国王饮水记-不含高精度模板"><a href="#NOI2016-国王饮水记-不含高精度模板" class="headerlink" title="NOI2016 国王饮水记(不含高精度模板)"></a>NOI2016 国王饮水记(不含高精度模板)</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pdd pair<span class="meta-string">&lt;double, double&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pdi pair<span class="meta-string">&lt;double, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">8e3</span> + <span class="number">5</span>, MAXK = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A[MAXN], pre[MAXN][MAXK], Q[MAXN], s[MAXN];</span><br><span class="line"><span class="keyword">double</span> f[MAXN][MAXK];</span><br><span class="line">pdd t[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">(pdd A, pdd B)</span></span>&#123;<span class="keyword">return</span> (A.fi - B.fi) / (A.se - B.se);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Decimal <span class="title">Solve</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> nk)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(nk == <span class="number">0</span>) <span class="keyword">return</span> A[<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> (Solve(pre[pos][nk], nk - <span class="number">1</span>) + s[pos] - s[pre[pos][nk]])/(pos - pre[pos][nk] + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = input(), k = input(), p = input();</span><br><span class="line">    fore(i, <span class="number">1</span>, n) A[i] = input();</span><br><span class="line">    <span class="keyword">int</span> mk = A[<span class="number">1</span>];</span><br><span class="line">    sort(A + <span class="number">1</span>, A + n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> pos = lower_bound(A + <span class="number">1</span>, A + n + <span class="number">1</span>, mk) - A;</span><br><span class="line">    n = n - pos + <span class="number">1</span>;</span><br><span class="line">    fore(i, <span class="number">1</span>, n) A[i] = A[pos + i - <span class="number">1</span>];</span><br><span class="line">	fore(i, <span class="number">1</span>, n) f[i][<span class="number">0</span>] = A[<span class="number">1</span>], s[i] = s[i - <span class="number">1</span>] + A[i];</span><br><span class="line">	<span class="keyword">int</span> he, ta;</span><br><span class="line">	pdd tp;</span><br><span class="line">	k = min(k, n); <span class="keyword">int</span> lim = min(<span class="number">14</span>, k), m = n - k + lim;</span><br><span class="line">	fore(nk, <span class="number">1</span>, lim)&#123;</span><br><span class="line">		Q[he = ta = <span class="number">1</span>] = nk;</span><br><span class="line">		fore(i, nk, n) t[i] = MP(s[i] - f[i][nk - <span class="number">1</span>], i - <span class="number">1</span>);</span><br><span class="line">		fore(i, nk + <span class="number">1</span>, n)&#123;</span><br><span class="line">			tp = MP(s[i], i);</span><br><span class="line">			<span class="keyword">while</span>(he &lt; ta &amp;&amp; slope(t[Q[he]], tp) &lt; slope(t[Q[he + <span class="number">1</span>]], tp)) he++;</span><br><span class="line">			f[i][nk] = slope(t[Q[he]], tp);</span><br><span class="line">			<span class="comment">// cout &lt;&lt; i &lt;&lt; " " &lt;&lt; Q[he] &lt;&lt; endl;</span></span><br><span class="line">			pre[i][nk] = Q[he];</span><br><span class="line">			<span class="keyword">while</span>(he &lt; ta &amp;&amp; slope(t[Q[ta]], t[Q[ta - <span class="number">1</span>]]) &gt; slope(t[Q[ta]], t[i])) ta--;</span><br><span class="line">			Q[++ta] = i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// cout &lt;&lt; f[1][0] &lt;&lt; " " &lt;&lt; f[2][1] &lt;&lt; endl;</span></span><br><span class="line">	Decimal ans = Decimal(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">double</span> mx = <span class="number">0</span>; pos = <span class="number">0</span>;</span><br><span class="line">	fore(i, <span class="number">0</span>, lim)</span><br><span class="line">		<span class="keyword">if</span>(f[m][i] &gt; mx)</span><br><span class="line">			mx = f[m][i], pos = i;</span><br><span class="line">	ans = Solve(m, pos);</span><br><span class="line">	fore(i, m + <span class="number">1</span>, n)</span><br><span class="line">		ans = (ans + A[i]) / <span class="number">2</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; ans.to_string(p &lt;&lt; <span class="number">1</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ZJOI2007-仓库建设"><a href="#ZJOI2007-仓库建设" class="headerlink" title="ZJOI2007 仓库建设"></a>ZJOI2007 仓库建设</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">li x[MAXN], p[MAXN], f[MAXN], s[MAXN], c[MAXN], co[MAXN];</span><br><span class="line"><span class="keyword">int</span> he, ta, Q[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function">li <span class="title">DOWN</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>&#123;<span class="keyword">return</span> c[i] - c[j];&#125;</span><br><span class="line"><span class="function">li <span class="title">UP</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>&#123;<span class="keyword">return</span> f[i] - f[j] + s[i] - s[j];&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = input();</span><br><span class="line">    fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        x[i] = input();</span><br><span class="line">        p[i] = input();</span><br><span class="line">        c[i] = c[i - <span class="number">1</span>] + p[i];</span><br><span class="line">        s[i] = s[i - <span class="number">1</span>] + x[i] * p[i];</span><br><span class="line">        co[i] = input();</span><br><span class="line">    &#125;</span><br><span class="line">    Q[he = ta = <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        <span class="keyword">while</span>(he &lt; ta &amp;&amp; DOWN(Q[he], Q[he + <span class="number">1</span>]) * x[i] &lt; UP(Q[he], Q[he + <span class="number">1</span>])) he++;</span><br><span class="line">        <span class="keyword">int</span> j = Q[he];</span><br><span class="line">        <span class="comment">// cout &lt;&lt; j &lt;&lt; " \n"[i == n];</span></span><br><span class="line">        f[i] = f[j] - s[i] + s[j] + (c[i] - c[j]) * x[i] + co[i];</span><br><span class="line">        <span class="keyword">while</span>(he &lt; ta &amp;&amp; UP(Q[ta - <span class="number">1</span>], Q[ta]) * DOWN(Q[ta], i) &gt; UP(Q[ta], i) * DOWN(Q[ta - <span class="number">1</span>], Q[ta]))ta--;</span><br><span class="line">        Q[++ta] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fore(i, 1, n) cout &lt;&lt; f[i] &lt;&lt; " \n"[i == n];</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>, f[n]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/08/2020-%E5%A4%9A%E6%A0%A1-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/08/2020-%E5%A4%9A%E6%A0%A1-10/" itemprop="url">2020-多校-10</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-08T23:41:02+08:00">
                2021-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%9A%E6%A0%A1-10/" itemprop="url" rel="index">
                    <span itemprop="name">多校-10</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="D-Permutation-Counting"><a href="#D-Permutation-Counting" class="headerlink" title="D.Permutation Counting"></a>D.Permutation Counting</h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>对于 1 到 $n$ 的任意一种排列，可以用一个长度为 $n - 1$ 的01数列表示相邻两个数字的关系，0 代表前一个数字小于后一个数字，1则相反。</p>
<p>比如1，2，3，6，4，5，其得到的关系数列为 0，0，0，1，0</p>
<p>现在给你一个长度为 $n-1(n\leq 5000)$ 的01数列，问有多少个长度为 $n$ 的排列满足这个数列</p>
<h2 id="题解：DP"><a href="#题解：DP" class="headerlink" title="题解：DP"></a>题解：DP</h2><p>定一个状态 $dp[i][j]$ ，代表当前填充到第 $i$ 位，填充的数字在剩下的数字中为第 $j$ 大。</p>
<p>$dp[i][j] = \begin{cases}<br>\sum_{k=1}^{j}dp[i][k] &amp; a[i] = 0\\<br>\sum_{k=j+1}^{n-i}dp[i][k] &amp;a[i]=1<br>\end{cases}$</p>
<p>这个转移是我猜的，因为代码不是我写的</p>
<h1 id="E-Tree-Cutting"><a href="#E-Tree-Cutting" class="headerlink" title="E.Tree Cutting"></a>E.Tree Cutting</h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>给一棵树$(n\leq 3\times 10^5)$，现在要删去一些点，使树的直径小于等于 $k\leq 3\times 10^5$，问最少要删去多少点</p>
<h2 id="题解：点分治"><a href="#题解：点分治" class="headerlink" title="题解：点分治"></a>题解：点分治</h2><p>先处理树的重心是一个点的情况（直径是偶数），以每个点作为新树的重心，统计每一层点分治过当前这一层子树的重心的新树中点的数量（正向反向统计一遍），最后取一个最值即可。</p>
<p>考虑树的重心在边上，那么原本的记录在点上的结果现在记录在边上，并且为了不重复计数，我们对每条边仅统计当前子树中深度更浅的那个点的答案。（注意在不同层的点分治中，每条边统计的点可能不一样）</p>
<h1 id="F-Divide-and-Conquer"><a href="#F-Divide-and-Conquer" class="headerlink" title="F.Divide and Conquer"></a>F.Divide and Conquer</h1><h2 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h2><p>给 $4k$ 个点，保证任意三个点不共线，求两根直线，将 $4k$ 个点平均分为4部分</p>
<h2 id="题解：二分"><a href="#题解：二分" class="headerlink" title="题解：二分"></a>题解：二分</h2><p>首先随便用一根线吧这些点均分为两部分。</p>
<p>可以确定对于每一部分，对于任何一个截距 $b$，都可以找到一个斜率 $k$ ， 使得 $y=kx+b$ 能够平分这一部分的点，且 $k$ 可以关于 $b$ 单调。</p>
<p>那么我们实际上就是找这两部分能够共用的斜率和截距。 二分一个斜率 $k$ ，验证是否均分成四部分，最后微调即可。</p>
<h1 id="G-Coin-Game"><a href="#G-Coin-Game" class="headerlink" title="G.Coin Game"></a>G.Coin Game</h1><h2 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h2><p>有 $n\leq 5\times 10^6$ 个机器，投入硬币后会产生相应的权值，每台机器最多投入三个硬币，每次产生的权值分别为 $a_i,b_i,a_i(a_i,b_i\leq 10^7)$ 。现在有 $m\leq 1.5\times 10^7$ 个硬币，假设投入 $i$ 枚硬币能得到的最大的权值为 $f(i)$ ，现在要求输出 $\oplus_{i=1}^{n}f(i)$</p>
<h2 id="题解：背包-贪心"><a href="#题解：背包-贪心" class="headerlink" title="题解：背包+贪心"></a>题解：背包+贪心</h2><p>首先这是一个典型的背包问题，正常的递推方程是</p>
<p>$f[i][j] = max_{k=0}^{3}\{f[i - 1][j-k]+cost\}$</p>
<p>其中 $i$ 表示当前使用到第 $i$ 个机器，$j$ 表示使用了 $j$ 个硬币，cost则代表当前机器使用 $k$ 个硬币能够的到的相应的权值。</p>
<p>复杂度 $O(nm)$</p>
<p>现在考虑这个特殊的条件——最多投三枚硬币。</p>
<p>那么我们将投三枚硬币得到的权值分成两份，$a$ 和 $a+b$ ，把它们看作两类不同且相互独立的物品，那么我们每次都只要贪心地找当前能够得到的最大值即可。排序+贪心复杂度 $O(nlogn)$</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="D-Permutation-Counting-1"><a href="#D-Permutation-Counting-1" class="headerlink" title="D.Permutation Counting"></a>D.Permutation Counting</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int.int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> x first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> y second</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">9</span>;</span><br><span class="line"><span class="keyword">const</span> ll mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line">ll a[maxn],dp[<span class="number">6000</span>][<span class="number">6000</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i]==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ll sum=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=i;j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    dp[i][j]=sum%mod;</span><br><span class="line">                    sum=(sum+dp[i<span class="number">-1</span>][j])%mod;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                ll sum=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j=i;j&gt;=<span class="number">1</span>;j--)</span><br><span class="line">                &#123;</span><br><span class="line">                    dp[i][j]=sum%mod;</span><br><span class="line">                    sum=(sum+dp[i<span class="number">-1</span>][j<span class="number">-1</span>])%mod;</span><br><span class="line">                &#125;</span><br><span class="line">               <span class="comment">// cout&lt;&lt;sum;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ll sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">            sum=(sum+dp[n][i])%mod;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="E-Tree-Cutting-1"><a href="#E-Tree-Cutting-1" class="headerlink" title="E.Tree Cutting"></a>E.Tree Cutting</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x) (x &amp; (-x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> k, nsiz, nrt, cnt_e, res[MAXN], res_e[MAXN], maxsiz[MAXN], siz[MAXN], ex[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;pii&gt; EG[MAXN];</span><br><span class="line"><span class="keyword">bool</span> mk[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FR</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span></span>&#123;</span><br><span class="line">    siz[u] = <span class="number">1</span>;</span><br><span class="line">    maxsiz[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(pii eg : EG[u])&#123;</span><br><span class="line">        <span class="keyword">int</span> v = eg.fi;</span><br><span class="line">        <span class="keyword">if</span>(v != f &amp;&amp; !mk[v])&#123;</span><br><span class="line">            FR(v, u);</span><br><span class="line">            siz[u] += siz[v];</span><br><span class="line">            maxsiz[u] = max(maxsiz[u], siz[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    maxsiz[u] = max(maxsiz[u], nsiz - siz[u]);</span><br><span class="line">    <span class="keyword">if</span>(maxsiz[u] &lt; maxsiz[nrt]) nrt = u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tn, cnt[MAXN], ncnt[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="comment">// void Add(int x)&#123;for(; x &lt;= tn; x += lowbit(x)) cnt[x]++;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int QRY(int x)&#123;</span></span><br><span class="line"><span class="comment">//     if(x &lt; 0) return 0;</span></span><br><span class="line"><span class="comment">//     x = min(x, tn);</span></span><br><span class="line"><span class="comment">//     int ret = 1;</span></span><br><span class="line"><span class="comment">//     for(; x; x -= lowbit(x))</span></span><br><span class="line"><span class="comment">//         ret += cnt[x];</span></span><br><span class="line"><span class="comment">//     return ret;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f, <span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">    ncnt[d]++;</span><br><span class="line">    <span class="keyword">if</span>((k &gt;&gt; <span class="number">1</span>) - d &gt;= <span class="number">0</span>) res[u] += cnt[min((k &gt;&gt; <span class="number">1</span>) - d, tn)];</span><br><span class="line">    <span class="keyword">for</span>(pii eg : EG[u])&#123;</span><br><span class="line">        <span class="keyword">int</span> v = eg.fi;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(v != f &amp;&amp; !mk[v])&#123;</span><br><span class="line">            <span class="keyword">if</span>(((k &gt;&gt; <span class="number">1</span>) - d) &gt;= <span class="number">0</span>)res_e[eg.se] += cnt[min((k &gt;&gt; <span class="number">1</span>) - d, tn)];</span><br><span class="line">            <span class="comment">// printf("%d %d %d\n", u, v, cnt[min((k &gt;&gt; 1) - d, tn)]);</span></span><br><span class="line">            Cal(v, u, d + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Pro</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; "MK : " &lt;&lt; u &lt;&lt; endl;</span></span><br><span class="line">    mk[u] = <span class="number">1</span>;</span><br><span class="line">    tn = maxsiz[u];</span><br><span class="line">    fill(cnt, cnt + tn + <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(pii eg : EG[u])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> v = eg.fi;</span><br><span class="line">        <span class="keyword">if</span>(!mk[v])&#123;</span><br><span class="line">            <span class="keyword">int</span> tsiz = max(tn, siz[v]);</span><br><span class="line">            fill(ncnt, ncnt + tn + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            Cal(v, u, <span class="number">1</span>);</span><br><span class="line">            fore(i, <span class="number">1</span>, tn)ncnt[i] += ncnt[i - <span class="number">1</span>],cnt[i] += ncnt[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res[u] += cnt[min(k &gt;&gt; <span class="number">1</span>, tn)];</span><br><span class="line">    <span class="keyword">for</span>(pii eg : EG[u])</span><br><span class="line">        <span class="keyword">if</span>(!mk[eg.fi])</span><br><span class="line">            res_e[eg.se] += cnt[min(k &gt;&gt; <span class="number">1</span>, tn)];</span><br><span class="line">    fill(cnt, cnt + tn + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = EG[u].size() - <span class="number">1</span>, v; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="keyword">if</span>(!mk[v = EG[u][i].fi])&#123;</span><br><span class="line">            <span class="keyword">int</span> tsiz = max(tn, siz[v]);</span><br><span class="line">            fill(ncnt, ncnt + tn + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            Cal(v, u, <span class="number">1</span>);</span><br><span class="line">            fore(i, <span class="number">1</span>, tn)</span><br><span class="line">                ncnt[i] += ncnt[i - <span class="number">1</span>],</span><br><span class="line">                cnt[i] += ncnt[i];</span><br><span class="line">            <span class="comment">// cout &lt;&lt; "RES " &lt;&lt; u &lt;&lt; " " &lt;&lt; v &lt;&lt; " " &lt;&lt; res_e[EG[u][i].se] &lt;&lt; " ";</span></span><br><span class="line">            res_e[EG[u][i].se] += - ncnt[min(tn, k &gt;&gt; <span class="number">1</span>)] + ncnt[min(tn, (k + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>)];</span><br><span class="line">            <span class="comment">// cout &lt;&lt; res_e[EG[u][i].se] &lt;&lt; endl;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">int</span> mksiz = nsiz;</span><br><span class="line">    <span class="keyword">for</span>(pii eg : EG[u])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> v = eg.fi;</span><br><span class="line">        <span class="keyword">if</span>(!mk[v])&#123;</span><br><span class="line">            nsiz = siz[v] &gt; siz[u] ? mksiz - siz[u] : siz[v];</span><br><span class="line">            nrt = <span class="number">0</span>;</span><br><span class="line">            FR(v, u);</span><br><span class="line">            Pro(nrt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r" ,stdin);</span></span><br><span class="line">    maxsiz[<span class="number">0</span>] = <span class="number">1e9</span> + <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> T = input();</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="keyword">int</span> n = input(), u, v;</span><br><span class="line">        k = input();</span><br><span class="line">        cnt_e = <span class="number">0</span>;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">            EG[i].clear();</span><br><span class="line">            res[i] = <span class="number">0</span>;</span><br><span class="line">            res_e[i] = <span class="number">0</span>;</span><br><span class="line">            mk[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">            u = input(); v = input();</span><br><span class="line">            EG[u].EP(v, ++cnt_e); EG[v].EP(u, cnt_e);</span><br><span class="line">        &#125;</span><br><span class="line">        nsiz = n; nrt = <span class="number">0</span>;</span><br><span class="line">        FR(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        Pro(nrt);</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">1e9</span> + <span class="number">5</span>;</span><br><span class="line">        <span class="comment">// fore(i, 1, n) cout &lt;&lt; i &lt;&lt; " " &lt;&lt; res[i] &lt;&lt; endl;</span></span><br><span class="line">        <span class="keyword">if</span>(k &amp; <span class="number">1</span>)&#123;</span><br><span class="line">            fore(i, <span class="number">1</span>, n - <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">if</span>(n - res_e[i] &lt; ans) ans = n - res_e[i];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            fore(i, <span class="number">1</span>, n)</span><br><span class="line">                <span class="keyword">if</span>(n - res[i] &lt; ans) ans = n - res[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="F-Divide-and-Conquer-1"><a href="#F-Divide-and-Conquer-1" class="headerlink" title="F.Divide and Conquer"></a>F.Divide and Conquer</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> o; <span class="keyword">char</span> c = getchar(); <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>),</span><br><span class="line">        c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">3</span>)+(o &lt;&lt; <span class="number">1</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y; <span class="keyword">double</span> r; <span class="keyword">bool</span> mk;</span><br><span class="line">    Node()&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inp</span><span class="params">()</span></span>&#123;x = input(); y = input();&#125;</span><br><span class="line">&#125; node[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> ang;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fore(i, <span class="number">1</span>, n) node[i].r = -<span class="built_in">sin</span>(ang) * node[i].x + <span class="built_in">cos</span>(ang) * node[i].y;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; ang &lt;&lt; " " &lt;&lt; sin(ang) &lt;&lt; " "&lt;&lt; cos(ang) &lt;&lt; endl;</span></span><br><span class="line">    sort(node + <span class="number">1</span>, node + n + <span class="number">1</span>, [](Node &amp;a, Node &amp;b)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">fabs</span>(a.r - b.r) &gt; eps) <span class="keyword">return</span> a.r &lt; b.r;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(a.x == b.x) <span class="keyword">return</span> a.y &lt; b.y;</span><br><span class="line">            <span class="keyword">return</span> a.x &lt; b.x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r", stdin);</span></span><br><span class="line">    <span class="keyword">int</span> T = input();</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        n = input();</span><br><span class="line">        fore(i, <span class="number">1</span>, n) node[i].inp();</span><br><span class="line">        ang = <span class="number">0</span>;</span><br><span class="line">        Cal();</span><br><span class="line">        fore(i, <span class="number">1</span>, n &gt;&gt; <span class="number">1</span>)</span><br><span class="line">            node[i].mk = <span class="number">1</span>;</span><br><span class="line">        fore(i, n &gt;&gt; <span class="number">1</span> | <span class="number">1</span>, n)</span><br><span class="line">            node[i].mk = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> hn = n &gt;&gt; <span class="number">1</span>, y = (node[hn].y + node[hn | <span class="number">1</span>].y + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d %d %d %d\n"</span>, node[hn].x - <span class="number">100000000</span>, y + ((node[hn].y==node[hn|<span class="number">1</span>].y)), node[hn + <span class="number">1</span>].x + <span class="number">100000000</span>, (y - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">double</span> l = <span class="number">0</span>, r = <span class="built_in">acos</span>(<span class="number">-1</span>), mid;</span><br><span class="line">        <span class="keyword">int</span> cnt;</span><br><span class="line">        fore(i, <span class="number">1</span>, <span class="number">200</span>)&#123;</span><br><span class="line">            ang = mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">            Cal();</span><br><span class="line">            cnt = <span class="number">0</span>;</span><br><span class="line">            fore(j, <span class="number">1</span>, hn)</span><br><span class="line">                cnt += node[j].mk;</span><br><span class="line">            <span class="keyword">if</span>(cnt == (hn &gt;&gt; <span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span>(cnt &gt; (hn &gt;&gt; <span class="number">1</span>)) l = mid;</span><br><span class="line">            <span class="keyword">else</span> r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">double</span> nx = (node[hn].x + node[hn + <span class="number">1</span>].x) * <span class="number">0.5</span>,</span><br><span class="line">                ny = (node[hn].y + node[hn + <span class="number">1</span>].y) * <span class="number">0.5</span>;</span><br><span class="line">        ang += <span class="number">1e-7</span> * ((nx &lt; node[hn].x) || (nx == node[hn].x &amp;&amp; ny &lt; node[hn].y) ? <span class="number">1</span> : <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d %d %d %d\n"</span>, <span class="keyword">int</span>(nx - <span class="number">1e8</span> * <span class="built_in">cos</span>(ang)), <span class="keyword">int</span>(ny - <span class="number">1e8</span> * <span class="built_in">sin</span>(ang)), <span class="keyword">int</span>(nx + <span class="number">1e8</span> * <span class="built_in">cos</span>(ang)), <span class="keyword">int</span>(ny + <span class="number">1e8</span> * <span class="built_in">sin</span>(ang)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="G-Coin-Game-1"><a href="#G-Coin-Game-1" class="headerlink" title="G.Coin Game"></a>G.Coin Game</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uli unsigned long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">int</span> threshold = <span class="number">10000000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uli k1, k2;</span><br><span class="line"></span><br><span class="line"><span class="function">uli <span class="title">XOR</span><span class="params">()</span></span>&#123;</span><br><span class="line">    uli k3 = k1, k4 = k2;</span><br><span class="line">    k1 = k4;</span><br><span class="line">    k3 ^= (k3 &lt;&lt; <span class="number">23</span>);</span><br><span class="line">    k2 = k3 ^ k4 ^ (k3 &gt;&gt; <span class="number">17</span>) ^ (k4 &gt;&gt; <span class="number">26</span>);</span><br><span class="line">    <span class="keyword">return</span> k2 + k4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[MAXN], b[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen</span><span class="params">(<span class="keyword">int</span> n, uli _k1, uli _k2)</span></span>&#123;</span><br><span class="line">    k1 = _k1, k2 = _k2;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        a[i] = XOR() % threshold + <span class="number">1</span>;</span><br><span class="line">        b[i] = XOR() % threshold + <span class="number">1</span> + a[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    uli _k1, _k2;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d%llu%llu"</span>, &amp;n, &amp;m, &amp;_k1, &amp;_k2) != EOF)&#123;</span><br><span class="line">        gen(n, _k1, _k2);</span><br><span class="line">        sort(a + <span class="number">1</span>, a + n + <span class="number">1</span>);</span><br><span class="line">        sort(b + <span class="number">1</span>, b + n + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> ta = n, tb = n;</span><br><span class="line">        li res = <span class="number">0</span>, sum = <span class="number">0</span>;</span><br><span class="line">        fore(i, <span class="number">1</span>, m)&#123;</span><br><span class="line">            <span class="keyword">if</span>((ta == n) || (tb == <span class="number">0</span>))&#123;</span><br><span class="line">                sum += a[ta];</span><br><span class="line">                ta--;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ta == <span class="number">0</span>) sum += b[tb] - a[++ta];</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(a[ta] + a[ta + <span class="number">1</span>] &lt; b[tb])&#123;</span><br><span class="line">                    ta++;</span><br><span class="line">                    sum += b[tb] - a[ta];</span><br><span class="line">                    tb--;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    sum += a[ta];</span><br><span class="line">                    ta--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res ^= sum;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/07/WQS%E4%BA%8C%E5%88%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/07/WQS%E4%BA%8C%E5%88%86/" itemprop="url">WQS二分</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-07T15:40:18+08:00">
                2021-02-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%83%E4%B9%A0%E9%A2%98%E9%9B%86/" itemprop="url" rel="index">
                    <span itemprop="name">练习题集</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="CF739E-Gosha-is-hunting"><a href="#CF739E-Gosha-is-hunting" class="headerlink" title="CF739E.Gosha is hunting"></a><a href>CF739E.Gosha is hunting</a></h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>有 $n$ 只宝可梦，你手头有 $a$ 个普通球， $b$ 个橡木球，当使用普通球捕获第 $i$ 只宝可梦时概率为 $p_i$ ，用橡木球捕获第 $i$ 只宝可梦的时候概率为 $q_i$ 。你可以对某只宝可梦丢普通球或橡木球，也可以同时使用两个不同种类的球。现在希望规划好所有的球使用的对象，要求让捕获到的宝可梦的数量的期望最大。问最大期望是多少。其中 $1\leq a,b\leq n\leq 10^4$。</p>
<h2 id="题解：二分套二分-WQS二分-网络流"><a href="#题解：二分套二分-WQS二分-网络流" class="headerlink" title="题解：二分套二分+WQS二分/网络流"></a>题解：二分套二分+WQS二分/网络流</h2><h3 id="二分套二分-WQS二分"><a href="#二分套二分-WQS二分" class="headerlink" title="二分套二分+WQS二分"></a>二分套二分+WQS二分</h3><p>以 $dp[n][a][b]$ 为状态进行转移复杂度为 $O(nab)$ ，显然太大了</p>
<p>观察一下</p>
<p>以 $a/b$ 为横坐标， 期望和为纵坐标，能够得到一个凸函数。</p>
<p>WQS二分一个斜率（额外代价）即可消除其中一维 $O(a)/O(b)$ 的复杂度，代价是二分的复杂度 $O(T)$</p>
<p>但是当这个情况到二维之后我们该如何考虑呢？</p>
<h4 id="首先观察一下两种球之间的影响。"><a href="#首先观察一下两种球之间的影响。" class="headerlink" title="首先观察一下两种球之间的影响。"></a>首先观察一下两种球之间的影响。</h4><p>$<br>dp[i] = \begin{cases}<br>dp[i - 1] + p_i &amp; Poke-Ball\\<br>dp[i - 1] + u_i &amp; Ultra-Ball\\<br>dp[i - 1] + p_i + u_i - p_iu_i &amp; Both\\<br>\end{cases}<br>$</p>
<p>将这个拓展到二维平面后，他也一定是一个二维的凸包，两个斜率出来之后相当于用一个斜的平面去切凸包，最终切到那个正好的点。</p>
<h3 id="网络流"><a href="#网络流" class="headerlink" title="网络流"></a>网络流</h3><p>设两个源点，代表两种精灵球，每个精灵从两个源点连两条边，代价为 $-p_i$ 和 $-u_i$ ，连两条边道汇点，一条 $0$ ，一条 $p_iq_i$，跑最小费用最大流。</p>
<h1 id="luogu-P5308-COCI2019-Quiz"><a href="#luogu-P5308-COCI2019-Quiz" class="headerlink" title="[luogu P5308][COCI2019]Quiz"></a><a href="https://www.luogu.com.cn/problem/P5308" target="_blank" rel="noopener">[luogu P5308][COCI2019]Quiz</a></h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>你面临 $n\leq 10^5$ 名参赛者的挑战，最终要将他们全部战胜。<br>每一轮中，都会淘汰一些选手；你会得到这一轮奖金池中 被淘汰者 除以 这一轮对手总数 比例的奖金。</p>
<p>例如某一轮有 10 个对手，淘汰了 3 个，那么你将获得奖金池中 3/10 的奖金。</p>
<p>假设每一轮的奖金池均为一元，<code>Mirko</code> 希望通过恰好 $k\leq n$ 轮赢得比赛，那么他最多可能获得多少奖金呢？</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="一般对于这种跨区间且区间长度无限制的转移，都会有一个斜率优化。"><a href="#一般对于这种跨区间且区间长度无限制的转移，都会有一个斜率优化。" class="headerlink" title="一般对于这种跨区间且区间长度无限制的转移，都会有一个斜率优化。"></a>一般对于这种跨区间且区间长度无限制的转移，都会有一个斜率优化。</h3><h4 id="首先不考虑-k-轮的限制条件"><a href="#首先不考虑-k-轮的限制条件" class="headerlink" title="首先不考虑 $k$ 轮的限制条件"></a>首先不考虑 $k$ 轮的限制条件</h4><p>首先我们确定一个转移方向，反向从小向大转移。若此时是从 $i$ 转移到 $j(j\leq i)$ ，那么得到的贡献为 $f[j] = f[i] + \frac{j-i}{j}$</p>
<p>那么对于 $i\leq j\leq k$ ，转移到 $k$ 时若 $j$ 比 $i$ 更优，则应有 $f[i]+\frac{k-i}{k} &lt; f[j] + \frac{k-j}{k}$</p>
<p>移项得到 $\frac{f[i]-f[j]}{i-j}&lt;\frac{1}{k}$</p>
<p>根据这个不等式，我们可以维护一个单调递减队列：<br>每次讨论新的转移时弹出队首直至队首位最优转移点；<br>将元素加入队尾时同样需要满足单调性；</p>
<h4 id="然后加上-k-轮的限制条件"><a href="#然后加上-k-轮的限制条件" class="headerlink" title="然后加上 $k$ 轮的限制条件"></a>然后加上 $k$ 轮的限制条件</h4><p>由于维护的是一个凸包，因此WQS二分即可</p>
<p><strong>注意：由于最终是轮数满足要求，因此在转移时需要记录当前转移的游戏轮数</strong></p>
<h1 id="ICPC-2018-南京-B-Tournament"><a href="#ICPC-2018-南京-B-Tournament" class="headerlink" title="ICPC-2018-南京 B.Tournament"></a>ICPC-2018-南京 B.Tournament</h1><h2 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h2><p>在一条直线上分布着 $n\leq3\times 10^5$ 个点 ，每个点的坐标为 $a_i\in[0,10^9]$ 。</p>
<p>现在要设立 $k(1\leq k\leq n)$ 个关键点，使得 $n$ 个点到离它最近的关键点的距离之和最小，问这个最小距离为多少。</p>
<h2 id="题解：二分套WQS二分"><a href="#题解：二分套WQS二分" class="headerlink" title="题解：二分套WQS二分"></a>题解：二分套WQS二分</h2><p>首先我们可以通过预处理前缀和和前缀前缀和来 $O(1)$ 求在一个区间设置一个关键点的最小距离和（显然是设在中间点最优）</p>
<p>其次我们来讨论转移，但是对于这道题，转移的方式很重要。</p>
<p>在没有 $k$ 的限制的条件下，显然每个点都是关键点的时候是最优的——据此，我们可以想象一下以 $k$ 为 $x$ 轴 ，$f(k)$ （每个点到与其距离最近的关键点的距离之和在只有 $k$ 个关键点的前提下的小值） 为 $y$ 轴的线，它是一个单调递减的凸包。此时它的极小值点为 $x=n$ 。</p>
<p>但是按照题目的要求，我们希望得到极值点为 $x=k$ 的线，此时使用WQS二分将图像尾部抬起来，维护一个单调递减的单调队列即可。</p>
<p>在这个条件下，我们以第 $i$ 个点作为区间的起点作为转移对象，讨论一下如何维护这个单调队列：</p>
<p>1、首先我们只需要维护可以转移到当前区间的区间，即区间右端点在 $i$ 及其右侧的区间（两个区间至少要相切），因此弹出队首的右端点在 $i$ 的左侧的点。弹出后用队首元素转移 $i$ 点的信息。</p>
<p>2、其次讨论如何弹出队尾元素：以 $i$ 作为区间终点，讨论队尾元素作为区间起点的情况，若 $Q[tail - 1]$ 比 $Q[tail]$ 更优，则弹出队尾元素，因为在之后的任何情况下从 $Q[tail]$ 转移都不可能比 $Q[tail - 1]$ 更优了。</p>
<p>最后分别以更新过的 $Q[tail]$ 和 $i$ 作为区间起点，讨论以 $i$ 作为区间起点的最优区间终点，而后将 $i$ 加入栈尾。</p>
<h1 id="【luogu-P2619】-国家集训队2-Tree-I"><a href="#【luogu-P2619】-国家集训队2-Tree-I" class="headerlink" title="【luogu P2619】[国家集训队2]Tree I"></a><a href="https://www.luogu.com.cn/problem/P2619" target="_blank" rel="noopener">【luogu P2619】[国家集训队2]Tree I</a></h1><h2 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h2><p>给你一个无向带权连通图，每条边是黑色或白色。让你求一棵最小权的恰好有 $need$ 条白色边的生成树。</p>
<p>题目保证有解。</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>WQS的实质是通过增加/减少单个决策点的权值使得原本可选的最优解变得不可选。</p>
<p>对这道题而言同理，通过二分增加白色边的权值，使得原本在最小生成树中的某些白色边不可选即可。</p>
<h2 id="【luoguP3620】-APIO-CTSC-2007-数据备份"><a href="#【luoguP3620】-APIO-CTSC-2007-数据备份" class="headerlink" title="【luoguP3620】[APIO/CTSC 2007]数据备份"></a><a href="https://www.luogu.com.cn/problem/P3620" target="_blank" rel="noopener">【luoguP3620】[APIO/CTSC 2007]数据备份</a></h2><h2 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h2><p>$n$ 个办公楼排成一条直线，给出距离最开始的距离</p>
<p>选择 $k$ 对办公楼，使得 $k$ 对办公楼每对之间的距离和最小</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>二分结果中配对的办公楼之间的最大距离，WQS二分验证即可</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="CF739E-Gosha-is-hunting-1"><a href="#CF739E-Gosha-is-hunting-1" class="headerlink" title="CF739E.Gosha is hunting"></a>CF739E.Gosha is hunting</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> pa[MAXN], pb[MAXN];</span><br><span class="line"><span class="keyword">int</span> n, ca[MAXN], cb[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Solve</span><span class="params">(<span class="keyword">double</span> ta, <span class="keyword">double</span> tb)</span></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> res = <span class="number">0</span>, temp;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        temp = <span class="number">0</span>;</span><br><span class="line">        ca[i] = ca[i - <span class="number">1</span>]; cb[i] = cb[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(pa[i] - ta &gt; temp)</span><br><span class="line">            temp = pa[i] - ta,</span><br><span class="line">            ca[i] = ca[i - <span class="number">1</span>] + <span class="number">1</span>,</span><br><span class="line">            cb[i] = cb[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(pb[i] - tb &gt; temp + eps)</span><br><span class="line">            temp = pb[i] - tb,</span><br><span class="line">            ca[i] = ca[i - <span class="number">1</span>],</span><br><span class="line">            cb[i] = cb[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(pa[i] + pb[i] - pa[i] * pb[i] - ta - tb &gt; temp + eps)</span><br><span class="line">            temp = pa[i] + pb[i] - pa[i] * pb[i] - ta - tb,</span><br><span class="line">            ca[i] = ca[i - <span class="number">1</span>] + <span class="number">1</span>,</span><br><span class="line">            cb[i] = cb[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        res += temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r", stdin);</span></span><br><span class="line">    ios_base::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> A, B;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; A &gt;&gt; B;</span><br><span class="line">    fore(i, <span class="number">1</span>, n) <span class="built_in">cin</span> &gt;&gt; pa[i];</span><br><span class="line">    fore(i, <span class="number">1</span>, n) <span class="built_in">cin</span> &gt;&gt; pb[i];</span><br><span class="line">    <span class="keyword">double</span> resa, resb, lb, rb, mb, la = <span class="number">0</span>, ra = <span class="number">1</span>, ma;</span><br><span class="line">    <span class="keyword">while</span>(la + eps &lt; ra)&#123;</span><br><span class="line">        ma = (la + ra) * <span class="number">0.5</span>;</span><br><span class="line">        lb = <span class="number">0</span>, rb = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(lb + eps &lt; rb)&#123;</span><br><span class="line">            mb = (lb + rb) * <span class="number">0.5</span>;</span><br><span class="line">            Solve(ma, mb);</span><br><span class="line">            <span class="keyword">if</span>(cb[n] &gt; B) lb = mb;</span><br><span class="line">            <span class="keyword">else</span> rb = mb;</span><br><span class="line">        &#125;</span><br><span class="line">        Solve(ma, rb);</span><br><span class="line">        <span class="keyword">if</span>(ca[n] &gt; A) la = ma;</span><br><span class="line">        <span class="keyword">else</span> ra = ma;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> res = Solve(ra, rb) + A * ra + B * rb;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="luoguP5308-Quiz"><a href="#luoguP5308-Quiz" class="headerlink" title="[luoguP5308]Quiz"></a>[luoguP5308]Quiz</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> pa[MAXN], pb[MAXN];</span><br><span class="line"><span class="keyword">int</span> n, ca[MAXN], cb[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Solve</span><span class="params">(<span class="keyword">double</span> ta, <span class="keyword">double</span> tb)</span></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> res = <span class="number">0</span>, temp;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        temp = <span class="number">0</span>;</span><br><span class="line">        ca[i] = ca[i - <span class="number">1</span>]; cb[i] = cb[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(pa[i] - ta &gt; temp)</span><br><span class="line">            temp = pa[i] - ta,</span><br><span class="line">            ca[i] = ca[i - <span class="number">1</span>] + <span class="number">1</span>,</span><br><span class="line">            cb[i] = cb[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(pb[i] - tb &gt; temp + eps)</span><br><span class="line">            temp = pb[i] - tb,</span><br><span class="line">            ca[i] = ca[i - <span class="number">1</span>],</span><br><span class="line">            cb[i] = cb[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(pa[i] + pb[i] - pa[i] * pb[i] - ta - tb &gt; temp + eps)</span><br><span class="line">            temp = pa[i] + pb[i] - pa[i] * pb[i] - ta - tb,</span><br><span class="line">            ca[i] = ca[i - <span class="number">1</span>] + <span class="number">1</span>,</span><br><span class="line">            cb[i] = cb[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        res += temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r", stdin);</span></span><br><span class="line">    ios_base::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> A, B;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; A &gt;&gt; B;</span><br><span class="line">    fore(i, <span class="number">1</span>, n) <span class="built_in">cin</span> &gt;&gt; pa[i];</span><br><span class="line">    fore(i, <span class="number">1</span>, n) <span class="built_in">cin</span> &gt;&gt; pb[i];</span><br><span class="line">    <span class="keyword">double</span> resa, resb, lb, rb, mb, la = <span class="number">0</span>, ra = <span class="number">1</span>, ma;</span><br><span class="line">    <span class="keyword">while</span>(la + eps &lt; ra)&#123;</span><br><span class="line">        ma = (la + ra) * <span class="number">0.5</span>;</span><br><span class="line">        lb = <span class="number">0</span>, rb = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(lb + eps &lt; rb)&#123;</span><br><span class="line">            mb = (lb + rb) * <span class="number">0.5</span>;</span><br><span class="line">            Solve(ma, mb);</span><br><span class="line">            <span class="keyword">if</span>(cb[n] &gt; B) lb = mb;</span><br><span class="line">            <span class="keyword">else</span> rb = mb;</span><br><span class="line">        &#125;</span><br><span class="line">        Solve(ma, rb);</span><br><span class="line">        <span class="keyword">if</span>(ca[n] &gt; A) la = ma;</span><br><span class="line">        <span class="keyword">else</span> ra = ma;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> res = Solve(ra, rb) + A * ra + B * rb;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ICPC-2018-南京-B-Tournament-1"><a href="#ICPC-2018-南京-B-Tournament-1" class="headerlink" title="ICPC-2018-南京 B.Tournament"></a>ICPC-2018-南京 B.Tournament</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">li A[MAXN], S[MAXN], dp[MAXN];</span><br><span class="line"><span class="keyword">int</span> n, k, cnt[MAXN], Le[MAXN], Ri[MAXN], Q[MAXN], he, ta;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Solve</span><span class="params">(li ex)</span></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> Cal = [&amp;](<span class="keyword">int</span> l, <span class="keyword">int</span> r)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// cout &lt;&lt; S[r] - S[mid] - (S[mid] - S[l - 1]) + A[mid] * (mid+mid-l-r+1) &lt;&lt; endl;</span></span><br><span class="line">        <span class="keyword">return</span> S[r] - S[mid] - (S[mid] - S[l - <span class="number">1</span>]) + A[mid] * (mid+mid-l-r+<span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">auto</span> calc = [&amp;](<span class="keyword">int</span> x, <span class="keyword">int</span> r)&#123;</span><br><span class="line">        <span class="comment">// cout &lt;&lt; x &lt;&lt; " " &lt;&lt; r &lt;&lt; " " &lt;&lt; dp[x] + Cal(x + 1, r) + ex &lt;&lt; endl;</span></span><br><span class="line">        <span class="keyword">return</span> dp[x] + Cal(x + <span class="number">1</span>, r) + ex;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">auto</span> Check = [&amp;](<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> r)&#123;</span><br><span class="line">        li v1 = calc(x, r), v2 = calc(y, r);</span><br><span class="line">        <span class="keyword">if</span>(v1 == v2) <span class="keyword">return</span> cnt[x] &lt; cnt[y];</span><br><span class="line">        <span class="keyword">return</span> v1 &lt; v2;</span><br><span class="line">    &#125;;</span><br><span class="line">    he = ta = <span class="number">1</span>;</span><br><span class="line">    Q[<span class="number">1</span>] = dp[<span class="number">0</span>] = <span class="number">0</span>; Le[<span class="number">1</span>] = <span class="number">1</span>; Ri[<span class="number">1</span>] = n; cnt[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        <span class="keyword">while</span>(he &lt;= ta &amp;&amp; Ri[he] &lt; i)he++;</span><br><span class="line">        dp[i] = calc(Q[he], i);</span><br><span class="line">        <span class="comment">// cout &lt;&lt; dp[i] &lt;&lt; endl;</span></span><br><span class="line">        cnt[i] = cnt[Q[he]] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(he &lt;= ta &amp;&amp; Check(i, Q[ta], Le[ta])) ta--;</span><br><span class="line">        <span class="keyword">int</span> l = Le[ta], r = n, ans = r + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(Check(i, Q[ta], mid)) ans = mid, r = mid - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(l &lt;= n)</span><br><span class="line">            Q[++ta] = i, Le[ta] = ans, Ri[ta] = n, Ri[ta - <span class="number">1</span>] = ans - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n = input(), k = input();</span><br><span class="line">    fore(i, <span class="number">1</span>, n) A[i] = input(), S[i] = A[i] + S[i - <span class="number">1</span>];</span><br><span class="line">    li L = <span class="number">0</span>, R = S[n], ans;</span><br><span class="line">    <span class="keyword">while</span>(L &lt;= R)&#123;</span><br><span class="line">        li mid = (L + R) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(Solve(mid) &lt;= k) ans = mid, R = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> L = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Solve(ans);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>, dp[n] - L * k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="【luogu-P2619】-国家集训队2-Tree-I-1"><a href="#【luogu-P2619】-国家集训队2-Tree-I-1" class="headerlink" title="【luogu P2619】[国家集训队2]Tree I"></a>【luogu P2619】[国家集训队2]Tree I</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EP emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e4</span> + <span class="number">5</span>, MAXM = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o; <span class="keyword">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>)</span><br><span class="line">        f |= (c == <span class="string">'-'</span>), c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> f ? -o : o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> val, val0, u, v, ty;</span><br><span class="line">    node()&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        u = input() + <span class="number">1</span>; v = input() + <span class="number">1</span>;</span><br><span class="line">        val0 = input(); ty = <span class="number">1</span> - input();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;eg[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, k, fa[MAXN], res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Getf</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> fa[x] == x ? x : (fa[x] = Getf(fa[x]));&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Check</span><span class="params">(<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">    fore(i, <span class="number">1</span>, m)</span><br><span class="line">        <span class="keyword">if</span>(eg[i].ty) eg[i].val = eg[i].val0 + a;</span><br><span class="line">        <span class="keyword">else</span> eg[i].val = eg[i].val0;</span><br><span class="line">    sort(eg + <span class="number">1</span>, eg + m + <span class="number">1</span>, [](node a, node b)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a.val != b.val)<span class="keyword">return</span> a.val &lt; b.val;</span><br><span class="line">        <span class="keyword">return</span> a.ty &gt; b.ty;</span><br><span class="line">    &#125;);</span><br><span class="line">    fore(i, <span class="number">1</span>, n) fa[i] = i;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>; res = <span class="number">0</span>;</span><br><span class="line">    fore(i, <span class="number">1</span>, m)&#123;</span><br><span class="line">        <span class="keyword">int</span> fx = Getf(eg[i].u), fy = Getf(eg[i].v);</span><br><span class="line">        <span class="keyword">if</span>(fx != fy)&#123;</span><br><span class="line">            res += eg[i].val;</span><br><span class="line">            cnt += eg[i].ty;</span><br><span class="line">            fa[fx] = fy;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt &gt;= k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n = input(), m = input(), k = input();</span><br><span class="line">    fore(i, <span class="number">1</span>, m) eg[i].inp();</span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">-101</span>, r = <span class="number">101</span>, mid;</span><br><span class="line">    <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">        mid = (l + r + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(Check(mid)) l = mid;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Check(l);</span><br><span class="line">    <span class="comment">// cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; " " &lt;&lt; Check(l) &lt;&lt; endl;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>, res - k * l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="【luoguP3620】-APIO-CTSC-2007-数据备份-1"><a href="#【luoguP3620】-APIO-CTSC-2007-数据备份-1" class="headerlink" title="【luoguP3620】[APIO/CTSC 2007]数据备份"></a>【luoguP3620】[APIO/CTSC 2007]数据备份</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> o; <span class="keyword">char</span> c = getchar();</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">li ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> cnt[MAXN][<span class="number">2</span>], n;</span><br><span class="line">li k, use[MAXN], f[MAXN][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BET</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(f[p][<span class="number">0</span>] == f[p][<span class="number">1</span>]) <span class="keyword">return</span> cnt[p][<span class="number">1</span>] &lt; cnt[p][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> f[p][<span class="number">1</span>] &lt; f[p][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(li ex)</span></span>&#123;</span><br><span class="line">    f[<span class="number">1</span>][<span class="number">0</span>] = cnt[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    f[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1e18</span>; cnt[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1e9</span>;</span><br><span class="line">    fore(i, <span class="number">2</span>, n)&#123;</span><br><span class="line">        f[i][<span class="number">0</span>] = f[i - <span class="number">1</span>][BET(i - <span class="number">1</span>)];</span><br><span class="line">        cnt[i][<span class="number">0</span>] = cnt[i - <span class="number">1</span>][BET(i - <span class="number">1</span>)];</span><br><span class="line">        f[i][<span class="number">1</span>] = f[i - <span class="number">1</span>][<span class="number">0</span>] + use[i] - use[i - <span class="number">1</span>] - ex;</span><br><span class="line">        cnt[i][<span class="number">1</span>] = cnt[i - <span class="number">1</span>][<span class="number">0</span>] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> nb = BET(n);</span><br><span class="line">    f[n][<span class="number">0</span>] = f[n][nb];</span><br><span class="line">    cnt[n][<span class="number">0</span>] = cnt[n][nb];</span><br><span class="line">    <span class="keyword">return</span> cnt[n][<span class="number">0</span>] &lt;= k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r", stdin);</span></span><br><span class="line">    n = input(); k = input();</span><br><span class="line">    li l = <span class="number">0</span>, r = <span class="number">0</span>, mid;</span><br><span class="line">    fore(i, <span class="number">1</span>, n) use[i] = input(), r += use[i];</span><br><span class="line">    <span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(check(mid)) l = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    check(r);</span><br><span class="line">    <span class="comment">// cout &lt;&lt; r &lt;&lt; endl;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>, f[n][<span class="number">0</span>] + r * k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/23/WT01-H-Celeste-%E6%BD%98%E6%9B%B2%E9%98%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/01/23/WT01-H-Celeste-%E6%BD%98%E6%9B%B2%E9%98%B3/" itemprop="url">WT01-H-Celeste-潘曲阳</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-01-23T15:21:38+08:00">
                2021-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="L-Bit-Sequence"><a href="#L-Bit-Sequence" class="headerlink" title="L.Bit Sequence"></a>L.Bit Sequence</h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>定义 $f(x)$ 为 $x$ 二进制中1的个数</p>
<p>给定一个长度为 $m\leq 100$ 的01序列 $\{a_i\}$ ，问对于所有的 $x\in<a href="L\leq 10^{18}">0,L</a>$ ，有多少 $x$ 满足:$\forall i\in[0,m-1],f(x+i)\mod 2=a_i$</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>首先观察 $f(x)$ 的性质，显然对于 $x\in[0,2^k)$ ，$f(x+2^k) = f(x) + 1$ ， 那么 $f(x+2^k)\mod 2=f(x)\mod2 \oplus 1$</p>
<p>于是我们可以用倍增处理出 $f(x)\mod 2$ </p>
<p>令序列 $R$ 为 $x\in[0,2^k]$ 的$f(x) \mod 2$ 序列，$\overline R$ 为 $R$ 取反，那么 $x\in[0,2^{k+1})$ 对应的序列即为 $R\overline R$ ，也就是说我们需要储存 $R$ 和 $\overline R$ 才能够进行倍增处理。</p>
<p>再考虑 $\{a_i\}$ 的匹配贡献， $R\overline R$ 的贡献等于 $R$ 的贡献+$\overline R$ 的贡献+$R\overline R$ 交界处的贡献，所以实际上我们并不需要完全知道 $R$ 和 $\overline R$ ，我们只需要知道交界处是否产生新贡献即可，又注意到 $m\leq 100$，所以我们令 $R=A…B$ （其中 $A$ ， $B$ 为 $R$ 的前后各100位），我们实际上只需要记录 $A,B$ 即可，倍增计算时计算交界处 $B\overline A$ 的跨区间贡献。</p>
<p>假设 $L=2^{60} + 2^{30} + 2^{4}$ ，那么我们计算的结果为 $2^{60}$ 的正贡献和 $2^{30}$ 次方的反贡献（因为 $2^{30}$ 前面有个 $2^{60}$ ）组合的贡献，最后暴力在结尾加上 $2^4$ 的贡献即可</p>
<p>复杂度 $O(m^2logL)$</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/19/ICPC-%E6%B5%8E%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/01/19/ICPC-%E6%B5%8E%E5%8D%97/" itemprop="url">ICPC-济南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-01-19T20:17:19+08:00">
                2021-01-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ICPC/" itemprop="url" rel="index">
                    <span itemprop="name">ICPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="A-Matrix-Equation"><a href="#A-Matrix-Equation" class="headerlink" title="A.Matrix Equation"></a>A.Matrix Equation</h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>给两个大小为 $n\times n(n\leq 200)$ 的01矩阵 $A,B$，求一个01矩阵 $C$ ，满足</p>
<p>$A\times C=B\cdot C$</p>
<p>定义 </p>
<p>$A\times C=(Z_{i, j}=\sum\limits_{k=1}^{n}A_{i,k}C_{k,j}\mod 2)_{n\times n}$</p>
<p>$B\cdot C=(Z_{i,j}=B_{i,j}C_{i,j})_{n\times n}$</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>左边是异或和，右边是或</p>
<p>按列处理，令 $\vec{X_i}$ 为 $X$ 的第 $i$ 列</p>
<p>则有 $A\times \vec{C_j} = \vec{B_j}\cdot \vec{C_j}$</p>
<p>进一步考虑化简 $\vec{B_j}$</p>
<p>再按行分解 $A$ ，令 $\vec{A^i}$ 为 $A$ 的第 $i$ 行</p>
<p>则有 $\vec{A^i} \times \vec{C_j} = B_{i,j}\cdot C_{i,j}$</p>
<p>右边移到左边，则引入 $A’$</p>
<p>$\vec{A’^i}$ ，其中 $A’_{i,j}=A_{i,j}(i\neq j),A’_{i,i}=A_{i,i} \otimes \vec{B_{j}}_i$</p>
<p>最终得到异或方程组 $A’ \times \vec{C_j}=0$</p>
<p>用bitset加速 复杂度 $O(\frac{n^4}{64})$</p>
<h1 id="D-Fight-against-involution"><a href="#D-Fight-against-involution" class="headerlink" title="D.Fight against involution"></a>D.Fight against involution</h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>反内卷</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>尽量使大的变小即可</p>
<h1 id="L-Bit-Sequence"><a href="#L-Bit-Sequence" class="headerlink" title="L.Bit Sequence"></a>L.Bit Sequence</h1><h2 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h2><p>定义 $f(x)$ 为 $x$ 二进制中1的个数</p>
<p>给定一个长度为 $m\leq 100$ 的01序列 $\{a_i\}$ ，问对于所有的 $x\in<a href="L\leq 10^{18}">0,L</a>$ ，有多少 $x$ 满足:$\forall i\in[0,m-1],f(x+i)\mod 2=a_i$</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>首先观察 $f(x)$ 的性质，显然对于 $x\in[0,2^k)$ ，$f(x+2^k) = f(x) + 1$ ， 那么 $f(x+2^k)\mod 2=f(x)\mod2 \oplus 1$</p>
<p>于是我们可以用倍增处理出 $f(x)\mod 2$ </p>
<p>令序列 $R$ 为 $x\in[0,2^k]$ 的$f(x) \mod 2$ 序列，$\overline R$ 为 $R$ 取反，那么 $x\in[0,2^{k+1})$ 对应的序列即为 $R\overline R$ ，也就是说我们需要储存 $R$ 和 $\overline R$ 才能够进行倍增处理。</p>
<p>再考虑 $\{a_i\}$ 的匹配贡献， $R\overline R$ 的贡献等于 $R$ 的贡献+$\overline R$ 的贡献+$R\overline R$ 交界处的贡献，所以实际上我们并不需要完全知道 $R$ 和 $\overline R$ ，我们只需要知道交界处是否产生新贡献即可，又注意到 $m\leq 100$，所以我们令 $R=A…B$ （其中 $A$ ， $B$ 为 $R$ 的前后各100位），我们实际上只需要记录 $A,B$ 即可，倍增计算时计算交界处 $B\overline A$ 的跨区间贡献。</p>
<p>假设 $L=2^{60} + 2^{30} + 2^{4}$ ，那么我们计算的结果为 $2^{60}$ 的正贡献和 $2^{30}$ 次方的反贡献（因为 $2^{30}$ 前面有个 $2^{60}$ ）组合的贡献，最后暴力在结尾加上 $2^4$ 的贡献即可</p>
<p>复杂度 $O(m^2logL)$</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">潘曲阳 朱霖淇 刘浩钊</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">潘曲阳 朱霖淇 刘浩钊</span>

  
</div>

<!--

  <div class="powered-by">Powered by <a>HAHA  </a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>

-->



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  


  

  <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
  <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
  <script async src="/js/cursor/explosion.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
