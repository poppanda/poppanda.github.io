<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Railroad Guerrilla">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Railroad Guerrilla">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="潘曲阳 朱霖淇 刘浩钊">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Railroad Guerrilla</title>
  








<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Railroad Guerrilla</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录竞赛生涯</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Categories
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/15/ICPC-%E9%A6%99%E6%B8%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/15/ICPC-%E9%A6%99%E6%B8%AF/" itemprop="url">ICPC-香港</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-15T17:42:53+08:00">
                2020-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ICPC/" itemprop="url" rel="index">
                    <span itemprop="name">ICPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="A-Axis-of-Symmetry"><a href="#A-Axis-of-Symmetry" class="headerlink" title="A.Axis of Symmetry"></a><a href="https://codeforces.com/gym/102452/problem/A" target="_blank" rel="noopener">A.Axis of Symmetry</a></h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>给二维平面上 $n\leq 10^5$ 个无重叠的矩形，输出这些矩形合并成的图形的对称轴（只考虑形成的图形而不考虑相交处的顶点）</p>
<h2 id="题解-离散化-找规律"><a href="#题解-离散化-找规律" class="headerlink" title="题解:离散化+找规律"></a>题解:离散化+找规律</h2><p>将所有顶点处理出来，出现了偶数次的可以直接消除，出现奇数次的保留，我们就能够得到表示形成最终的图形所需要的边界的最小表示（每个点代表有一个转角，同一轴向上的两个点代表有直线）</p>
<p>找出对称轴，然后转一下，用map和原图形比较一下即可</p>
<h1 id="B-Binary-Tree"><a href="#B-Binary-Tree" class="headerlink" title="B.Binary Tree"></a><a href="https://codeforces.com/gym/102452/problem/B" target="_blank" rel="noopener">B.Binary Tree</a></h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>给一颗二叉树，每次操作仅能删除一颗完全二叉子树，最后一个操作的人胜，问谁胜</p>
<h2 id="题解-博弈"><a href="#题解-博弈" class="headerlink" title="题解:博弈"></a>题解:博弈</h2><p>每次操作必定删除奇数个点，奇偶判胜负</p>
<h2 id="C-Constructing-Ranches"><a href="#C-Constructing-Ranches" class="headerlink" title="C.Constructing Ranches"></a><a href="https://codeforces.com/gym/102452/problem/C" target="_blank" rel="noopener">C.Constructing Ranches</a></h2><h2 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h2><p>一棵树上有 $n\leq 2\cdot 10^5$ 个点，每个点存在一条木棍，长度随机，问有多少条简单路径包含的所有木棍可以围成一个凸多边形</p>
<h2 id="题解-点分治-排序统计"><a href="#题解-点分治-排序统计" class="headerlink" title="题解:点分治+排序统计"></a>题解:点分治+排序统计</h2><p>记根为 $rt$ ，路径的两个点为 $u, v$ ，点权为 $a$ ，$rt$ 到 $p$ 路径点权和为 $sum_p$， 路径最大值为 $mx_p$</p>
<p>显然点数要 $\geq 3$， 其次应有 $sum_u+sum_v-a_{rt} &gt; max(mx_u, mx_v)$ </p>
<p>我们根据 $mx$ 值对所有路径进行排序，即对于当前点 $u$， 当前计入统计的 $v$ 一定有 $mx_u\geq mx_v$</p>
<p>则我们需要统计的点 $v$ 满足 $sum_u-mx_u&gt;a_{rt}-sumv$</p>
<p>离散化用树状数组统计即可</p>
<p>然后把当前 $u$ 加入到统计的 $v$ 中即可</p>
<h1 id="D-Defining-Labels"><a href="#D-Defining-Labels" class="headerlink" title="D.Defining Labels"></a><a href="https://codeforces.com/gym/102452/problem/D" target="_blank" rel="noopener">D.Defining Labels</a></h1><h1 id="E-Erasing-Numbers"><a href="#E-Erasing-Numbers" class="headerlink" title="E.Erasing Numbers"></a><a href="https://codeforces.com/gym/102452/problem/E" target="_blank" rel="noopener">E.Erasing Numbers</a></h1><h2 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h2><p>有 $n\leq 5000且为奇数$ 个互不相等的数字，每次可以选择 3 个相邻的数字，然后擦去其中的最大值和最小值，剩下的数则继续连起来，最后会剩下一个数字。现在对于每个数字，输出它是否有可能留到最后</p>
<h2 id="题解-抽象化-贪心"><a href="#题解-抽象化-贪心" class="headerlink" title="题解:抽象化+贪心"></a>题解:抽象化+贪心</h2><p>将区间以当前讨论的数字为中心分为左右两部分，所有数值大于它的数字变为1，其它的变为0。</p>
<p>由观察可得，最后剩下的另外两个数字为01时（无论位置在哪）都可行</p>
<p>还有如下规律 $001\to 0$ $011\to 1$ $000\to 0$ $111\to 1$ </p>
<p>进一步由上面两个规律推广，最后剩下的0和1数量相等时必定可行。</p>
<p>由上面性质进行模拟，尽量使多的数字减少即可</p>
<h1 id="G-Game-Design"><a href="#G-Game-Design" class="headerlink" title="G.Game Design"></a><a href="https://codeforces.com/gym/102452/problem/G" target="_blank" rel="noopener">G.Game Design</a></h1><h1 id="H-Hold-the-Line"><a href="#H-Hold-the-Line" class="headerlink" title="H.Hold the Line"></a><a href="https://codeforces.com/gym/102452/problem/H" target="_blank" rel="noopener">H.Hold the Line</a></h1><h1 id="I-Incoming-Asteroids"><a href="#I-Incoming-Asteroids" class="headerlink" title="I.Incoming Asteroids"></a><a href="https://codeforces.com/gym/102452/problem/I" target="_blank" rel="noopener">I.Incoming Asteroids</a></h1><h1 id="J-Junior-Mathematician"><a href="#J-Junior-Mathematician" class="headerlink" title="J.Junior Mathematician"></a><a href="https://codeforces.com/gym/102452/problem/J" target="_blank" rel="noopener">J.Junior Mathematician</a></h1><h1 id="K-Key-Project"><a href="#K-Key-Project" class="headerlink" title="K.Key Project"></a><a href="https://codeforces.com/gym/102452/problem/K" target="_blank" rel="noopener">K.Key Project</a></h1>
          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/01/SEERC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/01/SEERC/" itemprop="url">SEERC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-01T14:47:14+08:00">
                2020-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ICPC/" itemprop="url" rel="index">
                    <span itemprop="name">ICPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="A-Max-or-Min"><a href="#A-Max-or-Min" class="headerlink" title="A.Max or Min"></a><a href="https://codeforces.com/gym/102392/problem/A" target="_blank" rel="noopener">A.Max or Min</a></h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>对于一个环形数列 ($n\leq 2\cdot 10^5$) ，对于每个数有两类操作：1、将它变为以它为中心的三个数的最小值 2、将它变为以它为中心的三个数的最大值</p>
<p>问对于数字 $x$ 从1 到 $m\leq 2\cdot 10^5 $ ，将这个数列全部变成 $x$ 需要最少多少次操作。</p>
<h2 id="题解-找规律-线段树"><a href="#题解-找规律-线段树" class="headerlink" title="题解 : 找规律+线段树"></a>题解 : 找规律+线段树</h2><h3 id="规律"><a href="#规律" class="headerlink" title="规律"></a>规律</h3><p>对于 $x$ ，我们将数字分为大于等于小于它，将所有等于它的数字抽象为 $0$ ，大于它的数字抽象为 $1$ ，小于它的数字抽象为 $-1$ 。 那么我们可以将整个数列以 $0$ 为端点分为若干部分：</p>
<p> 对于类似于 $[0,1,1,1,0]$ 和 $[0,-1,-1,-1,0]$ 这样的数列，显然操作数等于非零数字的个数。</p>
<p> 对于 $[0, 1, 1, -1, -1, 0]$ 这样子的数列，我们在 $[1, -1]$ 处需要多使用一个操作。 类似的，对于多个连续的 $[1,1,-1,-1,1,1,-1]$ 我们需要的额外操作数为 $[1, -1]$ 和 $[-1,1]$ 的数量。</p>
<p>而对于 $[0,1, -1, 1, -1, 1,0]$ 这样反复横跳的例子，显然将 $1$ 和 $-1$ 中更少的那一部分先取 最大/最小 然后再进行操作是最优的，对于上述例子，就是先进行两个操作将数列变为$[0,1,1,1,1,1,0]$ 然后再操作。此时需要的额外操作数为 $\lfloor\frac{区间长度}{2}\rfloor$ 。为了方便维护，我们可以使用容斥将这一步与上一步合起来。</p>
<blockquote>
<p>当前操作中，每一次的操作都能够减少一次第二类操作</p>
</blockquote>
<p>因此最终的表示式为 $操作数=非零数+[-1,1]数+[1,-1]数-\sum\lfloor\frac{斑马线长度}{2}\rfloor$</p>
<h3 id="维护"><a href="#维护" class="headerlink" title="维护"></a>维护</h3><p>我们从小到大依次改变数列中的 $-1, 0, 1$ ， 其中表达式中的前三个数我们在改变过程中即可得到，而最后一个数需要用线段树维护，具体维护见代码</p>
<h1 id="B-Level-Up"><a href="#B-Level-Up" class="headerlink" title="B.Level Up"></a><a href="https://codeforces.com/gym/102392/problem/B" target="_blank" rel="noopener">B.Level Up</a></h1><p><em>Sumail版本</em></p>
<h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p>现在有 $n\leq 500$ 个任务，每个任务完成后可以获得经验升级，而在不同等级做同样的任务需要的时间和获得的竟然不同。对于每个任务有四个权值 $x, t, y, r$ 分别代表在0级时完成任务获得的经验，需要的时间和在1级时完成任务获得的经验、需要的时间。 现在告诉你升到一级和二级需要的经验值 $s_1,s_2\leq 500$ ，问最少需要多少时间才能升到2级。</p>
<h2 id="题解-DP"><a href="#题解-DP" class="headerlink" title="题解: DP"></a>题解: DP</h2><p>对任务的经验值从小到大排序，然后分别考虑0级和1级时做任务的转移， $O(n^3)$ 讨论即可。</p>
<p><em>zlq版本</em></p>
<p>对于能升第一级的一些任务, 把涨经验最多的排在后面一定是合法的, 否则不一定, 会出现提前升级的情况, 所以要先按第一级经验排序再 dp.</p>
<h1 id="C-Find-the-Array"><a href="#C-Find-the-Array" class="headerlink" title="C.Find the Array"></a><a href="https://codeforces.com/gym/102392/problem/C" target="_blank" rel="noopener">C.Find the Array</a></h1><h2 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h2><p>有一个未知的数列，告诉你它的长度 $n\leq 250$ 。现在有两类询问1、询问某个特定点的值 2、询问某些数，最终会返回这些数两两之差的绝对值。现在要求通过少于30次询问，求出数列的所有值。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>首先，可以通过 $O(logn)$ 的操作找到包含左端点、最小值、最大值的最短区间（查询是否包含最大差值），其中该区间的右端点即为数列的最小值或最大值，想要验证它是最大值还是最小值可以通过两次1类询问。</p>
<p>而后通过两次二类询问找到所有的点和该极值的差值，具体操作为一次二类询问，询问所有点；一次二类询问，询问除了极值点外的所有点，得到的两个集合求差，我们将这类操作定义为求这些点和极值点的差值。这样我们得到的集合定义为 $A$ 。</p>
<p>最后我们通过二进制编码来划分所有的点，我们分别将标号二进制编码中包含 $2^i$ 的点的与极值的差值的集合找出来，将之定义为 $B_{i1}$，将不包含 $2^i$ 的点定义为 $B_{i_0}$ ，显然有 $B_{i1}\cup B_{i0}=A$。</p>
<blockquote>
<p>举个例子，对于 $n = 8 = (1000)_2$ ， $B_1$ 中包含的点为 $\{2=(10)_2,6=(110)_2\}$</p>
</blockquote>
<p>对于一个非极值点 $x=b^0b^1…b^m$ ，它与极值的差为 $\bigcap\limits_{i} B_{ib^i}$ 的唯一值</p>
<h1 id="D-Cycle-String"><a href="#D-Cycle-String" class="headerlink" title="D.Cycle String?"></a><a href="https://codeforces.com/gym/102392/problem/D" target="_blank" rel="noopener">D.Cycle String?</a></h1><h2 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h2><p>对于一个长度为 $2\cdot n$ 的环形串，如果它的所有长度为 $n$ 的子串均无重复，那么我们定义它为 $Cycle String$ ，现给一个长度为 $2\cdot n$ 的串，试将它变为一个 $CycleString$ ，如果不能变为 $CycleString$ 输出NO。</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>对于字符串中单个字符出现超过 $2n-2$ 次，那么一定无解</p>
<p>如果出现 $2n-2$ 次，串的长度大于 4 且 仅有两种字符，也一定无解</p>
<p>否则有解，构造时从小到大排列字符，同时注意一种字符串不能连续出现超过 $n$ 次。</p>
<h1 id="E-Life-Transfer"><a href="#E-Life-Transfer" class="headerlink" title="E.Life Transfer"></a><a href="https://codeforces.com/gym/102392/problem/E" target="_blank" rel="noopener">E.Life Transfer</a></h1><p>暴力模拟汽车数从0到最多，然后求个最小值即可</p>
<h1 id="F-Game-on-a-Tree"><a href="#F-Game-on-a-Tree" class="headerlink" title="F.Game on a Tree"></a><a href="https://codeforces.com/gym/102392/problem/F" target="_blank" rel="noopener">F.Game on a Tree</a></h1><h3 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h3><p>给定一个有根树, 二人博弈, 每次选择一个未被染色的点染色, 并且必须是对方上次选择的点的祖先或子孙. 先手第一次任意选择. 问胜利方.</p>
<h3 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h3><p>首先要知道二分图博弈的结论, 即最大匹配占满所有点时后手胜, 否则先手胜. 把原问题的树上所有有祖孙关系的点都连边. 但这个时候图很大, 不现实.</p>
<p>$dp[i]$ 为以 $i$ 为根节点的子树, 在新图中跑二分图最大匹配还剩多少个点. 转移时, 如果儿子都匹配满了, 就剩自己一个点, $dp[i]=1$; 否则, 可以把当前节点和一个空闲的子孙匹配, 而不同子树的点不能匹配, $dp[i]=\sum dp[son] - 1$. 最后答案就看 $dp[1]$ 是否为 $0$.</p>
<h1 id="G-Projection"><a href="#G-Projection" class="headerlink" title="G.Projection"></a><a href="https://codeforces.com/gym/102392/problem/G" target="_blank" rel="noopener">G.Projection</a></h1><p><em>Sumail版本</em></p>
<h2 id="题意-5"><a href="#题意-5" class="headerlink" title="题意"></a>题意</h2><p>给定一个三维方块图形的左视图和正视图，问使得图形方块数最少和最多的方案是什么。</p>
<h2 id="题解-模拟"><a href="#题解-模拟" class="headerlink" title="题解:模拟"></a>题解:模拟</h2><p>显然对于一个宽为 $w$ 长为 $l$ 的投影，方块数最大为平面，最小为相互垂直的线段</p>
<p><em>zlq版本</em></p>
<h3 id="题意-6"><a href="#题意-6" class="headerlink" title="题意"></a>题意</h3><p>有一个由若干小正方体组成的物体, 给出他的正视图和左视图, 求最小和最大体积的方案, 并要求字典序最小.</p>
<h3 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h3><p>每一个高度是独立的, 所以分层看. 最大体积显然就是正视图和左视图里尽可能塞正方体, 最小体积就是正视图和左视图取最大值, 由于字典序要最小所以多出来的小正方体要放在合适的地方, 贪心即可.</p>
<h1 id="I-Absolute-Game"><a href="#I-Absolute-Game" class="headerlink" title="I.Absolute Game"></a><a href="https://codeforces.com/gym/102392/problem/I" target="_blank" rel="noopener">I.Absolute Game</a></h1><h3 id="题意-7"><a href="#题意-7" class="headerlink" title="题意"></a>题意</h3><p>两人各自有一个数组, 每次删掉自己的数组中的一个元素, 直到数组只剩一个数, 先手方要最大化两个数组剩下的数的差, 而后手方要最小化. 问答案.</p>
<h2 id="题解-博弈"><a href="#题解-博弈" class="headerlink" title="题解:博弈"></a>题解:博弈</h2><p>a 数组里每一个数在 b 数组中都有一个距离最近的数, 不妨标记起来(如果有多个只标记一个), 这样先手删掉一个数之后, b 数组里至少有一个没被标记的数, 后手就删掉这样的数. 最后 a 只剩一个数时 b 剩的数就是被标记的, 即最近的数,所以先手每次都删掉那些 $min_{j} |a_i-b_j|$ 小的 $a_i$ 来最大化结果, 后手每次删未标记的数来最小化结果. 最终结果就是 $</p>
<h1 id="J-Graph-and-Cycles"><a href="#J-Graph-and-Cycles" class="headerlink" title="J.Graph and Cycles"></a><a href="https://codeforces.com/gym/102392/problem/J" target="_blank" rel="noopener">J.Graph and Cycles</a></h1><h2 id="题意-8"><a href="#题意-8" class="headerlink" title="题意"></a>题意</h2><p>对一张完全图，点数$n\leq 999$ 且为奇数，将其分解为若干环，将分解的权值定义为每个环中相邻两条边中较大权值之和。问分解的最小权值是多少</p>
<h2 id="题解-贪心"><a href="#题解-贪心" class="headerlink" title="题解:贪心"></a>题解:贪心</h2><p>首先我们要知道分解是自洽的，对于每个点，我们选择与该点相邻的两条边作为某个环的一部分，无需考虑环的整体，这样任意地选择之后一定能将它分解成环（路径上任意一个点的度数为偶数，则该路径一定构成环）。因此我们只需要在选择相邻的两条边时使得贡献尽量小即可，具体做法是将边从大到小排序，每次取剩余边中最大的两条边组合。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> las(x) (x == 0 ? n - 1 : x - 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> nex(x) (x == n - 1 ? 0 : x + 1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">3</span>)+(o &lt;&lt; <span class="number">1</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;pos[MAXN];</span><br><span class="line"><span class="keyword">int</span> v[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> mid ((l + r) &gt;&gt; 1)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> ls (o &lt;&lt; 1)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> rs (o &lt;&lt; 1 | 1)</span></span><br><span class="line">    <span class="keyword">int</span> NL, P, V, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> mi[MAXN &lt;&lt; <span class="number">3</span>], le[MAXN &lt;&lt; <span class="number">3</span>], ri[MAXN &lt;&lt; <span class="number">3</span>], cnt[MAXN &lt;&lt; <span class="number">3</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        mi[o] = mi[ls] + mi[rs];</span><br><span class="line">        cnt[o] = cnt[ls] + cnt[rs];</span><br><span class="line">        <span class="keyword">if</span>((v[mid] * v[mid + <span class="number">1</span>] == <span class="number">-1</span>) &amp;&amp; (ri[ls] != (mid - l + <span class="number">1</span>)) &amp;&amp; (le[rs] != (r - mid)))</span><br><span class="line">        &#123;</span><br><span class="line">            mi[o] += ri[ls] + le[rs];</span><br><span class="line">            cnt[o] += (ri[ls] + le[rs] - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            le[o] = le[ls];</span><br><span class="line">            ri[o] = ri[rs];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(v[mid] * v[mid + <span class="number">1</span>] != <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                cnt[o] += (ri[ls] != (mid - l + <span class="number">1</span>) ? (ri[ls] - <span class="number">1</span>)/<span class="number">2</span> : <span class="number">0</span>) + ((le[rs] != r - mid) ? (le[rs] - <span class="number">1</span>)/<span class="number">2</span> : <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            le[o] = le[ls] + ((le[ls] == mid - l + <span class="number">1</span> &amp;&amp; v[mid] * v[mid + <span class="number">1</span>] == <span class="number">-1</span>)? le[rs] : <span class="number">0</span>);</span><br><span class="line">            ri[o] = ri[rs] + ((ri[rs] == r - mid &amp;&amp; v[mid] * v[mid + <span class="number">1</span>] == <span class="number">-1</span>)? ri[ls] : <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">            v[l] = <span class="number">1</span>;</span><br><span class="line">            le[o] = ri[o] = <span class="number">1</span>;</span><br><span class="line">            mi[o] = cnt[o] = <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            init(ls, l, mid);</span><br><span class="line">            init(rs, mid + <span class="number">1</span>, r);</span><br><span class="line">            merge(o, l, r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modi</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">            v[l] = V;</span><br><span class="line">            <span class="keyword">if</span>(!V) le[o] = ri[o] = mi[o] = cnt[o] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                le[o] = ri[o] = <span class="number">1</span>;</span><br><span class="line">                mi[o] = cnt[o] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(P &lt;= mid) modi(ls, l, mid);</span><br><span class="line">            <span class="keyword">else</span> modi(rs, mid + <span class="number">1</span>, r);</span><br><span class="line">            merge(o, l, r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Modi</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> nv)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> lasv = v[p];</span><br><span class="line">        <span class="keyword">if</span>(lasv != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(v[las(p)] * lasv == <span class="number">-1</span>) res--;</span><br><span class="line">            <span class="keyword">if</span>(v[nex(p)] * lasv == <span class="number">-1</span>) res--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nv != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(v[las(p)] * nv == <span class="number">-1</span>) res++;</span><br><span class="line">            <span class="keyword">if</span>(v[nex(p)] * nv == <span class="number">-1</span>) res++;</span><br><span class="line">        &#125;</span><br><span class="line">        P = p; V = nv;</span><br><span class="line">        modi(<span class="number">1</span>, <span class="number">0</span>, NL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">CAL</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> res - (cnt[<span class="number">1</span>] + ((v[<span class="number">0</span>]*v[NL] == <span class="number">-1</span> &amp;&amp; (mi[<span class="number">1</span>] != n))? (le[<span class="number">1</span>] + ri[<span class="number">1</span>] - <span class="number">1</span>)/<span class="number">2</span> : ((le[<span class="number">1</span>] - <span class="number">1</span>)/<span class="number">2</span> + (ri[<span class="number">1</span>] - <span class="number">1</span>)/<span class="number">2</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> mid</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> ls</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">undef</span> rs</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n = input(), m = input();</span><br><span class="line">    SGT::NL = n - <span class="number">1</span>;</span><br><span class="line">    SGT::init(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    Fore(i, <span class="number">0</span>, n)</span><br><span class="line">        pos[input()].emplace_back(i);</span><br><span class="line">    fore(i, <span class="number">1</span>, m)&#123;</span><br><span class="line">        <span class="keyword">if</span>(pos[i].size() == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"-1 "</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> v:pos[i]) SGT::Modi(v, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lu "</span>, n - pos[i].size() + SGT::CAL());</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> v:pos[i]) SGT::Modi(v, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ti tuplt<span class="meta-string">&lt;int,int,int,int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">505</span>;</span><br><span class="line"><span class="keyword">const</span> li INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">3</span>)+(o &lt;&lt; <span class="number">1</span>)+ c- <span class="number">48</span>;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, t, y, r;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inp</span><span class="params">()</span></span>&#123;x = input(); t = input(); y = input(); r = input();&#125;</span><br><span class="line">&#125;node[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(Node &amp;A, Node &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(A.x != B.x)<span class="keyword">return</span> A.x &lt; B.x;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> A.y &lt; B.y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">li dp[<span class="number">2</span>][MAXN][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = input(), S1 = input(), S2 = input();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)node[i].inp();</span><br><span class="line">    sort(node + <span class="number">1</span>, node + n + <span class="number">1</span>, comp);</span><br><span class="line">    <span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span>(dp));</span><br><span class="line">    <span class="keyword">int</span> ss1, ss2;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(dp[i&amp;<span class="number">1</span>], <span class="number">0x3f</span>, <span class="keyword">sizeof</span>(dp[i&amp;<span class="number">1</span>]));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> t = i &amp; <span class="number">1</span>, s1 = S1; s1 &gt;= <span class="number">0</span>; s1--)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> s2 = S2; s2 &gt;= <span class="number">0</span>; s2--)</span><br><span class="line">            <span class="keyword">if</span>(dp[t^<span class="number">1</span>][s1][s2] != INF)</span><br><span class="line">            &#123;</span><br><span class="line">                dp[t][s1][s2] = dp[t^<span class="number">1</span>][s1][s2];</span><br><span class="line">                <span class="keyword">if</span>(s1 != S1)</span><br><span class="line">                &#123;</span><br><span class="line">                    ss1 = min(S1, s1 + node[i].x);</span><br><span class="line">                    ss2 = min(S2, max(s1 + node[i].x - S1, <span class="number">0</span>) + s2);</span><br><span class="line">                    dp[t][ss1][ss2] = min(dp[t][ss1][ss2], dp[t ^ <span class="number">1</span>][s1][s2] + node[i].t);</span><br><span class="line">                &#125;</span><br><span class="line">                ss1 = s1; ss2 = min(S2, s2 + node[i].y);</span><br><span class="line">                dp[t][ss1][ss2] = min(dp[t][ss1][ss2], dp[t^<span class="number">1</span>][s1][s2] + node[i].r);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dp[n &amp; <span class="number">1</span>][S1][S2] != INF) <span class="built_in">printf</span>(<span class="string">"%lld"</span>, dp[n &amp; <span class="number">1</span>][S1][S2]);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; all, use[<span class="number">11</span>][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> v0, res[<span class="number">300</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">INP</span><span class="params">(<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;des)</span></span>&#123;</span><br><span class="line">    des.clear();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> nv, i = <span class="number">1</span>; i &lt;= (n - <span class="number">1</span>) * n / <span class="number">2</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; nv;</span><br><span class="line">        des.emplace_back(nv);;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(des.begin(), des.end());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DEC</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; A, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; B, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;C)</span></span>&#123;</span><br><span class="line">    C.clear();</span><br><span class="line">    <span class="keyword">while</span>(A.size())&#123;</span><br><span class="line">        <span class="keyword">while</span>(B.size() &amp;&amp; B.back() &gt; A.back()) B.pop_back();</span><br><span class="line">        <span class="keyword">while</span>(A.size() &amp;&amp; B.size() &amp;&amp; B.back() == A.back())</span><br><span class="line">        &#123;</span><br><span class="line">            B.pop_back();</span><br><span class="line">            A.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(A.size() &amp;&amp; (B.empty() || (A.back() &gt; B.back())))&#123;</span><br><span class="line">            C.emplace_back(A.back());</span><br><span class="line">            A.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(C.begin(), C.end());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">INTS</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; A, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; B, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;C)</span></span>&#123;</span><br><span class="line">    C.clear();</span><br><span class="line">    <span class="keyword">while</span>(A.size())&#123;</span><br><span class="line">        <span class="keyword">while</span>(B.size() &amp;&amp; B.back() &gt; A.back()) B.pop_back();</span><br><span class="line">        <span class="keyword">while</span>(A.size() &amp;&amp; B.size() &amp;&amp; A.back() == B.back())&#123;</span><br><span class="line">            C.emplace_back(A.back());</span><br><span class="line">            A.pop_back();</span><br><span class="line">            B.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(A.size() &amp;&amp; (B.empty() || (A.back() &gt; B.back())))</span><br><span class="line">            A.pop_back();</span><br><span class="line">    &#125;</span><br><span class="line">    sort(C.begin(), C.end());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="number">2</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; n &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" \n"</span>[i == n];</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tempA, tempB;</span><br><span class="line">    INP(n, tempA);</span><br><span class="line">    <span class="keyword">int</span> mx = <span class="number">0</span>, L = <span class="number">1</span>, R = n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> v : tempA) mx = max(mx, v);</span><br><span class="line">    <span class="keyword">while</span>(L &lt; R)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (L + R) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="number">2</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; mid &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= mid; i++)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" \n"</span>[i == mid];</span><br><span class="line">        INP(mid, tempB);</span><br><span class="line">        <span class="keyword">int</span> nmx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> v : tempB) nmx = max(nmx, v);</span><br><span class="line">        <span class="keyword">if</span>(nmx == mx) R = mid;</span><br><span class="line">        <span class="keyword">else</span> L = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="number">2</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">if</span>(i != R)<span class="built_in">cout</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; i;<span class="comment">//printf(" %d", i);</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    INP(n - <span class="number">1</span>, tempB);</span><br><span class="line">    DEC(tempA, tempB, all);</span><br><span class="line">    <span class="keyword">return</span> R;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _init(<span class="keyword">int</span> n, <span class="keyword">int</span> pos)&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; pos &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; v0;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; ((pos == <span class="number">1</span>) ? n : <span class="number">1</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">int</span> nv;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; nv;</span><br><span class="line">    <span class="keyword">if</span>(nv &lt; v0) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>.flush();</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">30</span>)&#123;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; res[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="number">3</span> &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; res[i] &lt;&lt; <span class="string">" \n"</span>[i == n];</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pos = init(n), a = _init(n, pos);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; (<span class="number">1</span> &lt;&lt; i) &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;temp, tempA, tempB;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">            <span class="keyword">if</span>((j &amp; (<span class="number">1</span> &lt;&lt; i)) &amp;&amp; (j != pos)) temp.emplace_back(j);</span><br><span class="line">        <span class="keyword">if</span>(temp.size() &gt;= <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="number">2</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; temp.size();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> v : temp) <span class="built_in">cout</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; v; <span class="built_in">cout</span> &lt;&lt; <span class="string">'\n'</span>;<span class="comment">// printf(" %d", v); putchar('\n');</span></span><br><span class="line">            INP(temp.size(), tempA);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(temp.size() &gt;= <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="number">2</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; temp.size() + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> v : temp) <span class="built_in">cout</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; v; <span class="built_in">cout</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; pos &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">          	INP(temp.size() + <span class="number">1</span>, tempB);</span><br><span class="line">        &#125;</span><br><span class="line">        DEC(tempB, tempA, use[i][<span class="number">1</span>]);</span><br><span class="line">        DEC(all, use[i][<span class="number">1</span>], use[i][<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">if</span>(i != pos)&#123;</span><br><span class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; temp  = all;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; (<span class="number">1</span> &lt;&lt; j) &lt;= n; j++)</span><br><span class="line">                INTS(temp, use[j][(i &amp; (<span class="number">1</span> &lt;&lt; j)) != <span class="number">0</span>], temp);</span><br><span class="line">            res[i] = temp.back();</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"3 "</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; v0 + a * res[i] &lt;&lt; <span class="string">" \n"</span>[i == n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="D"><a href="#D" class="headerlink" title="D"></a>D</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXC = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Cnt[MAXC];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">string</span> s;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">	sort(s.begin(), s.end());</span><br><span class="line">	<span class="keyword">int</span> sz = s.size();</span><br><span class="line">	<span class="keyword">if</span>(sz == <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(s[<span class="number">0</span>] == s[<span class="number">1</span>]) <span class="built_in">puts</span>(<span class="string">"NO"</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"YES"</span>), <span class="built_in">cout</span> &lt;&lt; s &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> ncnt = <span class="number">1</span>, maxcnt = <span class="number">1</span>, mk = s[<span class="number">0</span>] - <span class="string">'a'</span>, n = sz&gt;&gt;<span class="number">1</span>, mkcnt = <span class="number">1</span>;</span><br><span class="line">	Cnt[s[<span class="number">0</span>]-<span class="string">'a'</span>]++;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; sz; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		Cnt[s[i] - <span class="string">'a'</span>]++;</span><br><span class="line">		<span class="keyword">if</span>(s[i] == s[i - <span class="number">1</span>])ncnt++;</span><br><span class="line">		<span class="keyword">else</span> ncnt = <span class="number">1</span>, mkcnt++;</span><br><span class="line">		<span class="keyword">if</span>(maxcnt &lt; ncnt) maxcnt = ncnt, mk = s[i] - <span class="string">'a'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(maxcnt &gt; sz - <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">"NO"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(sz &gt; <span class="number">4</span> &amp;&amp; maxcnt == sz - <span class="number">2</span> &amp;&amp; mkcnt == <span class="number">2</span>)&#123;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">"NO"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">"YES"</span>);</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(len &lt; sz)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> count = n, nex = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span>(count &amp;&amp; Cnt[mk])</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">putchar</span>(<span class="keyword">char</span>(mk + <span class="string">'a'</span>));</span><br><span class="line">				Cnt[mk]--;</span><br><span class="line">				count--;</span><br><span class="line">				len++;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">while</span>(nex &lt; <span class="number">26</span> &amp;&amp; (Cnt[nex] == <span class="number">0</span> || nex == mk))</span><br><span class="line">				nex++;</span><br><span class="line">			len++;</span><br><span class="line">			<span class="built_in">putchar</span>(<span class="string">'a'</span> + nex);</span><br><span class="line">			Cnt[nex]--;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="E"><a href="#E" class="headerlink" title="E"></a>E</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> li inf = <span class="number">1e18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">	<span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">	<span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">		o = (o &lt;&lt; <span class="number">3</span>)+(o &lt;&lt; <span class="number">1</span>)+(c - <span class="number">48</span>);</span><br><span class="line">	<span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">li n, k, lc, pc, lm, pm, t, d, mo, un, le, res;</span><br><span class="line">li A[MAXN];</span><br><span class="line"><span class="keyword">bool</span> mk[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ADD</span><span class="params">(li v, li t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(v &gt; lm) mo += t * min(d, v - lm);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(lm - v &gt; d)un += t;</span><br><span class="line">	<span class="keyword">else</span> le += t * (lm - v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DRI</span><span class="params">(li v)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(v &gt; lc) mo += min(d, v - lc);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(lc - v &gt; d) un ++;</span><br><span class="line">	<span class="keyword">else</span> le += lc - v; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PAS</span><span class="params">(li v)</span></span>&#123;mo += min(d, v - <span class="number">1</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	n = input(), k = input();</span><br><span class="line">	lc = input(), pc = input(), lm = input(), pm = input();</span><br><span class="line">	t = input(), d = input();</span><br><span class="line">	fore(i, <span class="number">1</span>, n) A[i] = input();</span><br><span class="line">	sort(A + <span class="number">1</span>, A + n + <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> dr = n, add = <span class="number">-1</span>;</span><br><span class="line">	fore(i, <span class="number">1</span>, n)</span><br><span class="line">		ADD(A[i], <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span>(un || (le &gt; mo)) res = inf;</span><br><span class="line">	<span class="keyword">else</span> res = t * le + n * pm;</span><br><span class="line">	li rest = n, j = <span class="number">1</span>, car = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(rest)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span>(mk[dr]) dr += add;</span><br><span class="line">		mk[dr] = <span class="number">1</span>;</span><br><span class="line">		ADD(A[dr], <span class="number">-1</span>);</span><br><span class="line">		DRI(A[dr]);</span><br><span class="line">		rest--;</span><br><span class="line">		li pas = k - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span>(rest &amp;&amp; j &lt;= n &amp;&amp; pas)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(!mk[j])</span><br><span class="line">			&#123;</span><br><span class="line">				mk[j] = <span class="number">1</span>;</span><br><span class="line">				ADD(A[j], <span class="number">-1</span>);</span><br><span class="line">				PAS(A[j]);</span><br><span class="line">				pas--;</span><br><span class="line">				rest--;</span><br><span class="line">			&#125;</span><br><span class="line">			j++;</span><br><span class="line">		&#125;</span><br><span class="line">		car++;</span><br><span class="line">		<span class="keyword">if</span>(le &lt;= mo &amp;&amp; (!un))res = min(res, car * pc + rest * pm + le * t);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(res == inf) <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld"</span>, res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="F"><a href="#F" class="headerlink" title="F"></a>F</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inc(x, l, r) for (int x = l; x &lt;= r; x++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, u, v, dp[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; g[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> par)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> son : g[x]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (son == par) <span class="keyword">continue</span>;</span><br><span class="line">        r += dfs(son, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (r)</span><br><span class="line">        r--;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        r = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> dp[x] = r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    inc(i, <span class="number">1</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;u, &amp;v);</span><br><span class="line">        g[u].push_back(v);</span><br><span class="line">        g[v].push_back(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dfs(<span class="number">1</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Alice\n"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Bob\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="G"><a href="#G" class="headerlink" title="G"></a>G</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inc(x,l,r) for(int x=l;x&lt;=r;x++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,m,h;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">105</span>][<span class="number">105</span>], b[<span class="number">105</span>][<span class="number">105</span>];</span><br><span class="line"><span class="keyword">char</span> ch[<span class="number">105</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> u,v,w;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;node&gt;p,q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;n, &amp;m, &amp;h);</span><br><span class="line">	inc(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>, ch);</span><br><span class="line">	 	inc(j,<span class="number">0</span>,m<span class="number">-1</span>)&#123;</span><br><span class="line">			a[i][j]=ch[j]-<span class="string">'0'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	inc(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>, ch);</span><br><span class="line">	 	inc(j,<span class="number">0</span>,h<span class="number">-1</span>)&#123;</span><br><span class="line">			b[i][j]=ch[j]-<span class="string">'0'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	inc(i,<span class="number">0</span>,n<span class="number">-1</span>)&#123;</span><br><span class="line">		inc(j,<span class="number">0</span>,m<span class="number">-1</span>) &#123;</span><br><span class="line">			inc(k,<span class="number">0</span>,h<span class="number">-1</span>)<span class="keyword">if</span>(a[i][j]&amp;&amp;b[i][k])p.push_back(&#123;i,j,k&#125;);</span><br><span class="line">		&#125;	</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;v1,v2;</span><br><span class="line">		inc(j,<span class="number">0</span>,m<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(a[i][j]) v1.push_back(j); </span><br><span class="line">		&#125;</span><br><span class="line">		inc(j,<span class="number">0</span>,h<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(b[i][j]) v2.push_back(j);</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">int</span> c1=v1.size(),c2=v2.size();</span><br><span class="line">		<span class="keyword">if</span>((c1&amp;&amp;!c2)||(c2&amp;&amp;!c1)) &#123;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="string">"-1\n"</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">if</span>(!c1&amp;&amp;!c2) &#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(c1&gt;c2) &#123;</span><br><span class="line">			inc(j,<span class="number">0</span>,c1-c2) q.push_back(&#123;i,v1[j],v2[<span class="number">0</span>]&#125;);</span><br><span class="line">			inc(j,c1-c2+<span class="number">1</span>,c1<span class="number">-1</span>) q.push_back(&#123;i,v1[j],v2[j-(c1-c2)]&#125;);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			inc(j,<span class="number">0</span>,c2-c1) q.push_back(&#123;i,v1[<span class="number">0</span>],v2[j]&#125;);</span><br><span class="line">			inc(j,c2-c1+<span class="number">1</span>,c2<span class="number">-1</span>) q.push_back(&#123;i,v1[j-(c2-c1)],v2[j]&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;p.size()&lt;&lt;<span class="string">"\n"</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> e:p)<span class="built_in">cout</span>&lt;&lt;e.u&lt;&lt;<span class="string">" "</span>&lt;&lt;e.v&lt;&lt;<span class="string">" "</span>&lt;&lt;e.w&lt;&lt;<span class="string">"\n"</span>;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;q.size()&lt;&lt;<span class="string">"\n"</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> e:q)<span class="built_in">cout</span>&lt;&lt;e.u&lt;&lt;<span class="string">" "</span>&lt;&lt;e.v&lt;&lt;<span class="string">" "</span>&lt;&lt;e.w&lt;&lt;<span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="I"><a href="#I" class="headerlink" title="I"></a>I</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inc(x,l,r) for(int x=l;x&lt;=r;x++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n,a[maxn],b[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">	inc(i,<span class="number">0</span>,n<span class="number">-1</span>)<span class="built_in">cin</span>&gt;&gt;a[i];</span><br><span class="line">	inc(i,<span class="number">0</span>,n<span class="number">-1</span>)<span class="built_in">cin</span>&gt;&gt;b[i];</span><br><span class="line">	sort(b,b+n);</span><br><span class="line">	<span class="keyword">int</span> r=<span class="number">0</span>;</span><br><span class="line">	inc(i,<span class="number">0</span>,n<span class="number">-1</span>)&#123;</span><br><span class="line">		<span class="keyword">int</span> p=lower_bound(b,b+n,a[i])-b;</span><br><span class="line">		<span class="keyword">int</span> mx=<span class="built_in">abs</span>(a[i]-b[p]);</span><br><span class="line">		<span class="keyword">if</span>(p)mx=min(mx,<span class="built_in">abs</span>(a[i]-b[p<span class="number">-1</span>]));</span><br><span class="line">		r=max(r,mx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;r&lt;&lt;<span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="J"><a href="#J" class="headerlink" title="J"></a>J</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">	<span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">	<span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">		o = (o &lt;&lt; <span class="number">3</span>)+(o &lt;&lt; <span class="number">1</span>)+(c - <span class="number">48</span>);</span><br><span class="line">	<span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> len[MAXN][MAXN];</span><br><span class="line"><span class="keyword">bool</span> mk[MAXN][MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; L[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = input(), m = n * (n - <span class="number">1</span>) / <span class="number">2</span>, u, v, l;</span><br><span class="line">	fore(i, <span class="number">1</span>, m)&#123;</span><br><span class="line">		u = input(); v = input(); l = input();</span><br><span class="line">		L[u].emplace_back(l);</span><br><span class="line">		L[v].emplace_back(l);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> res = <span class="number">0</span>;</span><br><span class="line">	fore(u, <span class="number">1</span>, n)</span><br><span class="line">	&#123;</span><br><span class="line">		sort(L[u].begin(), L[u].end());</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i += <span class="number">2</span>)</span><br><span class="line">			res += L[u][i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/21/CCPC%E7%BB%B5%E9%98%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/11/21/CCPC%E7%BB%B5%E9%98%B3/" itemprop="url">CCPC绵阳</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-21T14:59:52+08:00">
                2020-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CCPC/" itemprop="url" rel="index">
                    <span itemprop="name">CCPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="B-Building-Blocks"><a href="#B-Building-Blocks" class="headerlink" title="B.Building Blocks"></a><a href="https://codeforces.com/gym/102822/problem/B" target="_blank" rel="noopener">B.Building Blocks</a></h2><h3 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h3><p>(建议看题目的图片)</p>
<p>对于一个 $n\times m(n, m\leq 10^5)$ 的三维图形，它由若干 $1\times 1\times 1$ 的方格堆砌而成，现在告诉你一个斜视图（就是从45度角看过去）长啥样，以及 $k\leq 10^5$ 个坐标上的方格数，输出有多少三位图形斜视图看过去是这样的。</p>
<h3 id="题解-DP-容斥"><a href="#题解-DP-容斥" class="headerlink" title="题解:DP+容斥"></a>题解:DP+容斥</h3><p>显然按照斜向DP，对于第 $i$ 斜列， 它能够影响到的斜视图的第 $i-1, i$ 列， $dp[i][l_1][l_2]$ 表示填充第 $i$ 列，是否满足第 $i - 1$ 列和第 $i$ 列的限制条件的方案数</p>
<p>那 $k$ 个坐标上的方格数很好处理，实际上就是限制一下转移而已</p>
<p>现讨论无限制条件下的转移</p>
<p>令 $a = x _ {i - 1}, b = x _ i$</p>
<script type="math/tex; mode=display">dp[i][1][0] = \begin{cases}
dp[i - 1][1][1] \times a^k + dp[i - 1][1][0]\times[a^k - (a - 1)^k] &{a < b}\\
dp[i - 1][1][1] \times (b - 1)^k &a \geq b
\end{cases}</script><script type="math/tex; mode=display">dp[i][1][1] = \begin{cases}
dp[i-1][1][0]\times[a^k-(a-1)^k] &a=b\\
dp[i-1][1][1]\times[b^k-(b-1)^k] &a>b\\
0&a<b
\end{cases}</script><p>有限制条件转移见代码（另：第二维实际上完全没用，仅仅是为了方便理解才加上的）</p>
<h2 id="C-Code-a-Trie"><a href="#C-Code-a-Trie" class="headerlink" title="C.Code a Trie"></a><a href="https://codeforces.com/gym/102822/problem/C" target="_blank" rel="noopener">C.Code a Trie</a></h2><h3 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h3><p>有一颗Trie树，树上每个点有唯一权值，具体结构未知</p>
<p>先进行 $n$ 次询问，每次询问一个字符串，返回的是字符串在Trie树上的最大匹配的点的权值（也就是说到达Trie的叶子节点后就不会继续移动了）</p>
<p>问Trie树最少有多少个点</p>
<h3 id="题解-LCA-贪心"><a href="#题解-LCA-贪心" class="headerlink" title="题解:LCA+贪心"></a>题解:LCA+贪心</h3><p>对询问的串建一颗Trie树，并在每个串最后一个字符对应的节点打上相应的权值标记。</p>
<p>对于所有权值相同的点，他们的LCA为他们的最大匹配的最深的可能点，从这个点往上所有的点都可以为最大匹配的点。</p>
<p>考虑不合法情况：对每个点，将它到它的LCA的点的路径上的点（不包括LCA）进行染色。当一个点被染上两种颜色时，极为不合法。</p>
<p>考虑最小点的个数：也就是我们要在合法的情况下尽量将匹配点上移。</p>
<p>显然对于一个非LCA点而言，它能够成为LCA点当且仅当它的某一子树中有且仅有一个LCA点，此时那个点可以上移至当前点。</p>
<p>DFS统计一下即可。</p>
<h2 id="D-Defuse-the-Bombs"><a href="#D-Defuse-the-Bombs" class="headerlink" title="D.Defuse the Bombs"></a><a href="https://codeforces.com/gym/102822/problem/D" target="_blank" rel="noopener">D.Defuse the Bombs</a></h2><h3 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h3><p>有一排炸弹，有不同的倒计时。</p>
<p>每一秒钟，你可以选择一个炸弹，使其倒计时 + 1秒，其余炸弹倒计时均 -1</p>
<p>问最久多长时间后会有一个炸弹爆炸。</p>
<h3 id="题解-二分"><a href="#题解-二分" class="headerlink" title="题解:二分"></a>题解:二分</h3><p>二分一个最长时间，然后验证</p>
<h2 id="E-Escape-from-the-Island"><a href="#E-Escape-from-the-Island" class="headerlink" title="E.Escape from the Island"></a><a href="https://codeforces.com/gym/102822/problem/E" target="_blank" rel="noopener">E.Escape from the Island</a></h2><h3 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h3><p>有一张图，$n$ 个点， $m$ 条有向边，一个限制条件 $k$  ($n, m, k\leq 10^5$) ，将第 $n$ 个点视为重点。</p>
<p>对于正常移动，可视为无向图，每次移动时消耗时间代价为1，限制条件为最多连续进行不超过 $k$ 次正常移动， 然后进行一次随机移动，这时仅沿着有向边顺向移动，若没有以当前点为起点的边，则不动，但无论是否移动，均消耗1个时间代价，问在最差的情况下，以每个点为起点移动到终点最少需要多少时间。</p>
<h3 id="题解-BFS-DP-拓扑排序"><a href="#题解-BFS-DP-拓扑排序" class="headerlink" title="题解:BFS+DP+拓扑排序"></a>题解:BFS+DP+拓扑排序</h3><p>显然反向跑，但下列讨论是以正向建图为前提的</p>
<p>将随机转移的最差情况视为在以当前点为起点的边中找到最大的转移（前提是那些转移的状态已经跑完，所以要用拓扑）</p>
<p>正常转移则为找最小转移。</p>
<p>$dp[u][k]$ 为以 $u$ 为起点，还能连续正常转移 $k$ 步的最小代价</p>
<script type="math/tex; mode=display">
dp[u][k] = \begin{cases}
min\{dp[v][k - 1]\} + 1 & k > 0 \and ((u,v)\in G \or (v, u)\in G) \\
max\{dp[v][K]\} + 1 & k = 0 \and (u, v)\in G\\
min\{dp[u][nk]\} & nk > k
\end{cases}</script><h2 id="G-Game-of-Cards"><a href="#G-Game-of-Cards" class="headerlink" title="G.Game of Cards"></a><a href="https://codeforces.com/gym/102822/problem/G" target="_blank" rel="noopener">G.Game of Cards</a></h2><h3 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h3><p>给若干张权值为 0、1、2、3的牌，每次可以选两张权值不超过3的牌权值相加合并成一张牌，第一个无法操作的人视为输了，问先后手谁赢</p>
<h3 id="题解-博弈-打表"><a href="#题解-博弈-打表" class="headerlink" title="题解:博弈+打表"></a>题解:博弈+打表</h3><p>打表找规律</p>
<h2 id="H-Hide-and-Seek"><a href="#H-Hide-and-Seek" class="headerlink" title="H.Hide and Seek"></a><a href="https://codeforces.com/gym/102822/problem/H" target="_blank" rel="noopener">H.Hide and Seek</a></h2><h2 id="题意-5"><a href="#题意-5" class="headerlink" title="题意"></a>题意</h2><p>有两个点 $a, b$ ，给定两个点到原点的曼哈顿距离，以及两个点之间的曼哈顿距离，问平面上有多少个点对满足条件</p>
<h3 id="题解-分类讨论"><a href="#题解-分类讨论" class="headerlink" title="题解:分类讨论"></a>题解:分类讨论</h3><p>令 $a$ 到原点的曼哈顿距离为 $a$ ， $b$ 到原点的曼哈顿距离为 $b$ ，两点之间的曼哈顿距离为 $c$ ，以下讨论均以 $a &lt; b$ 为前提</p>
<script type="math/tex; mode=display">
res = \begin{cases}
1 & a=b=c=0\\
4\times (c + a \times c + a) & c=b - a\\
0 & (c\in[b-a, b+a] \and (c+b-a)\&1\neq0)\\
4\times (a + b + c) & (c\in[b-a, b+a] \and (c + b - a) \& 1 = 0)\\
4\times(a\times(b + 1) + b) & c=a+b\\
\end{cases}</script><h2 id="J-Joy-of-Handcraft"><a href="#J-Joy-of-Handcraft" class="headerlink" title="J.Joy of Handcraft"></a><a href="https://codeforces.com/gym/102822/problem/J" target="_blank" rel="noopener">J.Joy of Handcraft</a></h2><h3 id="题意-6"><a href="#题意-6" class="headerlink" title="题意"></a>题意</h3><p>对于长度为 $m$ 的区间，有 $n$ 种灯泡，第 $i$ 种灯泡的亮度为 $t_i$，分布规律参数为 $x_i$ ，它仅分布在 $[2kx_i + 1, 2kx_i+x_i]$ 区间（ $k$ 为整数 ）($n, m, k\leq 10^5$)。现在为对于 $[1,m]$ 上的每个点，分布其中的最亮的灯泡为哪种</p>
<h3 id="题解-分块-线段树-贪心-并查集"><a href="#题解-分块-线段树-贪心-并查集" class="headerlink" title="题解:分块+线段树/贪心+并查集"></a>题解:分块+线段树/贪心+并查集</h3><p><strong>解法1:分块+线段树</strong></p>
<p>对于足够大的 $x_i$ ，我们在线段树上修改它，而对于较小的 $x_i$ ，我们暴力维护。</p>
<p>设分界点为 $\sqrt m$ ，则对于单个 $x_i \geq \sqrt m$ ，其区间修改复杂度为 $O(\sqrt{m} \cdot logm)$，单次查询 $O(logm)$ ，总复杂度 $O(n\sqrt{m}\cdot logm)$</p>
<p>对于所有 $x_i&lt; \sqrt{m}$ ，查询复杂度不超过 $n\sqrt m$</p>
<p>卡得过去</p>
<p><strong>解法2:贪心+并查集</strong></p>
<p>离线处理，将所有灯泡按亮度排序，且对于每一种 $x_i$ ，只保留一个最大亮度的灯泡。然后按照亮度从大到小更新所有灯泡，每更新完一个点就将其合并到下一个点（并查集处理，下次更新时会跳过它）</p>
<h2 id="K-Knowledge-is-Power"><a href="#K-Knowledge-is-Power" class="headerlink" title="K.Knowledge is Power"></a><a href="https://codeforces.com/gym/102822/problem/K" target="_blank" rel="noopener">K.Knowledge is Power</a></h2><h3 id="题意-7"><a href="#题意-7" class="headerlink" title="题意"></a>题意</h3><p>给一个数 $x\in[5, 10^9]$ ，求一个最小长度的数列 $S = \{a_1, a_2, a_3, …, a_n\}$ 满足</p>
<ul>
<li><p>$n\geq 2$</p>
</li>
<li><p>$a_i &gt; 1, i\in[1, n]$</p>
</li>
<li><p>$\sum_{i = 1}^na_i=x$</p>
</li>
<li><p>任意一对数 $a_i, a_j, i\neq j$ 互质</p>
</li>
</ul>
<p>输出满足条件的数列中数列最大值与最小值之差的最小值</p>
<h3 id="题解-找规律"><a href="#题解-找规律" class="headerlink" title="题解:找规律"></a>题解:找规律</h3><p>仅有6是无解的</p>
<p>若 $x$ 为奇数，则奇偶分解一下，二者一定互质，答案为1</p>
<p>否则，对于 $x = 4y$ ，将其分解为 $2y + 1$ 和 $2y - 1$ ，对于 $x = 4y + 2$ ，将其分解为 $2y + 3$ 和 $2y - 1$ ，则能保证答案的上界不超过 $4$ ， 对更小的答案做一个验证即可。</p>
<h2 id="L-Lottery"><a href="#L-Lottery" class="headerlink" title="L.Lottery"></a><a href="https://codeforces.com/gym/102822/problem/L" target="_blank" rel="noopener">L.Lottery</a></h2><h3 id="题意-8"><a href="#题意-8" class="headerlink" title="题意"></a>题意</h3><p>有 $n\leq 10^5$ 种球，每个球有一个权值 $2^{a_i},a_i\leq 10^9$ ， 每种球有 $x_i\leq 10^9$ 个，问这些球最多能组成多少种权值</p>
<h3 id="题解-模拟"><a href="#题解-模拟" class="headerlink" title="题解:模拟"></a>题解:模拟</h3><p>对于一个种球 $2^{a_i}$ ，我们将它的权值计为 $2^0 = 1$ 按二进制累加，当它 $2^{a_i+1}$ 的时候，我们就将 $2^{a_i + 1}$ 上的权值按 $2^1 = 2$ 累加到原先的结果上，直到无法累加到下一位为止，记录当前结果，累乘到结果里。然后找下一种个数不为0的球，重复上述过程，至于为什么是对的，我发现很难用语言描述。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="B"><a href="#B" class="headerlink" title="B"></a>B</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> o; <span class="keyword">char</span> c = getchar();</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">2e5</span> + <span class="number">5</span>, mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">li <span class="title">KSM</span><span class="params">(li a, li t)</span></span>&#123;</span><br><span class="line">    li res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(t)&#123;</span><br><span class="line">        <span class="keyword">if</span>(t &amp; <span class="number">1</span>) res = res * a % mod;</span><br><span class="line">        a = a * a % mod;</span><br><span class="line">        t &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">li <span class="title">DEL</span><span class="params">(li a, li t)</span></span>&#123;<span class="keyword">return</span> (KSM(a, t) - KSM(a - <span class="number">1</span>, t) + mod) % mod;&#125;</span><br><span class="line"></span><br><span class="line">li dp[MAXL][<span class="number">2</span>], cnt[MAXL], h[MAXL];</span><br><span class="line"><span class="keyword">bool</span> mk[MAXL][<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ncase = <span class="number">1</span>, T = input(); ncase &lt;= T; ncase++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: "</span>, ncase);</span><br><span class="line">        li n = input(), m = input(), K = input(), flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n + m; i++)</span><br><span class="line">            h[i] = input(),</span><br><span class="line">            cnt[i] = <span class="number">0</span>,</span><br><span class="line">            <span class="built_in">memset</span>(mk[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(mk[i]));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> x = input(), y = input(), nh = input();</span><br><span class="line">            <span class="keyword">if</span>(nh &gt; min(h[x + y], h[x + y - <span class="number">1</span>])) flag = <span class="number">0</span>;</span><br><span class="line">            cnt[x + y]++;</span><br><span class="line">            <span class="keyword">if</span>(nh == min(h[x + y], h[x + y - <span class="number">1</span>]))</span><br><span class="line">                mk[x + y][nh == h[x + y - <span class="number">1</span>]][nh == h[x + y]] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flag)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"0"</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n &gt; m) swap(n, m);</span><br><span class="line">        li k, a, b;</span><br><span class="line">        <span class="keyword">for</span>(li i = <span class="number">2</span>; i &lt;= n + m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            k = min(i - <span class="number">1</span>, n + m - i + <span class="number">1</span>);</span><br><span class="line">            k = min(k, n);</span><br><span class="line">            k -= cnt[i];</span><br><span class="line">            a = h[i - <span class="number">1</span>]; b = h[i];</span><br><span class="line">            <span class="comment">//a==b</span></span><br><span class="line">            <span class="keyword">if</span>(a == b)&#123;</span><br><span class="line">                dp[i][<span class="number">1</span>] = (dp[i - <span class="number">1</span>][<span class="number">0</span>] + dp[i - <span class="number">1</span>][<span class="number">1</span>]) % mod * (mk[i][<span class="number">1</span>][<span class="number">1</span>] ? KSM(a, k) : DEL(a, k)) % mod;</span><br><span class="line">                <span class="keyword">if</span>(!mk[i][<span class="number">1</span>][<span class="number">1</span>])dp[i][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">1</span>] * KSM(b - <span class="number">1</span>, k) % mod;</span><br><span class="line">                <span class="keyword">else</span> dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(a &gt; b)&#123;</span><br><span class="line">                <span class="comment">//mk[i][0][1]</span></span><br><span class="line">                dp[i][<span class="number">1</span>] = dp[i - <span class="number">1</span>][<span class="number">1</span>] * (mk[i][<span class="number">0</span>][<span class="number">1</span>] ? KSM(b, k) : DEL(b, k)) % mod;</span><br><span class="line">                <span class="keyword">if</span>(!mk[i][<span class="number">0</span>][<span class="number">1</span>]) dp[i][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">1</span>] * KSM(b - <span class="number">1</span>, k) % mod;</span><br><span class="line">                <span class="keyword">else</span> dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//mk[i][1][0]</span></span><br><span class="line">                dp[i][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">                dp[i][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">1</span>] * KSM(a, k) % mod + dp[i - <span class="number">1</span>][<span class="number">0</span>] * (mk[i][<span class="number">1</span>][<span class="number">0</span>] ? KSM(a, k) : DEL(a, k)) % mod;</span><br><span class="line">                dp[i][<span class="number">0</span>] %= mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, dp[n + m][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>, MAXL = <span class="number">5e5</span> + <span class="number">5</span>, MAXC = <span class="number">26</span>, MAXF = <span class="number">19</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> able = <span class="number">1</span>, res = <span class="number">0</span>, tot = <span class="number">0</span>, nmk = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> ch[MAXL][MAXC], fa[MAXL][MAXF + <span class="number">1</span>], dep[MAXL], rep[MAXL], cnt[MAXL], tmk[MAXL], ban[MAXL];</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mp, refl;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; mk[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    res = <span class="number">0</span>;</span><br><span class="line">    able = <span class="number">1</span>;</span><br><span class="line">    fore(i, <span class="number">0</span>, tot)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(ch[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[i]));</span><br><span class="line">        ban[i] = rep[i] = cnt[i] = tmk[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    tot = <span class="number">0</span>;</span><br><span class="line">    mp.clear();</span><br><span class="line">    fore(i, <span class="number">1</span>, nmk) mk[i].clear();</span><br><span class="line">    nmk = <span class="number">0</span>;</span><br><span class="line">    refl.clear();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Insert</span><span class="params">(<span class="built_in">string</span> &amp;s, <span class="keyword">int</span> mark)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rt = <span class="number">0</span>, len = s.length(), nxt;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!ch[rt][nxt = s[i] - <span class="string">'a'</span>])</span><br><span class="line">            ch[rt][nxt] = ++tot;</span><br><span class="line">        rt = ch[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(mp.count(mark) == <span class="number">0</span>)</span><br><span class="line">        mp[mark] = ++nmk;</span><br><span class="line">    mk[mp[mark]].emplace_back(rt);</span><br><span class="line">    <span class="keyword">if</span>(tmk[rt] &amp;&amp; tmk[rt] != mp[mark])able = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> tmk[rt] = mp[mark];</span><br><span class="line">    <span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span></span>&#123;</span><br><span class="line">    fa[u][<span class="number">0</span>] = f;</span><br><span class="line">    dep[u] = dep[f] + <span class="number">1</span>;    </span><br><span class="line">    fore(i, <span class="number">1</span>, MAXF)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    Fore(v, <span class="number">0</span>, MAXC)</span><br><span class="line">        <span class="keyword">if</span>(ch[u][v])</span><br><span class="line">            Dfs(ch[u][v], u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[u] &lt; dep[v]) swap(u, v);</span><br><span class="line">    <span class="keyword">int</span> delta = dep[u] - dep[v];</span><br><span class="line">    fore(i, <span class="number">0</span>, MAXF)</span><br><span class="line">        <span class="keyword">if</span>(delta &amp; (<span class="number">1</span> &lt;&lt; i))</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span>(u == v) <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = MAXF; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="keyword">if</span>(fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i],</span><br><span class="line">            v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MK</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> st, <span class="keyword">int</span> ni)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(u != st)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// cout &lt;&lt; "Ban " &lt;&lt; u &lt;&lt; endl;</span></span><br><span class="line">        ban[u] = ni;</span><br><span class="line">        u = fa[u][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ban[u] = 1;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="keyword">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">        <span class="keyword">if</span>(ch[u][i])</span><br><span class="line">        &#123;</span><br><span class="line">            Cal(ch[u][i]);</span><br><span class="line">            cnt[u] += cnt[ch[u][i]];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span>(rep[u] &gt; <span class="number">1</span>) able = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(cnt[u] &gt; <span class="number">1</span> &amp;&amp; !rep[u])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> add = <span class="number">1</span>;</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>(ch[u][i] &amp;&amp; cnt[ch[u][i]] == <span class="number">1</span>)</span><br><span class="line">                add = <span class="number">0</span>;</span><br><span class="line">        res += add;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(rep[u]) res++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> str[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GO</span><span class="params">(<span class="built_in">string</span> &amp;s, <span class="keyword">int</span> ni)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rt = <span class="number">0</span>, len = s.length(), nxt;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = s[i] - <span class="string">'a'</span>;</span><br><span class="line">        <span class="comment">// cout &lt;&lt; rt &lt;&lt; " ";</span></span><br><span class="line">        <span class="keyword">if</span>(ban[rt] &amp;&amp; (ban[rt] != ni)) able = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> rt = ch[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ban[rt] &amp;&amp; (ban[rt] != ni)) able = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; rt &lt;&lt; endl;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ncase = <span class="number">1</span>, T = input(); ncase &lt;= T; ncase++)</span><br><span class="line">    &#123;</span><br><span class="line">        res = <span class="number">0</span>;</span><br><span class="line">        init();</span><br><span class="line">        <span class="keyword">int</span> n = input();</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; str[i];</span><br><span class="line">            refl[Insert(str[i], input())] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        Dfs(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        fore(i, <span class="number">1</span>, nmk)&#123;</span><br><span class="line">            <span class="keyword">int</span> p = mk[i].back();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> np : mk[i])</span><br><span class="line">                p = LCA(np, p);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> np : mk[i])</span><br><span class="line">                MK(np, p, i);</span><br><span class="line">            <span class="keyword">if</span>(tmk[p] &amp;&amp; tmk[p] != i)able = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> tmk[p] = i;</span><br><span class="line">            cnt[p]++;</span><br><span class="line">            rep[p]++;</span><br><span class="line">        &#125;</span><br><span class="line">        fore(i, <span class="number">1</span>, nmk)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> np : mk[i])</span><br><span class="line">                GO(str[refl[np]], i);</span><br><span class="line">        &#125;</span><br><span class="line">        Cal(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>, ncase, able ? res : <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="D"><a href="#D" class="headerlink" title="D"></a>D</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">li A[MAXN], n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(li t)</span></span>&#123;</span><br><span class="line">	li del = <span class="number">0</span>;</span><br><span class="line">	fore(i, <span class="number">1</span>, n)</span><br><span class="line">		<span class="keyword">if</span>(A[i] &lt; t) del += t - A[i];</span><br><span class="line">	<span class="keyword">return</span> del &lt;= t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//	freopen("In.txt", "r", stdin);</span></span><br><span class="line"><span class="comment">//	freopen("Out.txt", "w", stdout);</span></span><br><span class="line">	<span class="keyword">int</span> T;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T); </span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> ncase = <span class="number">1</span>; ncase &lt;= T; ncase++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">		fore(i, <span class="number">1</span>, n) <span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;A[i]);</span><br><span class="line">		li L = <span class="number">0</span>, R = (li)<span class="number">2e9</span>+<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">while</span>(L + <span class="number">1</span> &lt; R)</span><br><span class="line">		&#123;</span><br><span class="line">			li mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">			<span class="keyword">if</span>(check(mid)) L = mid;</span><br><span class="line">			<span class="keyword">else</span> R = mid;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Case #%d: %lld\n"</span>, ncase, R);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="E"><a href="#E" class="headerlink" title="E"></a>E</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>, MAXK = <span class="number">51</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">3</span>)+(o &lt;&lt; <span class="number">1</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">queue</span>&lt;pii&gt; Q;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; Edge[MAXN], REdge[MAXN];</span><br><span class="line"><span class="keyword">int</span> n, m, K, dis[MAXN][MAXK], d[MAXN], vis[MAXN], In[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UPD</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> k, <span class="keyword">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(k &gt; K || k &lt; <span class="number">0</span> || dis[v][k] != <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; "to " &lt;&lt; v &lt;&lt; " " &lt;&lt; k &lt;&lt; " " &lt;&lt; t &lt;&lt; endl;</span></span><br><span class="line">    dis[v][k] = t;</span><br><span class="line">    In[v]++;</span><br><span class="line">    Q.emplace(v, k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DIJ</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(dis[i], <span class="number">0x3f3f3f3f</span>, <span class="keyword">sizeof</span>(dis[i]));</span><br><span class="line">        d[i] = Edge[i].size();</span><br><span class="line">        vis[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// cout &lt;&lt; i &lt;&lt; " " &lt;&lt; d[i] &lt;&lt; endl;</span></span><br><span class="line">    &#125;</span><br><span class="line">    fore(nk, <span class="number">0</span>, K) UPD(n, nk, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span>(Q.size())&#123;</span><br><span class="line">        pii np = Q.front(); Q.pop();</span><br><span class="line">        <span class="keyword">int</span> u = np.fi, k = np.se, t = dis[u][k];</span><br><span class="line">        <span class="keyword">if</span>(k)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> v : Edge[u])</span><br><span class="line">                UPD(v, k - <span class="number">1</span>, t + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> v : REdge[u])</span><br><span class="line">                UPD(v, k - <span class="number">1</span>, t + <span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> v : REdge[u])</span><br><span class="line">            &#123;</span><br><span class="line">                d[v]--;</span><br><span class="line">                <span class="keyword">if</span>(!d[v])&#123;</span><br><span class="line">                    fore(nk, <span class="number">0</span>, K)</span><br><span class="line">                        UPD(v, nk, t + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(Edge[u].size() == <span class="number">0</span>)</span><br><span class="line">                fore(nk, <span class="number">0</span>, K)</span><br><span class="line">                    UPD(u, nk, t + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fore(u, <span class="number">1</span>, n)&#123;</span><br><span class="line">        <span class="keyword">int</span> res = dis[u][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span>(res == <span class="number">0x3f3f3f3f</span>) <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("Out.txt", "w", stdout);</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> T = input(), ncase = <span class="number">1</span>; ncase &lt;= T; ncase++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d:\n"</span>, ncase);</span><br><span class="line">        n = input(); m = input(); K = input();</span><br><span class="line">        fore(u, <span class="number">1</span>, n)Edge[u].clear(), REdge[u].clear();</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        fore(i, <span class="number">1</span>, m)&#123;</span><br><span class="line">            u = input(); v = input();</span><br><span class="line">            Edge[u].emplace_back(v);</span><br><span class="line">            REdge[v].emplace_back(u);</span><br><span class="line">        &#125;</span><br><span class="line">        DIJ();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="G"><a href="#G" class="headerlink" title="G"></a>G</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t,c0,c1,c2,c3;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> c=<span class="number">1</span>;c&lt;=t;c++)&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>,&amp;c0,&amp;c1,&amp;c2,&amp;c3);</span><br><span class="line">		<span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(c1+c2+c3) &#123;</span><br><span class="line">			flag=(c0&amp;<span class="number">1</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(c0)flag=((c0<span class="number">-1</span>)&amp;<span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span>(flag) <span class="built_in">printf</span>(<span class="string">"Case #%d: Rabbit\n"</span>,c);</span><br><span class="line">			<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"Case #%d: Horse\n"</span>,c);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(flag&amp;<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(c2==<span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(c1%<span class="number">3</span>!=<span class="number">2</span>)flag=<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">else</span> flag=<span class="number">0</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span>(c2==<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(c1%<span class="number">3</span>==<span class="number">0</span>)flag=<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">else</span> flag=<span class="number">0</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(c1%<span class="number">3</span>!=<span class="number">1</span>)flag=<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">else</span> flag=<span class="number">0</span>;	</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(flag) <span class="built_in">printf</span>(<span class="string">"Case #%d: Rabbit\n"</span>,c);</span><br><span class="line">			<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"Case #%d: Horse\n"</span>,c);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(c1%<span class="number">3</span>&amp;&amp;!(c1%<span class="number">3</span>==<span class="number">1</span>&amp;&amp;c2==<span class="number">0</span>)) flag^=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(flag) <span class="built_in">printf</span>(<span class="string">"Case #%d: Rabbit\n"</span>,c);</span><br><span class="line">			<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"Case #%d: Horse\n"</span>,c);			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="H"><a href="#H" class="headerlink" title="H"></a>H</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inc(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"></span><br><span class="line">ll t, a, b, c;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;t);</span><br><span class="line">	inc(nt, <span class="number">1</span>, t) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%lld %lld %lld"</span>, &amp;a, &amp;b, &amp;c);</span><br><span class="line">		<span class="keyword">if</span>(a &gt; b) swap(a, b);</span><br><span class="line">		ll res = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(c &gt; a + b || c &lt; b - a) res = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(c == b - a) res = <span class="number">4L</span>L * (c + a * c + a);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(c == b + a) res = <span class="number">4L</span>L * (a * (b + <span class="number">1</span>) + b);</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(((b - a)&amp;<span class="number">1</span>) != (c &amp; <span class="number">1</span>))res = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span> res = a + b + c;</span><br><span class="line">            res = res &lt;&lt; <span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="keyword">if</span>(a+b+c == <span class="number">0</span>) res = <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Case #%d: %lld\n"</span>, nt, res);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="J"><a href="#J" class="headerlink" title="J"></a>J</h3><p>线段树做法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b ;i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1e5</span> + <span class="number">5</span>, MAXL = <span class="number">1005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT</span><br><span class="line">&#123;</span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> ls (o &lt;&lt; 1)</span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> rs (o &lt;&lt; 1 | 1)</span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> mid ((l + r) &gt;&gt; 1)</span></span><br><span class="line">	<span class="keyword">int</span> L, R, NL, nv, wait[MAXM &lt;&lt; <span class="number">3</span>], v[MAXM &lt;&lt; <span class="number">3</span>];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		v[o] = wait[o] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(l != r)</span><br><span class="line">		&#123;</span><br><span class="line">			init(ls, l, mid);</span><br><span class="line">			init(rs, mid + <span class="number">1</span>, r);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PD</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l != r)</span><br><span class="line">		&#123;</span><br><span class="line">			v[ls] = max(v[ls], wait[o]);</span><br><span class="line">			wait[ls] = max(wait[ls], wait[o]);</span><br><span class="line">			v[rs] = max(v[rs], wait[o]);</span><br><span class="line">			wait[rs] = max(wait[rs], wait[o]);</span><br><span class="line">		&#125;</span><br><span class="line">		wait[o] = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R)&#123;</span><br><span class="line">			v[o] = max(v[o], nv);</span><br><span class="line">			wait[o] = max(wait[o], nv);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			PD(o, l, r);</span><br><span class="line">			<span class="keyword">if</span>(L &lt;= mid &amp;&amp; l &lt;= R) Add(ls, l, mid);</span><br><span class="line">			<span class="keyword">if</span>(L &lt;= r &amp;&amp; mid &lt; R) Add(rs, mid + <span class="number">1</span>, r);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">UPD</span><span class="params">(<span class="keyword">int</span> P, <span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		nv = v;</span><br><span class="line">		<span class="keyword">for</span>(L = <span class="number">1</span>, R = P, P &lt;&lt;= <span class="number">1</span>; L &lt;= NL; L += P, R = min(NL, R + P))</span><br><span class="line">			Add(<span class="number">1</span>, <span class="number">1</span>, NL);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l == r) <span class="keyword">return</span> v[o];</span><br><span class="line">		<span class="keyword">if</span>(wait[o]) PD(o, l, r);</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= mid) <span class="keyword">return</span> query(ls, l, mid);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> query(rs, mid + <span class="number">1</span>, r); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">QRY</span><span class="params">(<span class="keyword">int</span> p)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		L = p;</span><br><span class="line">		<span class="keyword">return</span> query(<span class="number">1</span>, <span class="number">1</span>, NL);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">#<span class="meta-keyword">undef</span> ls</span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">undef</span> rs</span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">undef</span> mid</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> mk[MAXL];</span><br><span class="line"><span class="built_in">vector</span>&lt;pii&gt; use;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> T;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> ncase = <span class="number">1</span>; ncase &lt;= T; ncase++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> n, m;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">		SGT::NL = m;</span><br><span class="line">		SGT::init(<span class="number">1</span>, <span class="number">1</span>, m);</span><br><span class="line">		use.clear();</span><br><span class="line">		<span class="built_in">memset</span>(mk, <span class="number">0</span>, <span class="keyword">sizeof</span>(mk));</span><br><span class="line">		<span class="keyword">int</span> a, b;</span><br><span class="line">		fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;a, &amp;b);</span><br><span class="line">			<span class="keyword">if</span>(a &lt;= <span class="number">1000</span>) mk[a] = max(mk[a], b);</span><br><span class="line">			<span class="keyword">else</span> SGT::UPD(a, b);</span><br><span class="line">		&#125;</span><br><span class="line">		fore(i, <span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">			<span class="keyword">if</span>(mk[i] != <span class="number">0</span>)</span><br><span class="line">				use.emplace_back(i, mk[i]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Case #%d: "</span>, ncase);</span><br><span class="line">		fore(i, <span class="number">1</span>, m)&#123;</span><br><span class="line">			<span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(pii &amp;v : use)</span><br><span class="line">				<span class="keyword">if</span>(((i - <span class="number">1</span>) / v.fi) % <span class="number">2</span> == <span class="number">0</span>) res = max(res, v.se);</span><br><span class="line">			res = max(res, SGT::QRY(i));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d%c"</span>, res,<span class="string">" \n"</span>[i==m]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并查集做法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b ; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, fa[MAXN], mk[MAXN];</span><br><span class="line"><span class="keyword">bool</span> ban[MAXN];</span><br><span class="line">pii P[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Getf</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (fa[x] == x) ? x : fa[x] = Getf(fa[x]);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Next</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p = Getf(p);</span><br><span class="line">    <span class="keyword">while</span>((p &lt;= n) &amp;&amp; (((p - <span class="number">1</span>) / x) &amp; <span class="number">1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        p = ((p - <span class="number">1</span>) / x + <span class="number">1</span>) * x + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(p &gt; n) <span class="keyword">return</span> n + <span class="number">1</span>;</span><br><span class="line">        p = Getf(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ncase = <span class="number">1</span>, T = input(); ncase &lt;= T; ncase++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: "</span>, ncase);</span><br><span class="line">        m = input(), n = input();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) mk[i] = <span class="number">0</span>, fa[i] = i;</span><br><span class="line">        fa[n + <span class="number">1</span>] = n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            P[i].se = input();</span><br><span class="line">            P[i].fi = input();</span><br><span class="line">            ban[P[i].se] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(P + <span class="number">1</span>, P + m + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = m; i; i--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> l = P[i].fi, x = P[i].se;</span><br><span class="line">            <span class="keyword">if</span>(ban[x]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> p = Next(<span class="number">1</span>, x);</span><br><span class="line">            ban[x] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(p &lt;= n)</span><br><span class="line">            &#123;</span><br><span class="line">                mk[p] = l;</span><br><span class="line">                fa[p] = p + <span class="number">1</span>;</span><br><span class="line">                p = Next(p, x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, mk[i], <span class="string">" \n"</span>[i==n]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="K"><a href="#K" class="headerlink" title="K"></a>K</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inc(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int,int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t,n; </span><br><span class="line">pii p[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line">	inc(c,<span class="number">1</span>,t)&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">		<span class="keyword">int</span> res;</span><br><span class="line">		<span class="keyword">if</span>(<span class="number">6</span>==n)&#123;</span><br><span class="line">			res=<span class="number">-1</span>;</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(n&amp;<span class="number">1</span>)&#123;</span><br><span class="line">			res=<span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(n%<span class="number">4</span>==<span class="number">0</span>)&#123;</span><br><span class="line">			res=<span class="number">2</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(n==<span class="number">10</span>) res=<span class="number">3</span>;</span><br><span class="line">			 <span class="keyword">else</span> res=<span class="number">4</span>;</span><br><span class="line">			 <span class="keyword">if</span>((n<span class="number">-4</span>)%<span class="number">3</span>==<span class="number">0</span>) &#123;</span><br><span class="line">			 	<span class="keyword">int</span> a1=(n<span class="number">-4</span>)/<span class="number">3</span>,a2=a1+<span class="number">1</span>,a3=a1+<span class="number">3</span>;</span><br><span class="line">			 	<span class="keyword">if</span>(a1&gt;<span class="number">1</span>&amp;&amp;a2&gt;<span class="number">1</span>&amp;&amp;a3&gt;<span class="number">1</span>&amp;&amp; __gcd(a1,a2)==<span class="number">1</span>&amp;&amp;__gcd(a1,a3)==<span class="number">1</span>&amp;&amp;__gcd(a2,a3)==<span class="number">1</span>) res=<span class="number">3</span>;</span><br><span class="line">			 &#125;</span><br><span class="line">		 	<span class="keyword">if</span>((n<span class="number">-5</span>)%<span class="number">3</span>==<span class="number">0</span>) &#123;</span><br><span class="line">			 	<span class="keyword">int</span> a1=(n<span class="number">-5</span>)/<span class="number">3</span>,a2=a1+<span class="number">2</span>,a3=a1+<span class="number">3</span>;</span><br><span class="line">			 	<span class="keyword">if</span>(a1&gt;<span class="number">1</span>&amp;&amp;a2&gt;<span class="number">1</span>&amp;&amp;a3&gt;<span class="number">1</span>&amp;&amp; __gcd(a1,a2)==<span class="number">1</span>&amp;&amp;__gcd(a1,a3)==<span class="number">1</span>&amp;&amp;__gcd(a2,a3)==<span class="number">1</span>) res=<span class="number">3</span>;</span><br><span class="line">			 &#125;			 </span><br><span class="line">			 <span class="keyword">if</span>(n%<span class="number">3</span>==<span class="number">0</span>) &#123;</span><br><span class="line">			 	res=<span class="number">2</span>;</span><br><span class="line">			 &#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>, c, res);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="L"><a href="#L" class="headerlink" title="L"></a>L</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++) </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e9</span> + <span class="number">7</span>, MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;use;</span><br><span class="line">pii p[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function">li <span class="title">CAL</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	li res = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(use.size())</span><br><span class="line">		res = (res &lt;&lt; <span class="number">1</span> | use.back()) % mod,</span><br><span class="line">		use.pop_back();</span><br><span class="line">	<span class="keyword">return</span> (res + <span class="number">1</span>) % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//	freopen("In.txt", "r", stdin);</span></span><br><span class="line"><span class="comment">//	freopen("Out.txt", "w", stdout);</span></span><br><span class="line">	<span class="keyword">int</span> T;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; T;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> ncase = <span class="number">1</span>; ncase &lt;= T; ncase++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> n;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">		fore(i, <span class="number">1</span>, n)</span><br><span class="line">			<span class="built_in">cin</span> &gt;&gt; p[i].fi &gt;&gt; p[i].se;</span><br><span class="line">		sort(p + <span class="number">1</span>, p + n + <span class="number">1</span>);</span><br><span class="line">		li i = <span class="number">1</span>, tmp = <span class="number">0</span>, tp = <span class="number">0</span>, res = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span>(i &lt;= n)&#123;</span><br><span class="line">				<span class="keyword">while</span>(tmp &amp;&amp; tp &lt; p[i].fi)&#123;</span><br><span class="line">					use.emplace_back(tmp &amp; <span class="number">1</span>);</span><br><span class="line">					tmp &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">					tp++;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(!tmp) res = res * CAL() % mod;</span><br><span class="line">				tp = p[i].fi;</span><br><span class="line">				tmp += p[i].se;</span><br><span class="line">				i++;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">while</span>(tmp)use.emplace_back(tmp &amp; <span class="number">1</span>), tmp &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">		res = res * CAL() % mod;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Case #%d: %lld\n"</span>, ncase, res); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/27/SAM%E9%A2%98%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/27/SAM%E9%A2%98%E9%9B%86/" itemprop="url">SAM题集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-27T15:00:50+08:00">
                2020-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%83%E4%B9%A0%E9%A2%98%E9%9B%86/" itemprop="url" rel="index">
                    <span itemprop="name">练习题集</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="洛谷3346-ZJOI2015-诸神眷顾的幻想乡"><a href="#洛谷3346-ZJOI2015-诸神眷顾的幻想乡" class="headerlink" title="洛谷3346[ZJOI2015]诸神眷顾的幻想乡"></a><a href="https://www.luogu.com.cn/problem/P3346" target="_blank" rel="noopener">洛谷3346[ZJOI2015]诸神眷顾的幻想乡</a></h2><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>给定一棵树 $(n\leq 10^5)$，每个点有一个字符（字符种类 $\leq 10$），问任意两点间有向路径连成的不同字符串有多少种（树的叶子节点数 $\leq 20$ ）</p>
<h2 id="题解-广义后缀自动机-Dfs"><a href="#题解-广义后缀自动机-Dfs" class="headerlink" title="题解:广义后缀自动机+Dfs"></a>题解:广义后缀自动机+Dfs</h2><p>对于任意一个字符串而言，它必定满足是从一个叶子节点走向另一个叶子节点的子串，因此我们对每个叶子节点进行一次深搜，建立广义后缀自动机（共建立一个），然后在后缀自动机上Dfs，就能统计出答案</p>
<p>复杂度$O(n)$</p>
<h2 id="洛谷3649-APIO2014-回文串"><a href="#洛谷3649-APIO2014-回文串" class="headerlink" title="洛谷3649 [APIO2014] 回文串"></a><a href="https://www.luogu.com.cn/problem/P3649" target="_blank" rel="noopener">洛谷3649 [APIO2014] 回文串</a></h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给你一个由小写拉丁字母组成的字符串 $s(|s|\leq 300000)$。我们定义 $s$ 的一个子串的存在值为这个子串在 $s$ 中出现的次数乘以这个子串的长度。对于给你的这个字符串 $s$，求所有回文子串中的最大存在值。</p>
<h3 id="题解-SAM-Manacher"><a href="#题解-SAM-Manacher" class="headerlink" title="题解 : SAM+Manacher"></a>题解 : SAM+Manacher</h3><p>由SAM可以轻易地得知每一个子串的出现次数，我们唯一需要知道的就是有哪些子串是回文串。</p>
<p>在Manacher的执行过程中，我们可以将每一个本质不同的回文串处理出来（数量为O(n)）。事先将 $fail$ 树建立出来然后每次查询即可。</p>
<p>复杂度 $O(n+nlogn)$</p>
<h2 id="洛谷4022-CTSC2012-熟悉的文章"><a href="#洛谷4022-CTSC2012-熟悉的文章" class="headerlink" title="洛谷4022[CTSC2012] 熟悉的文章"></a><a href="https://www.luogu.com.cn/problem/P4022" target="_blank" rel="noopener">洛谷4022[CTSC2012] 熟悉的文章</a></h2><h3 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h3><p>有 $m + n$ 个01串，对那 $n$ 个01串，试图找到一种分割方式，使分割后的在 $m$ 个字符串的子串中出现过的子串的总长度不小于总长度的 90%，问分割后在 $m$ 个字符串中出现过的最短的子串是最长是多长</p>
<h3 id="题解-广义SAM-单调队列"><a href="#题解-广义SAM-单调队列" class="headerlink" title="题解:广义SAM+单调队列"></a>题解:广义SAM+单调队列</h3><p>首先在SAM上找出对于 $n$ 个01串的每一个前缀在 $m$ 个01串中的最长公共后缀长度，然后就是求一种线段覆盖，使得覆盖长度不小于 90% 且最短的线段最长。</p>
<p>二分答案，验证可行性时：</p>
<p>考虑性质：每一个相邻的前缀其最长公共后缀长度 $mx_i$ 不会陡增（即 $mx_{i + 1} \leq mx_i + 1$</p>
<p>维护不能覆盖的总长度，它是单调不减的，结合上述性质，可以用单调队列维护</p>
<h2 id="洛谷4070-SDOI2016-生成魔咒"><a href="#洛谷4070-SDOI2016-生成魔咒" class="headerlink" title="洛谷4070[SDOI2016]生成魔咒"></a><a href="https://www.luogu.com.cn/problem/P4070" target="_blank" rel="noopener">洛谷4070[SDOI2016]生成魔咒</a></h2><h3 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h3><p>给一个空字符串，每次在它后面加一个字符，问每次加入后形成的字符串有多少不同的子串。</p>
<h3 id="题解-SAM"><a href="#题解-SAM" class="headerlink" title="题解:SAM"></a>题解:SAM</h3><p>模版题，用map存父子关系即可</p>
<h2 id="洛谷4081-USACO17DEC-Standing-Out-From-the-Herd-P"><a href="#洛谷4081-USACO17DEC-Standing-Out-From-the-Herd-P" class="headerlink" title="洛谷4081[USACO17DEC]Standing Out From the Herd P"></a><a href="https://www.luogu.com.cn/problem/P4081" target="_blank" rel="noopener">洛谷4081[USACO17DEC]Standing Out From the Herd P</a></h2><h3 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h3><p>给定若干字符串，求每个字符串特有的本质不同的子串数量（即仅在本字符串中出现过，且相同子串仅统计一次）</p>
<h3 id="题解-广义SAM-Trie"><a href="#题解-广义SAM-Trie" class="headerlink" title="题解:广义SAM+Trie"></a>题解:广义SAM+Trie</h3><p>首先在Trie上可以先把相同前缀处理掉，对于不同的前缀分别打上字符串编号的标记即可</p>
<p>其次对Trie建广义后缀自动机，在对应节点上打上对应标记</p>
<p>最后在SAM的fail树上拓扑一下，对于两个不同标记都能够到达的fail节点，取消其贡献，否则贡献为 $len[p] - len[fail[p]]$</p>
<p>注意Trie和SAM标记的对应性</p>
<p>（应该有更简单的统计方式，但是头有点昏，A了就先不管了）</p>
<h2 id="洛谷4770-NOI2018-你的名字"><a href="#洛谷4770-NOI2018-你的名字" class="headerlink" title="洛谷4770[NOI2018]你的名字"></a><a href="https://www.luogu.com.cn/problem/P4770" target="_blank" rel="noopener">洛谷4770[NOI2018]你的名字</a></h2><h3 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h3><p>给一个一个禁止串 $S_1…S_n$ 和若干可用串，问对每个可用串，其子串中未出现在禁止串的 $S_l…S_r$ 的个数有多少</p>
<h3 id="题解-SAM-线段树合并"><a href="#题解-SAM-线段树合并" class="headerlink" title="题解:SAM+线段树合并"></a>题解:SAM+线段树合并</h3><p>其实暴力解法很好想，对禁止串建立SAM，把每个点在fail树上的点做上对应位置的标记，在fail树上暴力地把每一个点的标记向上合并。</p>
<p>对于每个可用串，依次在SAM上跑匹配，每次查询fail树上某个点是否包含在某一段区间，相当于查询这个点的标记当中是否有标记在区间中的点。</p>
<p>为了优化向上合并的时空复杂度，选择线段树合并。</p>
<p><strong>Tips:</strong></p>
<p>1、在可用串的匹配过程中，若查询的是长度为 $l$ 的后缀是否出现在区间[L,R]内，查询的实际上是 $[L+l-1, R]$</p>
<p>2、fail树上向上跳对应的是下一个在禁止串中的最长公共子串，不是可用串和禁止串的下一个公共子串，因此不能直接在fail树上跳，而是要依次减少匹配长度，在匹配长度等于$len[fail[p]]$ 后才向上跳</p>
<h2 id="洛谷5576-CmdOI2019-口头禅"><a href="#洛谷5576-CmdOI2019-口头禅" class="headerlink" title="洛谷5576[CmdOI2019]口头禅"></a><a href="https://www.luogu.com.cn/problem/P5576" target="_blank" rel="noopener">洛谷5576[CmdOI2019]口头禅</a></h2><h3 id="题意-5"><a href="#题意-5" class="headerlink" title="题意"></a>题意</h3><p>给定 $n\leq 2\times 10^4$ 个01串，总长度 $\leq 4\times 10^5$ ，对 $q\leq 10^5$ 次询问，每次回答区间 $[l, r]$ 的所有串的最长公共子串长度</p>
<h3 id="题解-SAM-猫树分治"><a href="#题解-SAM-猫树分治" class="headerlink" title="题解:SAM+猫树分治"></a>题解:SAM+猫树分治</h3><p>首先想一个暴力的解法：对于每一个询问区间，我们用最短的串作为基准串，在其它串的SAM上匹配（没错，是它在其它串的SAM上匹配），对于基准串的每一位都记录一个当前能够匹配的最长公共后缀，不断更新，最后求最大值。</p>
<p><strong>预处理:</strong> 在此基础上，我们其实可以以它为中心，向左向右分别匹配，然后记录在每一个串上基准串的每一个点能匹配的最长公共后缀，然后求一个前缀/后缀最小值，那么我们就能够得到以基准串 $mid$ 为中心，向左直到 $l$ 的区间匹配值 $slen[l,mid][i]$ ，表示 $mid$ 的第 $i$ 个字符在 $[l, mid]$ 区间可匹配到的最长公共子串；向右同理。对于每个串作为 $mid$ ，预处理复杂度 $O(n \times len[mid])$ 。</p>
<p><strong>询问:</strong> 如此一来，所有包含 $mid$ 串的区间查询我们都可以快速用 $slen$ 合并 $slen[l, mid], slen[mid, r]$ 处理出来，每一次查询的复杂度是 $O(len[mid])$。</p>
<p><strong>优化预处理:</strong> 对于查询的区间，本着不重不漏的目的，我们就可以进行分治了。</p>
<p>对于区间 $[1, n]$ 我们取其中间点 $mid$ ，在该层分治只处理区间跨越 $mid$ 的询问，而询问在 $[1,mid)$ 和 $(mid, n]$ 的，我们放至下一层，如此一来每一层的复杂度约为 $O(n\times len[mid])$ ，这个 $len[mid]$ 复杂度看脸。</p>
<p><strong>总询问:</strong> 总复杂度为 $O(n\times len[mid])$ ，同上，复杂度看脸。</p>
<p><strong>优化 $len[mid]$:</strong> 对于每一次询问，我们显然希望 $len[mid]$ 越短越好，于是我们在选取 $mid$ 时，选择一个长度范围，本题中选择的是 $(2^{n-1}, 2^n]$ ，$n$ 的选择标准是恰好有最短的字符串的长度落在该区间。如此一来，每一层的复杂度可以降到 $O(2^n \times \frac{\sum len_i}{2^n}) = O(\sum len_i)$ （字符串长度恰好在 $(2^{n-1}, 2^n]$ 的串的个数不多于 $\frac{\sum len_i}{2^n}$ 个）。</p>
<p><strong>最终复杂度:</strong> 反正爆不了。</p>
<h2 id="洛谷6139-模版-广义后缀自动机-广义SAM"><a href="#洛谷6139-模版-广义后缀自动机-广义SAM" class="headerlink" title="洛谷6139[模版]广义后缀自动机(广义SAM)"></a><a href="https://www.luogu.com.cn/problem/P6139" target="_blank" rel="noopener">洛谷6139[模版]广义后缀自动机(广义SAM)</a></h2><h3 id="板题"><a href="#板题" class="headerlink" title="板题"></a>板题</h3><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="3346"><a href="#3346" class="headerlink" title="3346"></a>3346</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i&lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e6</span> + <span class="number">5</span>, MAXC = <span class="number">10</span>, MAXM = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM&#123;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXN][MAXC], fail[MAXN], len[MAXN];</span><br><span class="line">    li cnt[MAXN];</span><br><span class="line">    <span class="keyword">int</span> root, tail;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        root = tail = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[root], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[root]));</span><br><span class="line">        fail[root] = <span class="number">-1</span>;</span><br><span class="line">        len[root] = <span class="number">0</span>;</span><br><span class="line">        cnt[root] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> las)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        len[++tail] = len[las] + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[tail], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[tail]));</span><br><span class="line">        fail[tail] = cnt[tail] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Extend</span><span class="params">(<span class="keyword">int</span> las, <span class="keyword">int</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ch[las][c])&#123;</span><br><span class="line">            <span class="keyword">int</span> p = las, q = ch[las][c];</span><br><span class="line">            <span class="keyword">if</span>(len[p] + <span class="number">1</span> == len[q]) <span class="keyword">return</span> ch[las][c];</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = nq;</span><br><span class="line">                <span class="keyword">for</span>(; (~p) &amp;&amp; ch[p][c] == q; p = fail[p])</span><br><span class="line">                    ch[p][c] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> p = las, np = newnode(las);</span><br><span class="line">            <span class="keyword">for</span>(; (~p) &amp;&amp; (!ch[p][c]); p = fail[p])</span><br><span class="line">                ch[p][c] = np;</span><br><span class="line">            <span class="keyword">if</span>(!~p)fail[np] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">                <span class="keyword">if</span>(len[q] == len[p] + <span class="number">1</span>)fail[np] = q;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                    <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                    fail[nq] = fail[q];</span><br><span class="line">                    fail[np] = fail[q] = nq;</span><br><span class="line">                    <span class="keyword">for</span>(; (~p) &amp;&amp; (ch[p][c] == q); p = fail[p])</span><br><span class="line">                        ch[p][c] = nq;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ch[las][c];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">li <span class="title">Cal</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">        <span class="comment">// cout &lt;&lt; u &lt;&lt; endl;</span></span><br><span class="line">        <span class="keyword">if</span>(cnt[u]) <span class="keyword">return</span> cnt[u];</span><br><span class="line">        <span class="comment">// puts("SEARCH")</span></span><br><span class="line">        cnt[u] = <span class="number">1</span>;</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>(ch[u][i])</span><br><span class="line">                <span class="comment">// cout &lt;&lt; u &lt;&lt; " " &lt;&lt; i &lt;&lt; endl,</span></span><br><span class="line">                cnt[u] += Cal(ch[u][i]);</span><br><span class="line">        <span class="keyword">return</span> cnt[u];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; Edge[MAXM];</span><br><span class="line"><span class="keyword">int</span> A[MAXM], pos[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span></span>&#123;</span><br><span class="line">    pos[u] = SAM::Extend(pos[f], A[u]);</span><br><span class="line">    <span class="comment">// cout &lt;&lt; u &lt;&lt; " " &lt;&lt; pos[f] &lt;&lt; " " &lt;&lt; SAM::ch[pos[f]][A[u]] &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> v : Edge[u])</span><br><span class="line">        <span class="keyword">if</span>(v != f) Dfs(v, u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> n, C, u, v;</span><br><span class="line">    </span><br><span class="line">    SAM::init();</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; C;</span><br><span class="line">    fore(i, <span class="number">1</span>, n) <span class="built_in">cin</span> &gt;&gt; A[i];</span><br><span class="line">    Fore(i, <span class="number">1</span>, n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        Edge[u].emplace_back(v);</span><br><span class="line">        Edge[v].emplace_back(u);</span><br><span class="line">    &#125;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span>(Edge[i].size() == <span class="number">1</span>)</span><br><span class="line">            Dfs(i, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; (SAM::Cal(pos[<span class="number">0</span>]) - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3649"><a href="#3649" class="headerlink" title="3649"></a>3649</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">5</span>, MAXC = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ch[MAXN &lt;&lt; <span class="number">1</span>][MAXC], fail[MAXN &lt;&lt; <span class="number">1</span>][<span class="number">19</span>], cnt[MAXN &lt;&lt; <span class="number">1</span>], len[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">li res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM&#123;</span><br><span class="line">    <span class="keyword">int</span> las, root, tail, maxl;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        las = root = tail = <span class="number">0</span>;</span><br><span class="line">        len[root] = <span class="number">0</span>;</span><br><span class="line">        fail[root][<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> l)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        len[++tail] = len[l] + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[tail], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[tail]));</span><br><span class="line">        cnt[tail] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Extend</span><span class="params">(<span class="keyword">int</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = las, np = newnode(p);</span><br><span class="line">        <span class="keyword">for</span>(; (~p) &amp;&amp; (!ch[p][c]); p = fail[p][<span class="number">0</span>])</span><br><span class="line">            ch[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span>(!~p) fail[np][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[q] == len[p] + <span class="number">1</span>) fail[np][<span class="number">0</span>] = q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                fail[nq][<span class="number">0</span>] = fail[q][<span class="number">0</span>];</span><br><span class="line">                fail[q][<span class="number">0</span>] = fail[np][<span class="number">0</span>] = nq;</span><br><span class="line">                <span class="keyword">while</span>((~p) &amp;&amp; (ch[p][c] == q))</span><br><span class="line">                    ch[p][c] = nq, p = fail[p][<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt[np]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> las = np;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> C[MAXN], ST[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tail; i++)</span><br><span class="line">            C[len[i]]++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= maxl; i++)</span><br><span class="line">            C[i] += C[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = tail; i &gt; <span class="number">1</span>; i--)</span><br><span class="line">            ST[C[len[i]]--] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = tail; i &gt; <span class="number">1</span>; i--)</span><br><span class="line">            cnt[fail[ST[i]][<span class="number">0</span>]] += cnt[ST[i]];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> p = <span class="number">1</span>; p &lt;= tail; p++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">18</span>; i++)</span><br><span class="line">                fail[p][i] = fail[fail[p][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> l)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">18</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            <span class="keyword">if</span>((~fail[p][i]) &amp;&amp; len[fail[p][i]] &gt;= l)</span><br><span class="line">                p = fail[p][i];</span><br><span class="line">        <span class="keyword">return</span> cnt[p];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> pos[MAXN];</span><br><span class="line"><span class="keyword">char</span> s[MAXN], Ms[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> Mr[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    l = (l &gt;&gt; <span class="number">1</span>) + (l &amp; <span class="number">1</span>); r = (r &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> len = r - l + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; " " &lt;&lt; len &lt;&lt; " "&lt;&lt; SAM::Query(pos[r - 1], len) &lt;&lt; endl;</span></span><br><span class="line">    res = max(res, <span class="number">1L</span>L * len * SAM::Query(pos[r - <span class="number">1</span>], len));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Manacher</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">0</span>;</span><br><span class="line">    Ms[p++] = <span class="string">'$'</span>; Ms[p++] = <span class="string">'#'</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">        Ms[p++] = s[i],</span><br><span class="line">        Ms[p++] = <span class="string">'#'</span>;</span><br><span class="line">    Ms[p] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> mx = <span class="number">0</span>, mid = <span class="number">0</span>;</span><br><span class="line">    len = len &lt;&lt; <span class="number">1</span> | <span class="number">1</span>;</span><br><span class="line">    Fore(i, <span class="number">0</span>, p)</span><br><span class="line">    &#123;</span><br><span class="line">        Mr[i] = mx &gt; i ? min(Mr[<span class="number">2</span> * mid - i], mx - i) : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(Ms[i + Mr[i]] == Ms[i - Mr[i]])</span><br><span class="line">            Query(i - Mr[i], i + Mr[i]),</span><br><span class="line">            Mr[i]++;</span><br><span class="line">        <span class="keyword">if</span>(i + Mr[i] &gt; mx)</span><br><span class="line">            mx = i + Mr[i],</span><br><span class="line">            mid = i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SAM::init();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    SAM::maxl = len;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">        pos[i] = SAM::Extend(s[i] - <span class="string">'a'</span>);</span><br><span class="line">    SAM::Cal();</span><br><span class="line">    Manacher();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>, res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4022"><a href="#4022" class="headerlink" title="4022"></a>4022</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b ;i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls (o &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs (o &lt;&lt; 1 | 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">'\n'</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXC = <span class="number">2</span>, MAXT = <span class="number">12e5</span> + <span class="number">5</span>, inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM&#123;</span><br><span class="line">    <span class="keyword">int</span> rt, tail;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXT &lt;&lt; <span class="number">1</span>][MAXC], fail[MAXT &lt;&lt; <span class="number">1</span>], len[MAXT &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        rt = tail = <span class="number">0</span>;</span><br><span class="line">        len[rt] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[rt], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[rt]));</span><br><span class="line">        fail[rt] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> las)</span></span>&#123;</span><br><span class="line">        len[++tail] = len[las] + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[tail], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[tail]));</span><br><span class="line">        fail[tail] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Extend</span><span class="params">(<span class="keyword">int</span> las, <span class="keyword">int</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = las, np = newnode(p);</span><br><span class="line">        <span class="keyword">for</span>(; (~p) &amp;&amp; (!ch[p][c]); p = fail[p])</span><br><span class="line">            ch[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span>(!~p) fail[np] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[q] == (len[p] + <span class="number">1</span>)) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = fail[np] = nq;</span><br><span class="line">                <span class="keyword">for</span>(; (~p) &amp;&amp; (ch[p][c] == q); p = fail[p])</span><br><span class="line">                    ch[p][c] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ch[las][c];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mx[MAXT], dp[MAXT];</span><br><span class="line">    pii ST[MAXT];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> tail = <span class="number">0</span>, head = <span class="number">1</span>;</span><br><span class="line">        ST[++tail] = MP(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        fore(i, <span class="number">1</span>, len)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i &gt; l)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">while</span>(head &lt;= tail &amp;&amp; ST[tail].se &gt; dp[i - l]) tail--;</span><br><span class="line">                ST[++tail] = MP(i - l , dp[i - l]);</span><br><span class="line">                <span class="keyword">if</span>(mx[i] &gt;= l)<span class="keyword">while</span>(head &lt;= tail &amp;&amp; ST[head].fi &lt; i - mx[i]) head++;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i] = dp[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(head &lt;= tail &amp;&amp; mx[i] &gt;= l) dp[i] = min(ST[head].se + max(<span class="number">0</span>, i - ST[head].fi - mx[i]), dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> len - dp[len];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="built_in">string</span> s)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> L = <span class="number">0</span>, R = <span class="number">0</span>, l=s.length(), rt = <span class="number">0</span>, nxt, nl = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; i++)&#123;</span><br><span class="line">            nxt = s[i] - <span class="string">'0'</span>;</span><br><span class="line">            <span class="keyword">while</span>(rt &amp;&amp; (!ch[rt][nxt])) rt = fail[rt], nl = len[rt];</span><br><span class="line">            <span class="keyword">if</span>(!ch[rt][nxt]) mx[i] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                mx[i + <span class="number">1</span>] = ++nl;</span><br><span class="line">                rt = ch[rt][nxt];</span><br><span class="line">                R = max(mx[i + <span class="number">1</span>], R);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">while</span>(L != R)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (L + R + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(check(mid, l) * <span class="number">10</span> &gt;= l * <span class="number">9</span>) L = mid;</span><br><span class="line">            <span class="keyword">else</span> R = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; L &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Trie&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt, T[MAXT][MAXC], pos[MAXT];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = s.length(), rt = <span class="number">0</span>, nxt;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            nxt = s[i] - <span class="string">'0'</span>;</span><br><span class="line">            <span class="keyword">if</span>(!T[rt][nxt]) T[rt][nxt] = ++cnt;</span><br><span class="line">            rt = T[rt][nxt];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> las, <span class="keyword">int</span> u, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">        pos[u] = SAM::Extend(pos[las], c);</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>(T[u][i])</span><br><span class="line">                Dfs(u, T[u][i], i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rt = <span class="number">0</span>;</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>(T[rt][i])</span><br><span class="line">                Dfs(rt, T[rt][i], i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    SAM::init();</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    fore(i, <span class="number">1</span>, m)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">        Trie::Insert(s);</span><br><span class="line">    Trie::Build();</span><br><span class="line">    fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">        SAM::Cal(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4070"><a href="#4070" class="headerlink" title="4070"></a>4070</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">li res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM&#123;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; ch[MAXN];</span><br><span class="line">    <span class="keyword">int</span> fail[MAXN], len[MAXN];</span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>, tail = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        fail[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">        len[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> las)</span></span>&#123;</span><br><span class="line">        len[++tail] = len[las] + <span class="number">1</span>;</span><br><span class="line">        fail[tail] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Extend</span><span class="params">(<span class="keyword">int</span> las, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = las, np = newnode(las);</span><br><span class="line">        <span class="keyword">for</span>(; (~p) &amp;&amp; !ch[p].count(c); p = fail[p])</span><br><span class="line">            ch[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span>(!~p) fail[np] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[p] + <span class="number">1</span> == len[q])fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                ch[nq] = ch[q];</span><br><span class="line">                <span class="keyword">for</span>(; (~p) &amp;&amp; (ch[p].count(c) &amp;&amp; ch[p][c] == q); p = fail[p])</span><br><span class="line">                    ch[p][c] = nq;</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = fail[np] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res += len[np] - len[fail[np]];</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, np, las = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    SAM::init();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;np);</span><br><span class="line">        las = SAM::Extend(las, np);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4081"><a href="#4081" class="headerlink" title="4081"></a>4081</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>, MAXC = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> res[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM&#123;</span><br><span class="line">    <span class="keyword">int</span> tail = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXN &lt;&lt; <span class="number">1</span>][MAXC], fail[MAXN &lt;&lt; <span class="number">1</span>], len[MAXN &lt;&lt; <span class="number">1</span>], mk[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(ch[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[<span class="number">0</span>]));</span><br><span class="line">        fail[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">        len[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        mk[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> las)</span></span>&#123;</span><br><span class="line">        len[++tail] = len[las] + <span class="number">1</span>;</span><br><span class="line">        fail[tail] = mk[tail] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[tail], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[tail]));</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Extend</span><span class="params">(<span class="keyword">int</span> las, <span class="keyword">int</span> c, <span class="keyword">int</span> nmk)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ch[las][c])&#123;</span><br><span class="line">            <span class="keyword">int</span> p = las, q = ch[las][c];</span><br><span class="line">            <span class="keyword">if</span>(len[p] + <span class="number">1</span> == len[q]) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = nq;</span><br><span class="line">                <span class="keyword">for</span>(; (~p) &amp;&amp; (ch[p][c] == q); p = fail[p])</span><br><span class="line">                    ch[p][c] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> p = las, np = newnode(las);</span><br><span class="line">            <span class="keyword">for</span>(; (~p) &amp;&amp; !ch[p][c]; p = fail[p])</span><br><span class="line">                ch[p][c] = np;</span><br><span class="line">            <span class="keyword">if</span>(!~p) fail[np] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">                <span class="keyword">if</span>(len[q] == len[p] + <span class="number">1</span>)fail[np] = q;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                    <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                    fail[nq] = fail[q];</span><br><span class="line">                    fail[np] = fail[q] = nq;</span><br><span class="line">                    <span class="keyword">for</span>(; (~p) &amp;&amp; (ch[p][c] == q); p = fail[p])</span><br><span class="line">                        ch[p][c] = nq;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> C[MAXN &lt;&lt; <span class="number">1</span>], ST[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CAL</span><span class="params">(<span class="keyword">int</span> SIZ)</span></span>&#123;</span><br><span class="line">        fore(i, <span class="number">1</span>, tail) C[len[i]]++;</span><br><span class="line">        fore(i, <span class="number">1</span>, SIZ) C[i] += C[i - <span class="number">1</span>]; </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = tail; i; i--)</span><br><span class="line">            ST[C[len[i]]--] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = tail; i; i--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> np = ST[i];</span><br><span class="line">            <span class="keyword">if</span>(mk[np] &gt; <span class="number">0</span>)res[mk[np]] += len[np] - len[fail[np]];</span><br><span class="line">            <span class="keyword">if</span>(mk[fail[np]] == <span class="number">0</span>) mk[fail[np]] = mk[np];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(mk[fail[np]] == <span class="number">-1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(mk[fail[np]] != mk[np]) mk[fail[np]] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Trie&#123;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXN][MAXC], mk[MAXN], pos[MAXN], tail = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="built_in">string</span> &amp;s, <span class="keyword">int</span> ni)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = s.length(), rt = <span class="number">0</span>, nxt;</span><br><span class="line">        Fore(i, <span class="number">0</span>, len)&#123;</span><br><span class="line">            nxt = s[i] - <span class="string">'a'</span>;</span><br><span class="line">            <span class="keyword">if</span>(ch[rt][nxt])</span><br><span class="line">                mk[ch[rt][nxt]] = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">else</span> mk[ch[rt][nxt] = ++tail] = ni;</span><br><span class="line">            rt = ch[rt][nxt];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SAM::init();</span><br><span class="line">        <span class="keyword">int</span> las = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tail; i++)&#123;</span><br><span class="line">            las = pos[i];</span><br><span class="line">            <span class="keyword">if</span>(mk[i])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(SAM::mk[las] == <span class="number">0</span>) SAM::mk[las] = mk[i];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(SAM::mk[las] == <span class="number">-1</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(SAM::mk[las] != mk[i]) SAM::mk[las] = <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Fore(j, <span class="number">0</span>, MAXC)</span><br><span class="line">                <span class="keyword">if</span>(ch[i][j])</span><br><span class="line">                &#123;</span><br><span class="line">                    SAM::Extend(las, j, mk[ch[i][j]]);</span><br><span class="line">                    pos[ch[i][j]] = SAM::ch[las][j];</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">        Trie::Insert(s, i);</span><br><span class="line">    Trie::Build();</span><br><span class="line">    SAM::CAL(Trie::tail);</span><br><span class="line">    fore(i, <span class="number">1</span>, n) <span class="built_in">cout</span> &lt;&lt; res[i] &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4770"><a href="#4770" class="headerlink" title="4770"></a>4770</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mid ((l + r) &gt;&gt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">'\n'</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e6</span> + <span class="number">5</span>, MAXC = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT&#123;</span><br><span class="line">    <span class="keyword">int</span> tail = <span class="number">0</span>, maxlen;</span><br><span class="line">    <span class="keyword">int</span> cnt[MAXN &lt;&lt; <span class="number">4</span>], ls[MAXN &lt;&lt; <span class="number">4</span>], rs[MAXN &lt;&lt; <span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> np = ++tail;</span><br><span class="line">        ls[np] = rs[np] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(l != r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(pos &lt;= mid) ls[np] = newnode(l, mid, pos);</span><br><span class="line">            <span class="keyword">else</span> rs[np] = newnode(mid + <span class="number">1</span>, r, pos);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> u, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((!u) || (!v)) <span class="keyword">return</span> (u+v);</span><br><span class="line">        <span class="keyword">int</span> np = ++tail;</span><br><span class="line">        <span class="keyword">if</span>(l != r)&#123;</span><br><span class="line">            ls[np] = Merge(l, mid, ls[u], ls[v]);</span><br><span class="line">            rs[np] = Merge(mid + <span class="number">1</span>, r, rs[u], rs[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> L, R;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; SGT::L &lt;&lt; " " &lt;&lt; SGT::R &lt;&lt; " " &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; endl;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">bool</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(L &lt;= mid &amp;&amp; l &lt;= R &amp;&amp; ls[o])res |= Query(ls[o], l, mid);</span><br><span class="line">        <span class="keyword">if</span>(res) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L &lt;= r &amp;&amp; mid &lt; R &amp;&amp; rs[o])res |= Query(rs[o], mid + <span class="number">1</span>, r);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">QRY</span><span class="params">(<span class="keyword">int</span> add, <span class="keyword">int</span> o)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        L += add;</span><br><span class="line">        <span class="keyword">bool</span> res = Query(o, <span class="number">1</span>, maxlen);</span><br><span class="line">        L -= add;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM&#123;</span><br><span class="line">    <span class="keyword">int</span> root, tail, ch[MAXN &lt;&lt; <span class="number">1</span>][MAXC], fail[MAXN &lt;&lt; <span class="number">1</span>], len[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        root = tail = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[root], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[root]));</span><br><span class="line">        len[root] = <span class="number">0</span>;</span><br><span class="line">        fail[root] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> las)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        len[++tail] = len[las] + <span class="number">1</span>;</span><br><span class="line">        fail[tail] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[tail], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[tail]));</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Extend</span><span class="params">(<span class="keyword">int</span> las, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = las, np = newnode(las);</span><br><span class="line">        <span class="keyword">for</span>(; (~p) &amp;&amp; (!ch[p][c]); p = fail[p])</span><br><span class="line">            ch[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span>(!~p) fail[np] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[q] == len[p] + <span class="number">1</span>) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                <span class="comment">// cout &lt;&lt; "HAHA " &lt;&lt; nq &lt;&lt; " " &lt;&lt; len[nq] &lt;&lt; endl;</span></span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = fail[np] = nq;</span><br><span class="line">                <span class="keyword">for</span>(; (~p) &amp;&amp; (ch[p][c] == q); p = fail[p])</span><br><span class="line">                    ch[p][c] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pos[MAXN], node[MAXN], C[MAXN &lt;&lt; <span class="number">1</span>], ST[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> maxlen;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span>&#123;</span><br><span class="line">        SAM::init();</span><br><span class="line">        <span class="keyword">int</span> l = s.length(), las = <span class="number">0</span>;</span><br><span class="line">        SGT::maxlen = maxlen = l;</span><br><span class="line">        Fore(i, <span class="number">0</span>, l)</span><br><span class="line">            las = pos[i + <span class="number">1</span>] = Extend(las, s[i]-<span class="string">'a'</span>);</span><br><span class="line">        fore(i, <span class="number">1</span>, l)</span><br><span class="line">            node[pos[i]] = SGT::newnode(<span class="number">1</span>, maxlen, i);</span><br><span class="line">        fore(i, <span class="number">1</span>, tail)C[len[i]]++;</span><br><span class="line">        fore(i, <span class="number">1</span>, l) C[i] += C[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = tail; i; i--)ST[C[len[i]]--] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = tail; i; i--)</span><br><span class="line">            node[fail[ST[i]]] = SGT::Merge(<span class="number">1</span>, maxlen, node[fail[ST[i]]], node[ST[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM2&#123;</span><br><span class="line">    <span class="keyword">int</span> root, tail, ch[MAXN &lt;&lt; <span class="number">1</span>][MAXC], fail[MAXN &lt;&lt; <span class="number">1</span>], len[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        root = tail = <span class="number">0</span>;</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)ch[root][i] = <span class="number">0</span>;</span><br><span class="line">        len[root] = <span class="number">0</span>;</span><br><span class="line">        fail[root] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> las)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        len[++tail] = len[las] + <span class="number">1</span>;</span><br><span class="line">        fail[tail] = <span class="number">0</span>;</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)ch[tail][i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Extend</span><span class="params">(<span class="keyword">int</span> las, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = las, np = newnode(las);</span><br><span class="line">        <span class="keyword">for</span>(; (~p) &amp;&amp; (!ch[p][c]); p = fail[p])</span><br><span class="line">            ch[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span>(!~p) fail[np] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[q] == len[p] + <span class="number">1</span>) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = fail[np] = nq;</span><br><span class="line">                <span class="keyword">for</span>(; (~p) &amp;&amp; (ch[p][c] == q); p = fail[p])</span><br><span class="line">                    ch[p][c] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = s.length();</span><br><span class="line">    SAM2::init();</span><br><span class="line">    <span class="keyword">int</span> las = <span class="number">0</span>, rt = <span class="number">0</span>, c, nl = <span class="number">0</span>;</span><br><span class="line">    li res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> SAM2;</span><br><span class="line">    Fore(i, <span class="number">0</span>, l)</span><br><span class="line">    &#123;</span><br><span class="line">        las = Extend(las, c = s[i] - <span class="string">'a'</span>);</span><br><span class="line">        <span class="keyword">while</span>(rt &amp;&amp; (!SAM::ch[rt][c])) rt = SAM::fail[rt], nl = SAM::len[rt];</span><br><span class="line">        <span class="keyword">if</span>(SAM::ch[rt][c]) rt = SAM::ch[rt][c], nl++;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            res += min(len[las] - len[fail[las]], i + <span class="number">1</span> - nl);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(rt &amp;&amp; !SGT::QRY(nl - <span class="number">1</span>, SAM::node[rt]))</span><br><span class="line">            <span class="keyword">if</span>(--nl == SAM::len[SAM::fail[rt]])rt = SAM::fail[rt];</span><br><span class="line">        res += min(len[las] - len[fail[las]], i + <span class="number">1</span> - nl);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    SAM::Build(s);</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;T;</span><br><span class="line">    fore(i, <span class="number">1</span>, T)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s &gt;&gt; SGT::L &gt;&gt; SGT::R;</span><br><span class="line">        Cal(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5576"><a href="#5576" class="headerlink" title="5576"></a>5576</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">4e5</span> + <span class="number">500</span>, MAXN = <span class="number">2e4</span> + <span class="number">500</span>, MAXQ = <span class="number">1e5</span> + <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> _s[MAXL], *str[MAXN], *nstr = _s;</span><br><span class="line"><span class="keyword">int</span> Len[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tail, fail[MAXL &lt;&lt; <span class="number">1</span>], ch[MAXL &lt;&lt; <span class="number">1</span>][<span class="number">2</span>], len[MAXL &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> las)</span></span>&#123;</span><br><span class="line">    len[++tail] = len[las] + <span class="number">1</span>;</span><br><span class="line">    fail[tail] = <span class="number">0</span>;</span><br><span class="line">    ch[tail][<span class="number">0</span>] = ch[tail][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> tail;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SAM</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> root, las;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> np = newnode(las), p = las; las = np;</span><br><span class="line">        <span class="keyword">for</span>(; p &amp;&amp; (!ch[p][c]); p = fail[p])</span><br><span class="line">            ch[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span>(!p) fail[np] = root;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[q] == len[p] + <span class="number">1</span>) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = fail[np] = nq;</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[nq]));</span><br><span class="line">                <span class="keyword">for</span>(; p &amp;&amp; (ch[p][c] == q); p = fail[p])</span><br><span class="line">                    ch[p][c] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="keyword">char</span> *S, <span class="keyword">int</span> nlen)</span></span>&#123;</span><br><span class="line">        las = root = newnode(<span class="number">0</span>);</span><br><span class="line">        Fore(i, <span class="number">0</span>, nlen)</span><br><span class="line">            Add(S[i] - <span class="string">'0'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;sam[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> *slen[MAXN], _slen[MAXL &lt;&lt; <span class="number">3</span>], res[MAXQ], tp[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DATA</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, p;</span><br><span class="line">&#125;Q[MAXQ], QL[MAXQ], QR[MAXQ];</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span>&lt;pii, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Solve</span><span class="params">(<span class="keyword">int</span> sl, <span class="keyword">int</span> sr, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr, <span class="keyword">int</span> lim)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ql &gt; qr)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        fore(i, sl, sr)</span><br><span class="line">            <span class="keyword">if</span>(Len[i] &lt;= lim) tp[++tot] = i;</span><br><span class="line">        <span class="keyword">if</span>(tot) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span> lim &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> st = tp[(tot + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>], *nlen = _slen;</span><br><span class="line">    fore(i, sl, sr)&#123;</span><br><span class="line">        slen[i] = nlen;</span><br><span class="line">        nlen += (Len[st] + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Fore(i, <span class="number">0</span>, Len[st])slen[st][i] = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = st - <span class="number">1</span>; i &gt;= sl; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> np = sam[i].root, nexp, mlen = <span class="number">0</span>;</span><br><span class="line">        Fore(j, <span class="number">0</span>, Len[st])&#123;</span><br><span class="line">            nexp = str[st][j] - <span class="string">'0'</span>;</span><br><span class="line">            <span class="keyword">while</span>((np != sam[i].root) &amp;&amp; (!ch[np][nexp]))</span><br><span class="line">                np = fail[np],</span><br><span class="line">                mlen = len[np];</span><br><span class="line">            <span class="keyword">if</span>(ch[np][nexp])&#123;</span><br><span class="line">                np = ch[np][nexp];</span><br><span class="line">                mlen++;</span><br><span class="line">            &#125;</span><br><span class="line">            slen[i][j] = min(slen[i + <span class="number">1</span>][j], mlen);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = st + <span class="number">1</span>; i &lt;= sr; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> np = sam[i].root, nexp, mlen = <span class="number">0</span>;</span><br><span class="line">        Fore(j, <span class="number">0</span>, Len[st])&#123;</span><br><span class="line">            nexp = str[st][j] - <span class="string">'0'</span>;</span><br><span class="line">            <span class="keyword">while</span>(np != sam[i].root &amp;&amp; !ch[np][nexp])</span><br><span class="line">                np = fail[np],</span><br><span class="line">                mlen = len[np];</span><br><span class="line">            <span class="keyword">if</span>(ch[np][nexp])&#123;</span><br><span class="line">                np = ch[np][nexp];</span><br><span class="line">                mlen++;</span><br><span class="line">            &#125;</span><br><span class="line">            slen[i][j] = min(slen[i - <span class="number">1</span>][j], mlen);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> tpl = <span class="number">0</span>, tpr = <span class="number">0</span>;</span><br><span class="line">    fore(i, ql, qr)</span><br><span class="line">        <span class="keyword">if</span>(Q[i].l &lt;= st &amp;&amp; Q[i].r &gt;= st)&#123;</span><br><span class="line">            pii np = MP(Q[i].l, Q[i].r);</span><br><span class="line">            <span class="keyword">if</span>(mp.count(np))</span><br><span class="line">            &#123;</span><br><span class="line">                res[Q[i].p] = mp[np];</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">            Fore(j, <span class="number">0</span>, Len[st])</span><br><span class="line">                ret = max(ret, min(slen[Q[i].l][j], slen[Q[i].r][j]));</span><br><span class="line">            res[Q[i].p] = ret;</span><br><span class="line">            mp[np] = ret;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(Q[i].l &gt; st) QR[++tpr] = Q[i];</span><br><span class="line">        <span class="keyword">else</span> QL[++tpl] = Q[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> l1 = ql, nq = ql - <span class="number">1</span>, l2, r1, r2;</span><br><span class="line">    fore(i, <span class="number">1</span>, tpl) Q[++nq] = QL[i];</span><br><span class="line">    r1 = nq;</span><br><span class="line">    l2 = nq + <span class="number">1</span>;</span><br><span class="line">    fore(i, <span class="number">1</span>, tpr) Q[++nq] = QR[i];</span><br><span class="line">    r2 = nq;</span><br><span class="line">    Solve(sl, st - <span class="number">1</span>, l1, r1, lim);</span><br><span class="line">    Solve(st + <span class="number">1</span>, sr, l2, r2, lim);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    tail = <span class="number">0</span>;</span><br><span class="line">    len[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    fore(i, <span class="number">1</span>, n)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, str[i] = nstr);</span><br><span class="line">        Len[i] = <span class="built_in">strlen</span>(nstr);</span><br><span class="line">        sam[i].Build(str[i], Len[i]);</span><br><span class="line">        nstr += Len[i];</span><br><span class="line">    &#125;</span><br><span class="line">    fore(i, <span class="number">1</span>, m)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;Q[i].l, &amp;Q[i].r),</span><br><span class="line">        Q[i].p = i;</span><br><span class="line">    Solve(<span class="number">1</span>, n, <span class="number">1</span>, m, <span class="number">10</span>);</span><br><span class="line">    fore(i, <span class="number">1</span>, m)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, res[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6139"><a href="#6139" class="headerlink" title="6139"></a>6139</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">1e6</span> + <span class="number">5</span>, MAXC = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Trie&#123;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXL][MAXC], tail = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = s.length(), rt = <span class="number">0</span>, nex;</span><br><span class="line">        Fore(i, <span class="number">0</span>, len)&#123;</span><br><span class="line">            nex = s[i] - <span class="string">'a'</span>;</span><br><span class="line">            <span class="keyword">if</span>(!ch[rt][nex])ch[rt][nex] = ++tail;</span><br><span class="line">            rt = ch[rt][nex];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> maxl = <span class="number">0</span>, tail, fail[MAXL &lt;&lt; <span class="number">1</span>], ch[MAXL &lt;&lt; <span class="number">1</span>][MAXC], len[MAXL &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        tail = <span class="number">0</span>;</span><br><span class="line">        fail[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">        len[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> las)</span></span>&#123;</span><br><span class="line">        len[++tail] = len[las] + <span class="number">1</span>;</span><br><span class="line">        fail[tail] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[tail], <span class="number">0</span>, <span class="keyword">sizeof</span>(ch[tail]));</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Extend</span><span class="params">(<span class="keyword">int</span> las, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">        maxl++;</span><br><span class="line">        <span class="keyword">int</span> p = las, np = newnode(las);</span><br><span class="line">        <span class="keyword">for</span>(; (~p) &amp;&amp; !ch[p][c]; p = fail[p])</span><br><span class="line">            ch[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span>(!~p) fail[np] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[q] == len[p] + <span class="number">1</span>) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> nq = newnode(p);</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nq], ch[q], <span class="keyword">sizeof</span>(ch[q]));</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = fail[np] = nq;</span><br><span class="line">                <span class="keyword">for</span>(; (~p) &amp;&amp; ch[p][c] == q; p = fail[p])</span><br><span class="line">                    ch[p][c] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> C[MAXL], ST[MAXL &lt;&lt; <span class="number">1</span>], pos[MAXL];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SAM::init();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Trie::tail; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> las = pos[i];</span><br><span class="line">            Fore(j, <span class="number">0</span>, MAXC)</span><br><span class="line">                <span class="keyword">if</span>(Trie::ch[i][j])</span><br><span class="line">                    pos[Trie::ch[i][j]] = Extend(las, j);</span><br><span class="line">        &#125;</span><br><span class="line">        li res = <span class="number">0</span>;</span><br><span class="line">        fore(i, <span class="number">1</span>, tail)C[len[i]]++;</span><br><span class="line">        fore(i, <span class="number">1</span>, maxl)</span><br><span class="line">            C[i] += C[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = tail; i; i--)</span><br><span class="line">            ST[C[len[i]]--] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = tail; i; i--)</span><br><span class="line">            res += len[ST[i]] - len[fail[ST[i]]];</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">        Trie::Insert(s);</span><br><span class="line">    SAM::Cal();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/15/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E9%A2%98%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/15/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E9%A2%98%E9%9B%86/" itemprop="url">AC自动机题集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-15T10:55:31+08:00">
                2020-10-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%83%E4%B9%A0%E9%A2%98%E9%9B%86/" itemprop="url" rel="index">
                    <span itemprop="name">练习题集</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="POJ-1625-Censored"><a href="#POJ-1625-Censored" class="headerlink" title="POJ 1625.Censored!"></a><a href="http://poj.org/problem?id=1625" target="_blank" rel="noopener">POJ 1625.Censored!</a></h2><h3 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h3><p>给定字符集( $n$ 不大于50个)和违法字符串(数量 $p$ 不超过10个，单个长度 $l$ 不超过10)，问长度为M的不含违法字符串的字符的数量</p>
<h3 id="题解-AC自动机-DP-高精度"><a href="#题解-AC自动机-DP-高精度" class="headerlink" title="题解:AC自动机+DP+高精度"></a>题解:AC自动机+DP+高精度</h3><p>建立违法字符串的AC自动机，在fail树上反向跳转标记违法字符串(fail[p]指向的是p的后缀，fail[p]为违法字符串时p也违法)，然后处理出所有的合法转移(数量不超过 $p \cdot l \cdot n$ )，以$dp_{l,c}$ 为状态进行转移（l为字符串长度，c为当前所在结点)</p>
<p>没有取模，所以要用高精度</p>
<h2 id="POJ-2778-DNA-Sequence"><a href="#POJ-2778-DNA-Sequence" class="headerlink" title="POJ 2778.DNA Sequence"></a><a href="http://poj.org/problem?id=2778" target="_blank" rel="noopener">POJ 2778.DNA Sequence</a></h2><h3 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h3><p>与上一题类似，AC自动机规模更小，所求字符串长度范围增加至2000000000</p>
<h3 id="题解-AC自动机-DP-矩阵乘法"><a href="#题解-AC自动机-DP-矩阵乘法" class="headerlink" title="题解:AC自动机+DP+矩阵乘法"></a>题解:AC自动机+DP+矩阵乘法</h3><p>用矩乘加速DP过程即可</p>
<h2 id="HDU-2457-DNA-Repair"><a href="#HDU-2457-DNA-Repair" class="headerlink" title="HDU 2457 DNA Repair"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=2457" target="_blank" rel="noopener">HDU 2457 DNA Repair</a></h2><h3 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h3><p>字符集为ATCG，给定 $n\leq 50$ 个违法字符串，单个长度 $l \leq 20$ 。问对于一个长度为 $n\leq 1000$ 的字符串最少修改多少字符能够使得结果中无违法字符串</p>
<h3 id="题解-AC自动机-DP"><a href="#题解-AC自动机-DP" class="headerlink" title="题解:AC自动机+DP"></a>题解:AC自动机+DP</h3><p>避免违法转移，暴力DP即可</p>
<h2 id="HDU-2825-Wireless-Password"><a href="#HDU-2825-Wireless-Password" class="headerlink" title="HDU 2825 Wireless Password"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=2825" target="_blank" rel="noopener">HDU 2825 Wireless Password</a></h2><h3 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h3><p>问结果串中出现超过k个不同目标串的数量有多少个</p>
<h3 id="题解-AC自动机-状压DP"><a href="#题解-AC自动机-状压DP" class="headerlink" title="题解:AC自动机+状压DP"></a>题解:AC自动机+状压DP</h3><p>注意此处出现的是不同目标串，同一目标串出现两次也是按照一个算，因此要用状压进行记录。</p>
<h2 id="ZOJ-3228-Searching-the-String"><a href="#ZOJ-3228-Searching-the-String" class="headerlink" title="ZOJ 3228 Searching the String"></a><a href="https://zoj.pintia.cn/problem-sets/91827364500/problems/91827367940" target="_blank" rel="noopener">ZOJ 3228 Searching the String</a></h2><h3 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h3><p>问匹配串中每一个目标串出现的次数。</p>
<p>对每一个目标串有一个type，type=1表示两个目标串之间不能有重叠的部分，type=0表示可以重叠，例如ababa中，若type=1，则aba最多出现1次，type=2则最多出现两次</p>
<p>匹配串长度 $\leq 10^6$ ， 目标串的个数 $\leq 10^6$ ， 长度 $\leq 6$</p>
<h3 id="题解-AC自动机"><a href="#题解-AC自动机" class="headerlink" title="题解:AC自动机"></a>题解:AC自动机</h3><p>唯一需要注意的是速度，这道题让我注意到把fail数上的信息预处理出来有时候不如直接跳fail树快（其实本地没差别，被ZOJ针对了）</p>
<h2 id="HDU-3247-Resource-Archiver"><a href="#HDU-3247-Resource-Archiver" class="headerlink" title="HDU 3247 Resource Archiver"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=3247" target="_blank" rel="noopener">HDU 3247 Resource Archiver</a></h2><h3 id="题意-5"><a href="#题意-5" class="headerlink" title="题意"></a>题意</h3><p>给定若 $n\leq 10$ 个合法字符串( $l \leq 1000$) ，$m\leq 1000$ 个非法串( $l\leq 10$ ) ，问之要需要多长的字符串才能够包括所有的合法字符串，同时不包括非法串</p>
<h3 id="题解-AC自动机-BFS-状态压缩"><a href="#题解-AC自动机-BFS-状态压缩" class="headerlink" title="题解:AC自动机+BFS+状态压缩"></a>题解:AC自动机+BFS+状态压缩</h3><p>建AC自动机，给合法串和非法串分别打上标记。注意到在DP过程中有作用的其实只有有标记的点，因此可以将树简化，只处理出合法标记之间的合法距离（BFS处理，过程中规避非法点），然后用状态压缩处理即可。</p>
<h2 id="HDU-3505-Writing-Robot"><a href="#HDU-3505-Writing-Robot" class="headerlink" title="HDU 3505 Writing Robot"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=3505" target="_blank" rel="noopener">HDU 3505 Writing Robot</a></h2><h3 id="题意-6"><a href="#题意-6" class="headerlink" title="题意"></a>题意</h3><p>给定若干子串，每个子串有一个正权一个负权；给定若干个主串，主串的权值由它包含的所有子串的正权相加得到。现在选择若干主串，其权值相加，减去其中包含的子串的负权（所有子串的负权仅被计算一次），得到最终收益，问最大收益时多少。</p>
<h3 id="题解-AC自动机-最大权闭合子图"><a href="#题解-AC自动机-最大权闭合子图" class="headerlink" title="题解:AC自动机+最大权闭合子图"></a>题解:AC自动机+最大权闭合子图</h3><h2 id="CodeChef-Favourite-Numbers"><a href="#CodeChef-Favourite-Numbers" class="headerlink" title="CodeChef Favourite Numbers"></a><a href="https://www.codechef.com/problems/FAVNUM" target="_blank" rel="noopener">CodeChef Favourite Numbers</a></h2><h3 id="题意-7"><a href="#题意-7" class="headerlink" title="题意"></a>题意</h3><p>给定若干数字串为合法串，问区间 $<a href="L,R \leq 10^{18}">L, R</a>$ 内第 $K$ 大的含有合法串的数字是多少</p>
<h3 id="题解-AC自动机-数位DP-二分"><a href="#题解-AC自动机-数位DP-二分" class="headerlink" title="题解:AC自动机+数位DP+二分"></a>题解:AC自动机+数位DP+二分</h3><p>包含某个数字的在区间内的数字 $\to$ 数位DP</p>
<p>若干合法数字串 $\to$ 多子串匹配 $\to$ AC自动机</p>
<p>第 $K$ 大 $\to$ 二分</p>
<h2 id="HDU-4117-SPOJ-9941-GRE-Words"><a href="#HDU-4117-SPOJ-9941-GRE-Words" class="headerlink" title="HDU 4117/SPOJ 9941 GRE Words"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4117" target="_blank" rel="noopener">HDU 4117/SPOJ 9941 GRE Words</a></h2><h3 id="题意-8"><a href="#题意-8" class="headerlink" title="题意"></a>题意</h3><p>给定若干字符串以及它们的权值（字符串个数 $n\leq 2\times 10^4$， 总长度 $\leq 3\times 10^5$） ，在不改变字符串之间的相对顺序的情况下可以删除若干个字符串，使得最终的字符串序列中，每两个相邻的字符串，前一个字符串是后一个字符串的子串，求最大权值和。</p>
<h3 id="题解-AC自动机-线段树"><a href="#题解-AC自动机-线段树" class="headerlink" title="题解:AC自动机+线段树"></a>题解:AC自动机+线段树</h3><p><strong>经验教训：</strong> 一开始理解错题意，以为是前面的所有字符串都是最后一个字符串的子串，结果越想越不可做</p>
<p>暴力的做法是建立AC自动机，$fail$ 树上记一个节点的最大值（初始为空），每次跑一个字符串，在 $fail$ 树上找到权值最大的一个节点，加上当前字符串的权值，更新答案，然后更新 $fail$ 树上的节点。</p>
<p>由于 $fail$ 树在 $3\times 10^5$ 的节点数的情况下深度可能十分巨大，因此会T。考虑 $fail$ 树的性质，反向建立 $fail$ 树，原本查询时向上查询父节点的操作变为了更新权值时对子树的更新。使用 DFS序+线段树 维护更新操作，查询时只需要在线段树内查询对应节点即可。 </p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="POJ-1625"><a href="#POJ-1625" class="headerlink" title="POJ-1625"></a>POJ-1625</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">505</span>, maxc = <span class="number">55</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bn</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> BASE=<span class="number">10000</span>, WIDTH = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;s;</span><br><span class="line">    bn()&#123;&#125;</span><br><span class="line">    bn <span class="keyword">operator</span> = (<span class="keyword">long</span> <span class="keyword">long</span> num)</span><br><span class="line">    &#123;</span><br><span class="line">        s.clear();</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            s.push_back(num%BASE);</span><br><span class="line">            num/=BASE;</span><br><span class="line">        &#125;<span class="keyword">while</span>(num);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    bn <span class="keyword">operator</span> + (bn &amp;b)</span><br><span class="line">    &#123;</span><br><span class="line">        bn c;</span><br><span class="line">        c.s.resize(max(s.size(), b.s.size()) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; c.s.size()<span class="number">-1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> tmp1, tmp2;</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= s.size()) tmp1 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> tmp1 = s[i];</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= b.s.size()) tmp2 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> tmp2 = b.s[i];</span><br><span class="line">            c.s[i] = tmp1 + tmp2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; c.s.size() - <span class="number">1</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            c.s[i + <span class="number">1</span>] += c.s[i]/BASE;</span><br><span class="line">            c.s[i] %= BASE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(c.s.back() == <span class="number">0</span> &amp;&amp; c.s.size() &gt; <span class="number">1</span>) c.s.pop_back();</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="keyword">operator</span> += (bn &amp;b)&#123;</span><br><span class="line">        *<span class="keyword">this</span> = *<span class="keyword">this</span> + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream&amp; <span class="keyword">operator</span> &lt;&lt; (ostream&amp; output, <span class="keyword">const</span> bn &amp;x)</span><br><span class="line">&#123;</span><br><span class="line">    output&lt;&lt;x.s.back();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = x.s.size() - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">        <span class="built_in">sprintf</span>(buf, <span class="string">"%04d"</span>, x.s[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(buf); j++) output &lt;&lt; buf[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = s.length(), cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">        mp[s[i]] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt;</span><br><span class="line"><span class="keyword">int</span> trie[maxn][maxc], fail[maxn], in[maxn], mk[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; edge[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> nxt, rt = <span class="number">0</span>, len = s.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = mp[s[i]];</span><br><span class="line">        <span class="keyword">if</span>(!trie[rt][nxt])</span><br><span class="line">            trie[rt][nxt] = ++cnt;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    mk[rt] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getfail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i])</span><br><span class="line">            fail[trie[<span class="number">0</span>][i]] = <span class="number">0</span>,</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">int</span> np;</span><br><span class="line">    <span class="keyword">while</span>(q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        np = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="keyword">if</span>(trie[np][i])</span><br><span class="line">            &#123;</span><br><span class="line">                fail[trie[np][i]] = trie[fail[np]][i];</span><br><span class="line">                edge[trie[fail[np]][i]].push_back(trie[np][i]);</span><br><span class="line">                in[trie[np][i]]++;</span><br><span class="line">                q.push(trie[np][i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                trie[np][i] = trie[fail[np]][i];</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bn dp[maxn][maxc];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> st)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">        <span class="keyword">if</span>(in[i] == <span class="number">0</span>)</span><br><span class="line">            q.push(i);</span><br><span class="line">    <span class="keyword">int</span> np;</span><br><span class="line">    <span class="keyword">while</span>(q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        np = q.front(); q.pop();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; edge[np].size(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[np][i];</span><br><span class="line">            in[v]--;</span><br><span class="line">            mk[v] |= mk[np];</span><br><span class="line">            <span class="keyword">if</span>(!in[v])q.push(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; st; j++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">            <span class="keyword">if</span>(dp[i][j].s.size())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++)</span><br><span class="line">                        <span class="keyword">if</span>(!mk[trie[i][k]])</span><br><span class="line">                            dp[trie[i][k]][j + <span class="number">1</span>] = dp[trie[i][k]][j + <span class="number">1</span>] + dp[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">    bn res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">        res = res + dp[i][st];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//freopen("Out.txt", "w", stdout);</span></span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; i++)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">        insert();</span><br><span class="line">    getfail();</span><br><span class="line">    cal(m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="POJ-2778"><a href="#POJ-2778" class="headerlink" title="POJ-2778"></a>POJ-2778</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e5</span>, MAXN = <span class="number">105</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> trie[MAXN][<span class="number">4</span>], mk[MAXN], fail[MAXN], In[MAXN];</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; Edge[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rt = <span class="number">0</span>, nxt;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = mp[s[i]];</span><br><span class="line">        <span class="keyword">if</span>(!trie[rt][nxt])</span><br><span class="line">            trie[rt][nxt] = ++cnt;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    mk[rt] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    li x[MAXN][MAXN];</span><br><span class="line">    node()&#123;<span class="built_in">memset</span>(x, <span class="number">0</span>, <span class="keyword">sizeof</span>(x));&#125;</span><br><span class="line">&#125;A, B;</span><br><span class="line"></span><br><span class="line"><span class="function">node <span class="title">mul</span><span class="params">(<span class="keyword">const</span> node &amp;XA, <span class="keyword">const</span> node &amp;XB)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node C;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> mid = <span class="number">0</span>; mid &lt;= cnt; mid++)</span><br><span class="line">                C.x[i][j] = (C.x[i][j] + XA.x[i][mid]*XB.x[mid][j]) % mod;</span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getfail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i])</span><br><span class="line">        &#123;</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line">            fail[trie[<span class="number">0</span>][i]] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">while</span>(q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> np = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            <span class="keyword">if</span>(trie[np][i])</span><br><span class="line">            &#123;</span><br><span class="line">                fail[trie[np][i]] = trie[fail[np]][i];</span><br><span class="line">                In[trie[np][i]]++;</span><br><span class="line">                Edge[fail[trie[np][i]]].push_back(trie[np][i]);</span><br><span class="line">                q.push(trie[np][i]);</span><br><span class="line">            &#125;<span class="keyword">else</span> trie[np][i] = trie[fail[np]][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cnt; i++)</span><br><span class="line">        <span class="keyword">if</span>(!In[i])q.push(i);</span><br><span class="line">    <span class="keyword">while</span>(q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> np = q.front(), v;</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Edge[np].size(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            v = Edge[np][i];</span><br><span class="line">            mk[v] |= mk[np];</span><br><span class="line">            In[v]--;</span><br><span class="line">            <span class="keyword">if</span>(!In[v])q.push(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">        <span class="keyword">if</span>(!mk[i])</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">            <span class="keyword">if</span>(!mk[trie[i][j]])</span><br><span class="line">                B.x[i][trie[i][j]]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(li n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    A.x[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(n &amp; <span class="number">1</span>) A = mul(A, B);</span><br><span class="line">        B = mul(B, B);</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    li res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">        res = (res + A.x[<span class="number">0</span>][i]) % mod;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mp[<span class="string">'A'</span>] = <span class="number">0</span>;</span><br><span class="line">    mp[<span class="string">'T'</span>] = <span class="number">1</span>;</span><br><span class="line">    mp[<span class="string">'C'</span>] = <span class="number">2</span>;</span><br><span class="line">    mp[<span class="string">'G'</span>] = <span class="number">3</span>;</span><br><span class="line">    li n, l;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; l;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">        insert(s);</span><br><span class="line">    getfail();</span><br><span class="line">    cal(l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HDU-2457"><a href="#HDU-2457" class="headerlink" title="HDU 2457"></a>HDU 2457</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1005</span>, MAXC = <span class="number">4</span>, inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line"><span class="keyword">int</span> cnt, trie[MAXN][MAXC], fail[MAXN];</span><br><span class="line"><span class="keyword">bool</span> mk[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rt = <span class="number">0</span>, len = s.length(), nxt;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = mp[s[i]];</span><br><span class="line">        <span class="keyword">if</span>(!trie[rt][nxt])</span><br><span class="line">            trie[rt][nxt] = ++cnt;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    mk[rt] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getfail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i])</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]),</span><br><span class="line">            fail[trie[<span class="number">0</span>][i]] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> np = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            <span class="keyword">if</span>(trie[np][i])</span><br><span class="line">            &#123;</span><br><span class="line">                fail[trie[np][i]] = trie[fail[np]][i];</span><br><span class="line">                mk[trie[np][i]] |= mk[fail[trie[np][i]]];</span><br><span class="line">                q.push(trie[np][i]);</span><br><span class="line">            &#125;<span class="keyword">else</span> trie[np][i] = trie[fail[np]][i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">2</span>][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dp, <span class="number">0x3f3f3f3f</span>, <span class="keyword">sizeof</span>(dp));</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> step = <span class="number">0</span>; step &lt; s.length(); step++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> ns = step &amp; <span class="number">1</span>, nxt = mp[s[step]];</span><br><span class="line">        <span class="built_in">memset</span>(dp[ns ^ <span class="number">1</span>], <span class="number">0x3f3f3f3f</span>, <span class="keyword">sizeof</span>(dp[ns ^ <span class="number">1</span>]));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">            <span class="keyword">if</span>(dp[ns][i] != inf)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">                    <span class="keyword">if</span>(!mk[trie[i][j]])</span><br><span class="line">                        dp[ns ^ <span class="number">1</span>][trie[i][j]] = min(dp[ns ^ <span class="number">1</span>][trie[i][j]], dp[ns][i] + (nxt != j));</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ns = s.length() &amp; <span class="number">1</span>, res = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">        res = min(res, dp[ns][i]);</span><br><span class="line">    <span class="keyword">if</span>(res == inf) <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mp[<span class="string">'A'</span>] = <span class="number">0</span>;</span><br><span class="line">    mp[<span class="string">'T'</span>] = <span class="number">1</span>;</span><br><span class="line">    mp[<span class="string">'C'</span>] = <span class="number">2</span>;</span><br><span class="line">    mp[<span class="string">'G'</span>] = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> n, ncase = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        ncase++;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Case "</span> &lt;&lt; ncase &lt;&lt; <span class="string">": "</span>; </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">            <span class="built_in">memset</span>(trie[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(trie[i])),</span><br><span class="line">            fail[i] = <span class="number">0</span>,</span><br><span class="line">            mk[i] = <span class="number">0</span>;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">            Insert();</span><br><span class="line">        getfail();</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">        cal();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ZOJ-3228"><a href="#ZOJ-3228" class="headerlink" title="ZOJ 3228"></a>ZOJ 3228</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize(2)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>, MAXL = <span class="number">7</span>, MAXC = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> S[MAXN], s[MAXN][MAXL];</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>, n, ol[MAXN], trie[MAXN*MAXL][MAXC], fail[MAXN * MAXL], mk[MAXN * MAXL], pos[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fore(i, <span class="number">0</span>, cnt)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(trie[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(trie[i]));</span><br><span class="line">        fail[i] = mk[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cnt = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">char</span> *c, <span class="keyword">int</span> ni)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rt = <span class="number">0</span>, len = <span class="built_in">strlen</span>(c), nxt;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = c[i] - <span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!trie[rt][nxt])</span><br><span class="line">            trie[rt][nxt] = ++cnt;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    mk[rt] = len;</span><br><span class="line">    pos[ni] = rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetFail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;Q;</span><br><span class="line">    <span class="keyword">int</span> np, nexp;</span><br><span class="line">    Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i])</span><br><span class="line">            Q.emplace(trie[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">while</span>(Q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        np = Q.front(); Q.pop();</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>((nexp = trie[np][i]) != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                fail[nexp] = trie[fail[np]][i];</span><br><span class="line">                Q.emplace(nexp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> trie[np][i] = trie[fail[np]][i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> las[MAXN * MAXL], res[MAXN * MAXL][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(las, <span class="number">-1</span>, <span class="keyword">sizeof</span>(las));</span><br><span class="line">    <span class="built_in">memset</span>(res, <span class="number">0</span>, <span class="keyword">sizeof</span>(res));</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(S), rt = <span class="number">0</span>, nxt, tmp;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = S[i] - <span class="string">'a'</span>;</span><br><span class="line">        tmp = rt = trie[rt][nxt];</span><br><span class="line">        <span class="keyword">while</span>(tmp)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(mk[tmp])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(i - las[tmp] &gt;= mk[tmp])</span><br><span class="line">                &#123;</span><br><span class="line">                    res[tmp][<span class="number">1</span>]++;</span><br><span class="line">                    las[tmp] = i;</span><br><span class="line">                &#125;</span><br><span class="line">                res[tmp][<span class="number">0</span>]++;</span><br><span class="line">            &#125;</span><br><span class="line">            tmp = fail[tmp];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("Out.txt", "w", stdout);</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ncase = <span class="number">1</span>; ~<span class="built_in">scanf</span>(<span class="string">"%s"</span>, S); ncase++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d\n"</span>, ncase);</span><br><span class="line">        init();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%s"</span>, &amp;ol[i], s[i]);</span><br><span class="line">            Insert(s[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        GetFail();</span><br><span class="line">        Cal();</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">             <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, res[pos[i]][ol[i]]);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HDU-3247"><a href="#HDU-3247" class="headerlink" title="HDU 3247"></a>HDU 3247</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x) (x &amp; (-x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">60005</span>, MAXC = <span class="number">2</span>, MAXM = <span class="number">12</span>, inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>, trie[MAXN][MAXC], fail[MAXN], mk[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; P[MAXM];</span><br><span class="line"><span class="keyword">int</span> dis[MAXN], Dis[MAXM][MAXM];</span><br><span class="line"><span class="keyword">bool</span> In[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> ni)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rt = <span class="number">0</span>, nxt, len = s.length();</span><br><span class="line">    Dis[<span class="number">0</span>][ni] = s.length();</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = s[i] - <span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!trie[rt][nxt])</span><br><span class="line">            trie[rt][nxt] = ++cnt;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    mk[rt] = (<span class="number">1</span>&lt;&lt;ni);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetFail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">    Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i])</span><br><span class="line">            Q.emplace(trie[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">int</span> np, nexp;</span><br><span class="line">    <span class="keyword">while</span>(Q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        np = Q.front(); Q.pop();</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">        <span class="keyword">if</span>((nexp = trie[np][i]) != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            fail[nexp] = trie[fail[np]][i];</span><br><span class="line">            mk[nexp] |= mk[fail[np]];</span><br><span class="line">            Q.emplace(nexp);</span><br><span class="line">        &#125;<span class="keyword">else</span> trie[np][i] = trie[fail[np]][i];</span><br><span class="line">    &#125;</span><br><span class="line">    fore(i, <span class="number">0</span>, cnt)</span><br><span class="line">        <span class="keyword">if</span>(mk[i] &amp;&amp; (!(mk[i] &amp; <span class="number">1</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = mk[i], tail;</span><br><span class="line">            <span class="keyword">for</span>(tail = lowbit(tmp); tmp; tmp -= tail, tail = lowbit(tmp))</span><br><span class="line">                P[__builtin_ctz(tail)].emplace_back(i);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Bfs</span><span class="params">(<span class="keyword">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fore(i, <span class="number">0</span>, cnt) dis[i] = inf, In[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> p : P[u])</span><br><span class="line">        Q.emplace(p),</span><br><span class="line">        dis[p] = <span class="number">0</span>,</span><br><span class="line">        In[p] = <span class="number">1</span>;</span><br><span class="line">    P[u].clear();</span><br><span class="line">    <span class="keyword">int</span> np, nexp;</span><br><span class="line">    <span class="keyword">while</span>(Q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        np = Q.front(); Q.pop();</span><br><span class="line">        In[np] = <span class="number">0</span>;</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>((nexp = trie[np][i]) != <span class="number">0</span> &amp;&amp; ((mk[nexp]&amp;<span class="number">1</span>) == <span class="number">0</span>) &amp;&amp; dis[nexp] &gt; dis[np] + <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                dis[nexp] = dis[np] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(!In[nexp])</span><br><span class="line">                &#123;</span><br><span class="line">                    In[nexp] = <span class="number">1</span>;</span><br><span class="line">                    Q.emplace(nexp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fore(i, <span class="number">0</span>, cnt)</span><br><span class="line">        <span class="keyword">if</span>(mk[i] &amp;&amp; (!(mk[i] &amp; <span class="number">1</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = mk[i], tail, v;</span><br><span class="line">            <span class="keyword">for</span>(tail = lowbit(tmp), v = __builtin_ctz(tail); tmp; tmp -= tail, tail = lowbit(tmp), v = __builtin_ctz(tail))</span><br><span class="line">                Dis[u][v] = min(Dis[u][v], dis[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Res[MAXM][<span class="number">2100</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Res, inf, <span class="keyword">sizeof</span>(Res));</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">        Res[i][<span class="number">1</span>&lt;&lt;i] = Dis[<span class="number">0</span>][i];</span><br><span class="line">    <span class="keyword">int</span> maxsta = (<span class="number">1</span> &lt;&lt; (n + <span class="number">1</span>)) - <span class="number">1</span>;</span><br><span class="line">    fore(sta, <span class="number">1</span>, maxsta)</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span>(Res[i][sta] != inf)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; i &lt;&lt; " " &lt;&lt; sta &lt;&lt; endl;</span></span><br><span class="line">            fore(j, <span class="number">1</span>, n)</span><br><span class="line">                Res[j][sta | (<span class="number">1</span> &lt;&lt; j)] = min(Res[j][sta | (<span class="number">1</span> &lt;&lt; j)], Res[i][sta] + Dis[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">int</span> res = inf;</span><br><span class="line">    maxsta--;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">        res = min(res, Res[i][maxsta]);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m) &amp;&amp; n &amp;&amp; m)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(Dis, inf, <span class="keyword">sizeof</span>(Dis));</span><br><span class="line">        fore(i, <span class="number">0</span>, cnt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(trie[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(trie[i]));</span><br><span class="line">            fail[i] = mk[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">            Insert(i);</span><br><span class="line">        fore(i, <span class="number">1</span>, m)</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">            Insert(<span class="number">0</span>);</span><br><span class="line">        GetFail();</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">            Bfs(i);</span><br><span class="line">        Cal(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HDU-3505"><a href="#HDU-3505" class="headerlink" title="HDU 3505"></a>HDU 3505</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i&lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">7505</span>, MAXC = <span class="number">26</span>, MAXM = <span class="number">1550</span>, inf = <span class="number">1000000</span>, MAXE = <span class="number">300005</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line"><span class="keyword">int</span> cnt, trie[MAXN][MAXC], fail[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; mk[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> ni)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rt = <span class="number">0</span>, len = s.length(), nxt;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = s[i] - <span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!trie[rt][nxt])</span><br><span class="line">            trie[rt][nxt] = ++cnt;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    mk[rt].emplace_back(ni);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetFail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">    Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i])</span><br><span class="line">            Q.emplace(trie[<span class="number">0</span>][i]),</span><br><span class="line">            fail[trie[<span class="number">0</span>][i]] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> np, nexp;</span><br><span class="line">    <span class="keyword">while</span>(Q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        np = Q.front(); Q.pop();</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>((nexp = trie[np][i]) != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                fail[nexp] = trie[fail[np]][i];</span><br><span class="line">                Q.emplace(nexp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> trie[np][i] = trie[fail[np]][i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> all = <span class="number">1</span>, S, E, mark[MAXM], l[MAXM], h[MAXM];</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> star[MAXM * <span class="number">2</span>], dis[MAXM * <span class="number">2</span>], Cnt[MAXM * <span class="number">2</span>], nxt[MAXE], ent[MAXE], len[MAXE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> l)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; u &lt;&lt; " " &lt;&lt; v &lt;&lt; " " &lt;&lt; l &lt;&lt; endl;</span></span><br><span class="line">    nxt[++all] = star[u];</span><br><span class="line">    star[u] = all;</span><br><span class="line">    ent[all] = v;</span><br><span class="line">    len[all] = l;</span><br><span class="line"></span><br><span class="line">    nxt[++all] = star[v];</span><br><span class="line">    star[v] = all;</span><br><span class="line">    ent[all] = u;</span><br><span class="line">    len[all] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> ni)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(mark, <span class="number">0</span>, <span class="keyword">sizeof</span>(mark));</span><br><span class="line">    <span class="keyword">int</span> rt = <span class="number">0</span>, len = s.length(), nxt, v = <span class="number">0</span>;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = s[i] - <span class="string">'a'</span>;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> temp = rt; temp; temp = fail[temp])</span><br><span class="line">            <span class="keyword">if</span>(mk[temp].size())</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> p : mk[temp])</span><br><span class="line">                &#123;</span><br><span class="line">                    v += l[p];</span><br><span class="line">                    <span class="keyword">if</span>(!mark[p])</span><br><span class="line">                    &#123;</span><br><span class="line">                        mark[p] = <span class="number">1</span>;</span><br><span class="line">                        Add(ni, p, inf);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res += v;</span><br><span class="line">    Add(S, ni, v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">SAP</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> flow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s == E) <span class="keyword">return</span> flow;</span><br><span class="line">    <span class="keyword">int</span> delta = <span class="number">0</span>, temp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> e, edge = star[s]; edge; edge = nxt[edge])</span><br><span class="line">        <span class="keyword">if</span>(len[edge] &amp;&amp; (dis[e = ent[edge]] + <span class="number">1</span> == dis[s]))</span><br><span class="line">        &#123;</span><br><span class="line">            temp = SAP(e, min(flow - delta, len[edge]));</span><br><span class="line">            len[edge] -= temp;</span><br><span class="line">            len[edge ^ <span class="number">1</span>] += temp;</span><br><span class="line">            delta += temp;</span><br><span class="line">            <span class="keyword">if</span>(delta == flow || dis[S] &gt;= E)<span class="keyword">return</span> delta;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span>(--Cnt[dis[s]] == <span class="number">0</span>)dis[S] = E;</span><br><span class="line">    Cnt[++dis[s]]++;</span><br><span class="line">    <span class="keyword">return</span> delta;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("Out.txt", "w", stdout);</span></span><br><span class="line">    <span class="keyword">int</span> T, ncase;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">cin</span> &gt;&gt; T, ncase = <span class="number">1</span>; ncase &lt;= T; ncase++)</span><br><span class="line">    &#123;</span><br><span class="line">        res = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(star, <span class="number">0</span>, <span class="keyword">sizeof</span>(star));</span><br><span class="line">        all = <span class="number">1</span>;</span><br><span class="line">        fore(i, <span class="number">0</span>, cnt) </span><br><span class="line">            <span class="built_in">memset</span>(trie[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(trie[i])),</span><br><span class="line">            fail[i] = <span class="number">0</span>,</span><br><span class="line">            mk[i].clear();</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> n, m;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">        S = n + m + <span class="number">1</span>;</span><br><span class="line">        E = n + m + <span class="number">2</span>;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; l[i] &gt;&gt; h[i] &gt;&gt; s;</span><br><span class="line">            Insert(i);</span><br><span class="line">            Add(i, E, h[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        GetFail();</span><br><span class="line">        fore(i, <span class="number">1</span>, m)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">            Build(n + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memset</span>(dis, <span class="number">0</span>, <span class="keyword">sizeof</span>(dis));</span><br><span class="line">        <span class="built_in">memset</span>(Cnt, <span class="number">0</span>, <span class="keyword">sizeof</span>(Cnt));</span><br><span class="line">        <span class="comment">// cout &lt;&lt; res &lt;&lt; endl;</span></span><br><span class="line">        <span class="keyword">while</span>(dis[S] &lt; E) res -= SAP(S, inf);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: %d\n"</span>, ncase, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CodeChef-Favorite-Numbers"><a href="#CodeChef-Favorite-Numbers" class="headerlink" title="CodeChef Favorite Numbers"></a>CodeChef Favorite Numbers</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1500</span>, MAXC = <span class="number">10</span>, MAXL = <span class="number">20</span>, isBound = <span class="number">2</span>, isFavor = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt, trie[MAXN][MAXC], fail[MAXN];</span><br><span class="line"><span class="keyword">bool</span> mk[MAXN];</span><br><span class="line">li dp[MAXN][MAXL][isBound][isFavor];</span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = s.length(), nxt, rt = <span class="number">0</span>;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = s[i] - <span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!trie[rt][nxt])</span><br><span class="line">            trie[rt][nxt] = ++cnt;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    mk[rt] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetFail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;Q;</span><br><span class="line">    Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i]) Q.emplace(trie[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">int</span> np, nexp;</span><br><span class="line">    <span class="keyword">while</span>(Q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        np = Q.front(); Q.pop();</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>((nexp = trie[np][i]) != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                fail[nexp] = trie[fail[np]][i];</span><br><span class="line">                mk[nexp] |= mk[fail[nexp]];</span><br><span class="line">                Q.emplace(nexp);</span><br><span class="line">            &#125;<span class="keyword">else</span> trie[np][i] = trie[fail[np]][i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">li <span class="title">CNT</span><span class="params">(<span class="built_in">string</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; s &lt;&lt; endl;</span></span><br><span class="line">    <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</span><br><span class="line">    <span class="keyword">int</span> len = s.length();</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; s.length(); l++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> np = <span class="number">0</span>; np &lt;= cnt; np++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> bo = <span class="number">0</span>; bo &lt; <span class="number">2</span>; bo++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> fv = <span class="number">0</span>; fv &lt; <span class="number">2</span>; fv++)</span><br><span class="line">        <span class="keyword">if</span>(dp[np][l][bo][fv])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> up, nexp;</span><br><span class="line">            <span class="keyword">if</span>(bo)</span><br><span class="line">            &#123;</span><br><span class="line">                up = s[l] - <span class="string">'0'</span>;</span><br><span class="line">                Fore(i, <span class="number">0</span>, up)</span><br><span class="line">                &#123;</span><br><span class="line">                    nexp = trie[np][i];</span><br><span class="line">                    dp[nexp][l + <span class="number">1</span>][<span class="number">0</span>][fv | mk[nexp]] += dp[np][l][bo][fv];</span><br><span class="line">                &#125;</span><br><span class="line">                nexp = trie[np][up];</span><br><span class="line">                dp[nexp][l + <span class="number">1</span>][<span class="number">1</span>][fv | mk[nexp]] += dp[np][l][bo][fv];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">                &#123;</span><br><span class="line">                    nexp = trie[np][i];</span><br><span class="line">                    dp[nexp][l + <span class="number">1</span>][<span class="number">0</span>][fv | mk[nexp]] += dp[np][l][<span class="number">0</span>][fv];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    li res = <span class="number">0</span>;</span><br><span class="line">    fore(np, <span class="number">0</span>, cnt)</span><br><span class="line">    Fore(bo, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">        res += dp[np][len][bo][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    li L, R, K, N;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; L &gt;&gt; R &gt;&gt; K &gt;&gt; N;</span><br><span class="line">    fore(i, <span class="number">1</span>, N)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s,</span><br><span class="line">        Insert();</span><br><span class="line">    GetFail();</span><br><span class="line">    li cntL = CNT(to_string(L - <span class="number">1</span>)), cntR = CNT(to_string(R));</span><br><span class="line">    <span class="keyword">if</span>(cntR - cntL &lt; K)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"no such number"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    li mid;</span><br><span class="line">    <span class="keyword">while</span>(L &lt; R)</span><br><span class="line">    &#123;</span><br><span class="line">        mid = (L + R) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(CNT(to_string(mid)) - cntL &gt;= K) R = mid;</span><br><span class="line">        <span class="keyword">else</span> L = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; R &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HDU-4117"><a href="#HDU-4117" class="headerlink" title="HDU 4117"></a>HDU 4117</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls (o &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs (o &lt;&lt; 1 | 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mid ((l + r) &gt;&gt; 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">5</span>, MAXC = <span class="number">26</span>, MAXM = <span class="number">2e4</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> vis, cnt = <span class="number">0</span>, In[MAXN], Out[MAXN], trie[MAXN][MAXC], fail[MAXN], mk[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; Edge[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> L, R, v, mx[MAXN &lt;&lt; <span class="number">3</span>], lazy[MAXN &lt;&lt; <span class="number">3</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        mx[o] = lazy[o] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(l &lt; r)</span><br><span class="line">        &#123;</span><br><span class="line">            Init(ls, l, mid);</span><br><span class="line">            Init(rs, mid + <span class="number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PD</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r)</span><br><span class="line">            mx[o] = max(mx[o], lazy[o]);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            lazy[ls] = max(lazy[ls], lazy[o]);</span><br><span class="line">            lazy[rs] = max(lazy[rs], lazy[o]);</span><br><span class="line">        &#125;</span><br><span class="line">        lazy[o] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modi</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lazy[o]) PD(o, l, r);</span><br><span class="line">        <span class="keyword">if</span>(l == r)</span><br><span class="line">        &#123;</span><br><span class="line">            mx[o] = max(mx[o], v);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R)</span><br><span class="line">        &#123;</span><br><span class="line">            lazy[o] = max(lazy[o], v);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(L &lt;= mid &amp;&amp; l &lt;= R) modi(ls, l, mid);</span><br><span class="line">        <span class="keyword">if</span>(L &lt;= R &amp;&amp; mid &lt; R) modi(rs, mid + <span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MODI</span><span class="params">(<span class="keyword">int</span> NL, <span class="keyword">int</span> NR, <span class="keyword">int</span> NV)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        L = NL;</span><br><span class="line">        R = NR;</span><br><span class="line">        v = NV;</span><br><span class="line">        modi(<span class="number">1</span>, <span class="number">1</span>, vis);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lazy[o])PD(o, l, r);</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span> mx[o];</span><br><span class="line">        <span class="keyword">if</span>(p &lt;= mid) <span class="keyword">return</span> cal(ls, l, mid, p);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> cal(rs, mid + <span class="number">1</span>, r, p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">CAL</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;<span class="keyword">return</span> cal(<span class="number">1</span>, <span class="number">1</span>, vis, p);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Insert</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = s.length(), nxt, rt = <span class="number">0</span>;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        nxt = s[i] - <span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!trie[rt][nxt])</span><br><span class="line">            trie[rt][nxt] = ++cnt;</span><br><span class="line">        rt = trie[rt][nxt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    In[u] = ++vis;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> v : Edge[u])</span><br><span class="line">        Dfs(v);</span><br><span class="line">    Out[u] = vis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetFail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;Q;</span><br><span class="line">    Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i])</span><br><span class="line">            Q.emplace(trie[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">int</span> np, nexp;</span><br><span class="line">    <span class="keyword">while</span>(Q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        np = Q.front(); Q.pop();</span><br><span class="line">        Fore(i, <span class="number">0</span>, MAXC)</span><br><span class="line">            <span class="keyword">if</span>((nexp = trie[np][i]) != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                fail[nexp] = trie[fail[np]][i];</span><br><span class="line">                mk[nexp] = <span class="number">1</span>;</span><br><span class="line">                Edge[fail[nexp]].emplace_back(nexp);</span><br><span class="line">                Q.emplace(nexp);</span><br><span class="line">            &#125;<span class="keyword">else</span> trie[np][i] = trie[fail[np]][i];</span><br><span class="line">    &#125;</span><br><span class="line">    vis = <span class="number">0</span>;</span><br><span class="line">    fore(i, <span class="number">0</span>, cnt)</span><br><span class="line">        <span class="keyword">if</span>(!mk[i])</span><br><span class="line">            Dfs(i);</span><br><span class="line">    SGT::Init(<span class="number">1</span>, <span class="number">1</span>, vis);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Cal</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = s.length(), rt = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">    &#123;</span><br><span class="line">        rt = trie[rt][s[i] - <span class="string">'a'</span>];</span><br><span class="line">        ans = max(ans, SGT::CAL(In[rt]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> v[MAXM], p[MAXM];</span><br><span class="line"><span class="built_in">string</span> s[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T, ncase;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">cin</span> &gt;&gt; T, ncase = <span class="number">1</span>; ncase &lt;= T; ncase++)</span><br><span class="line">    &#123;</span><br><span class="line">        fore(i, <span class="number">0</span>, cnt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(trie[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(trie[i]));</span><br><span class="line">            fail[i] = mk[i] = <span class="number">0</span>;</span><br><span class="line">            Edge[i].clear();</span><br><span class="line">        &#125;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; s[i] &gt;&gt; v[i];</span><br><span class="line">            p[i] = Insert(s[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        GetFail();</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>, tmp;</span><br><span class="line">        fore(i, <span class="number">1</span>, n)</span><br><span class="line">        &#123;</span><br><span class="line">            tmp = Cal(s[i]) + v[i];</span><br><span class="line">            res = max(tmp, res);</span><br><span class="line">            <span class="keyword">int</span> L = In[p[i]], R = Out[p[i]];</span><br><span class="line">            SGT::MODI(L, R, tmp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Case #"</span> &lt;&lt; ncase &lt;&lt; <span class="string">": "</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/13/SWERC2019-20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/13/SWERC2019-20/" itemprop="url">SWERC2019-20</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-13T17:59:35+08:00">
                2020-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ICPC/" itemprop="url" rel="index">
                    <span itemprop="name">ICPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="A-Environmental-Friendly-Travel"><a href="#A-Environmental-Friendly-Travel" class="headerlink" title="A.Environmental-Friendly Travel"></a><a href="https://codeforces.com/gym/102501/problem/A" target="_blank" rel="noopener">A.Environmental-Friendly Travel</a></h2><h3 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h3><p>给定一张二维平面上的图，图中有 $n\leq 1000$ 个点， 每个点最多连 100 条边，两点 $a, b$ 之间通行代价=单价$C_i$ $\times$ 距离 $dist(a, b)$（有许多不同种类的单价,dist为两点的欧几里得距离向上取整），问从起点到终点总距离不超过 $B \leq 100$ 的最小代价</p>
<h3 id="题解-DP"><a href="#题解-DP" class="headerlink" title="题解:DP"></a>题解:DP</h3><p>关键点在于 $n\times B \leq 100000$ 以及边数的限制， 以 $dp[dis][cost]$ 为状态进行暴力转移即可</p>
<h2 id="D-Gnalcats"><a href="#D-Gnalcats" class="headerlink" title="D.Gnalcats"></a><a href="https://codeforces.com/gym/102501/problem/D" target="_blank" rel="noopener">D.Gnalcats</a></h2><h3 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h3><p>对于一串序列，给定若干种方式，对序列中的头两个元素进行若干种操作，包括将两个元素组合成一个元素和将组合的元素拆分成两个元素。<br>问对于初始状态相同的两串序列，执行两段不超过 $10^4$ 次操作后， 两个结果序列是否相同</p>
<h3 id="题解-模拟"><a href="#题解-模拟" class="headerlink" title="题解:模拟"></a>题解:模拟</h3><p>对于一串操作序列而言，所用到的元素最多就是1e4，且只对前两个元素进行操作，所以用栈实现十分可行。唯一的问题在于序列的组合和复制会在直接模拟中可以让操作规模指数增长。<br>要解决这个问题，要注意到一个性质，每一次组合都是将两个元素组合成一个元素，解组也是相同的，因此我们将组合映射成单个元素，用map记录组合的映射关系即可。</p>
<h2 id="G-Swapping-Places"><a href="#G-Swapping-Places" class="headerlink" title="G.Swapping Places"></a><a href="https://codeforces.com/gym/102501/problem/G" target="_blank" rel="noopener">G.Swapping Places</a></h2><h3 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h3><p>给定一个字符串队列（长度&lt;1e5），队列元素不超过200个，给定若干个关系对 $A B$，代表相邻的 $A B$ 的位置可以交换，输出在交换位置后，最小字典序的队列。</p>
<h3 id="题解-拓扑排序"><a href="#题解-拓扑排序" class="headerlink" title="题解:拓扑排序"></a>题解:拓扑排序</h3><p>考虑一种贪心原则，字典序从小到大依次操作，对于每一个元素，都尽量向前移动（让字典序更小）。当前元素无法移动时，一定不存在操作让当前元素移动后结果字典序更小。<br>这个贪心原则的实现在于划定界限：确定一个元素所能够移动到的最远边界<br>考虑拓扑排序，对于每个元素，连一条边到它前方所有无法交换的元素的第一个，由前方的边连向它。这样，在输出拓扑序列时，它的位置一定在那些元素之后，这样就起到了限制的作用。至于可以交换的边，输出最小拓扑序的过程中会自动将它们排序。</p>
<h2 id="H-Pseudo-Random-Number-Generator"><a href="#H-Pseudo-Random-Number-Generator" class="headerlink" title="H.Pseudo-Random Number Generator"></a><a href>H.Pseudo-Random Number Generator</a></h2><h3 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h3><p>给一个递推表达式和初值，表达式每次结果对 $2^{40}$ 取模，问第 1 项到第 $n\leq2^{63}$ 项中有多少偶数项</p>
<h3 id="题解-Floyd判环法-打表"><a href="#题解-Floyd判环法-打表" class="headerlink" title="题解:Floyd判环法+打表"></a>题解:Floyd判环法+打表</h3><p>考虑到 $n &lt;&lt; 2^{40}$， 所以数列中一定存在环。如果强行记录所有数据来判环则空间会爆，用 Floyd判环法先找出环的起点(这个数列的前面几项不一定在环中)，然后分段打表，最终环的大小打1000段即可。</p>
<h2 id="K-Birdwatching"><a href="#K-Birdwatching" class="headerlink" title="K.Birdwatching"></a><a href="https://codeforces.com/gym/102501/problem/K" target="_blank" rel="noopener">K.Birdwatching</a></h2><h3 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h3><p>规定一个终点，对于其它的点，按字典序从小到大输出所有只有一条路径能够到达它的点。</p>
<h3 id="题解-染色法"><a href="#题解-染色法" class="headerlink" title="题解:染色法"></a>题解:染色法</h3><p>反向建图，将终点作为分割点，把图化为若干子图。对与终点连接的每个点进行深搜并染色。显然满足条件的点只能被最多染上一种颜色，同时只能被一个点染色（有效入度为1）</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="D"><a href="#D" class="headerlink" title="D"></a>D</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MP make_pair</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">map</span>&lt;pii, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, pii&gt; PAIR;</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">string</span> SA, SB;</span><br><span class="line"><span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; TA, TB;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Solve</span><span class="params">(<span class="built_in">string</span> &amp;S, <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; &amp;st)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1e4</span>; i; i--)st.emplace(i);</span><br><span class="line">    <span class="keyword">bool</span> fail = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S.size() &amp;&amp; !fail; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// cout &lt;&lt; st.top() &lt;&lt; endl;</span></span><br><span class="line">        <span class="keyword">switch</span> (S[i])</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'C'</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            st.emplace(st.top());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'D'</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            st.pop();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'L'</span>: <span class="keyword">case</span> <span class="string">'R'</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(PAIR.find(st.top()) == PAIR.end())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// cout &lt;&lt; st.top() &lt;&lt; endl;</span></span><br><span class="line">                fail = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                pii np = PAIR[st.top()];</span><br><span class="line">                st.pop();</span><br><span class="line">                st.emplace(S[i] == <span class="string">'L'</span> ? np.first : np.second);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'S'</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> l, r;</span><br><span class="line">            l = st.top(); st.pop();</span><br><span class="line">            r = st.top(); st.pop();</span><br><span class="line">            st.emplace(l);</span><br><span class="line">            st.emplace(r);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'P'</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> l, r;</span><br><span class="line">            l = st.top(); st.pop();</span><br><span class="line">            r = st.top(); st.pop();</span><br><span class="line">            pii np = MP(l, r);</span><br><span class="line">            <span class="keyword">if</span>(mp.find(np) == mp.end())</span><br><span class="line">            &#123;</span><br><span class="line">                mp[np] = ++cnt;</span><br><span class="line">                PAIR[cnt] = np;</span><br><span class="line">            &#125;</span><br><span class="line">            st.emplace(mp[np]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'U'</span>:</span><br><span class="line">            <span class="keyword">int</span> l = st.top(); st.pop();</span><br><span class="line">            <span class="keyword">if</span>(PAIR.find(l) == PAIR.end())</span><br><span class="line">            &#123;</span><br><span class="line">                fail = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                pii np = PAIR[l];</span><br><span class="line">                st.emplace(np.second);</span><br><span class="line">                st.emplace(np.first);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; "FAIL :" &lt;&lt; fail &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">return</span> fail;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Check</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(TA.size() != TB.size()) <span class="built_in">puts</span>(<span class="string">"False"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(TA.size())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//cout &lt;&lt; TA.top() &lt;&lt; " " &lt;&lt; TB.top() &lt;&lt; endl;</span></span><br><span class="line">            <span class="keyword">if</span>(TA.top() != TB.top())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">"False"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            TA.pop(); TB.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"True"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r", stdin);</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; SA &gt;&gt; SB;</span><br><span class="line">    <span class="keyword">bool</span> MA = Solve(SA, TA);</span><br><span class="line">    <span class="keyword">bool</span> MB = Solve(SB, TB);</span><br><span class="line">    <span class="comment">// cout &lt;&lt; MA &lt;&lt; " "&lt;&lt; MB &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">if</span>(MA&amp;&amp;MB)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"True"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(MA != MB)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"False"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Check();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="G"><a href="#G" class="headerlink" title="G"></a>G</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">205</span>, MAXK = <span class="number">1e5</span> + <span class="number">5</span>, inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">map</span> &lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; S;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; Edge[MAXK];</span><br><span class="line"><span class="keyword">bool</span> Link[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> A[MAXK], In[MAXK], pos[MAXN];</span><br><span class="line">priority_queue&lt;pii, <span class="built_in">vector</span>&lt;pii&gt;, greater&lt;pii&gt; &gt; Q;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TOPSORT</span><span class="params">(<span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fore(i, <span class="number">1</span>, k) <span class="keyword">if</span>(!In[i]) Q.emplace(A[i], i);</span><br><span class="line">    <span class="keyword">int</span> u;</span><br><span class="line">    <span class="keyword">while</span>(Q.size())</span><br><span class="line">    &#123;</span><br><span class="line">        pii np = Q.top();</span><br><span class="line">        Q.pop();</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; S[np.first] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        u = np.second;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> v : Edge[u])</span><br><span class="line">        &#123;</span><br><span class="line">            In[v]--;</span><br><span class="line">            <span class="keyword">if</span>(!In[v]) Q.emplace(A[v], v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r" ,stdin);</span></span><br><span class="line">    <span class="keyword">int</span> n, m, k;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">        S.emplace_back(s);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(S.begin(), S.end());</span><br><span class="line">    Fore(i, <span class="number">0</span>, n)</span><br><span class="line">        mp[S[i]] = i;</span><br><span class="line"><span class="comment">//        Link[i][i] = 1;</span></span><br><span class="line">    <span class="built_in">string</span> su, sv;</span><br><span class="line">    <span class="keyword">int</span> u, v;</span><br><span class="line">    fore(i, <span class="number">1</span>, m)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; su &gt;&gt; sv;</span><br><span class="line">        u = mp[su]; v = mp[sv];</span><br><span class="line">        Link[u][v] = Link[v][u] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fore(i, <span class="number">1</span>, k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; su;</span><br><span class="line">        A[i] = mp[su];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> npos;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = k; i; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        npos = inf;</span><br><span class="line">        Fore(j, <span class="number">0</span>, n)</span><br><span class="line">            <span class="keyword">if</span>(!Link[A[i]][j] &amp;&amp; pos[j])</span><br><span class="line">            &#123;</span><br><span class="line">                npos = pos[j];</span><br><span class="line">                Edge[i].emplace_back(npos);</span><br><span class="line">                In[npos]++;</span><br><span class="line">            &#125;</span><br><span class="line">        pos[A[i]] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    TOPSORT(k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="H"><a href="#H" class="headerlink" title="H"></a>H</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> nxt(v) ((v + (v &gt;&gt; 20) + a) &amp; MOD)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> li MOD = (<span class="number">1L</span>L&lt;&lt;<span class="number">40</span>) - <span class="number">1</span>, a = <span class="number">12345</span>, v0 = <span class="number">0x600DCAFE</span>;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> st = <span class="number">350125310</span>, len = <span class="number">182129209</span>;</span><br><span class="line"> </span><br><span class="line">li cntst[<span class="number">352</span>] = &#123;<span class="number">1</span>,<span class="number">502984</span>,<span class="number">995306</span>,<span class="number">1498258</span>,<span class="number">1998844</span>,<span class="number">2500401</span>,<span class="number">3001393</span>,<span class="number">3500190</span>,<span class="number">3999082</span>,<span class="number">4500820</span>,<span class="number">5004364</span>,<span class="number">5512698</span>,<span class="number">6011436</span>,<span class="number">6511002</span>,<span class="number">7012601</span>,<span class="number">7500029</span>,<span class="number">8002855</span>,<span class="number">8499689</span>,<span class="number">9000464</span>,<span class="number">9504061</span>,<span class="number">10006017</span>,<span class="number">10504170</span>,<span class="number">11005541</span>,<span class="number">11505757</span>,<span class="number">12003251</span>,<span class="number">12506329</span>,<span class="number">13006130</span>,<span class="number">13506761</span>,<span class="number">14003714</span>,<span class="number">14508694</span>,<span class="number">15011683</span>,<span class="number">15514848</span>,<span class="number">16015235</span>,<span class="number">16516067</span>,<span class="number">17013805</span>,<span class="number">17517443</span>,<span class="number">18017774</span>,<span class="number">18516743</span>,<span class="number">19017244</span>,<span class="number">19515097</span>,<span class="number">20012408</span>,<span class="number">20513726</span>,<span class="number">21014794</span>,<span class="number">21521369</span>,<span class="number">22028493</span>,<span class="number">22530434</span>,<span class="number">23031470</span>,<span class="number">23537551</span>,<span class="number">24032363</span>,<span class="number">24530609</span>,<span class="number">25031296</span>,<span class="number">25533395</span>,<span class="number">26034534</span>,<span class="number">26540391</span>,<span class="number">27038505</span>,<span class="number">27539195</span>,<span class="number">28039980</span>,<span class="number">28541830</span>,<span class="number">29040198</span>,<span class="number">29539710</span>,<span class="number">30040232</span>,<span class="number">30539973</span>,<span class="number">31037671</span>,<span class="number">31539441</span>,<span class="number">32037696</span>,<span class="number">32538480</span>,<span class="number">33040920</span>,<span class="number">33543018</span>,<span class="number">34042894</span>,<span class="number">34544672</span>,<span class="number">35042602</span>,<span class="number">35544908</span>,<span class="number">36038770</span>,<span class="number">36539206</span>,<span class="number">37041078</span>,<span class="number">37541450</span>,<span class="number">38036709</span>,<span class="number">38537906</span>,<span class="number">39039571</span>,<span class="number">39539377</span>,<span class="number">40042828</span>,<span class="number">40547257</span>,<span class="number">41043465</span>,<span class="number">41545884</span>,<span class="number">42047578</span>,<span class="number">42546233</span>,<span class="number">43049621</span>,<span class="number">43551063</span>,<span class="number">44052909</span>,<span class="number">44554559</span>,<span class="number">45056959</span>,<span class="number">45554672</span>,<span class="number">46052912</span>,<span class="number">46552064</span>,<span class="number">47050518</span>,<span class="number">47548216</span>,<span class="number">48046434</span>,<span class="number">48544071</span>,<span class="number">49048470</span>,<span class="number">49549754</span>,<span class="number">50056831</span>,<span class="number">50557376</span>,<span class="number">51058008</span>,<span class="number">51557273</span>,<span class="number">52058653</span>,<span class="number">52565704</span>,<span class="number">53064233</span>,<span class="number">53564851</span>,<span class="number">54060933</span>,<span class="number">54556692</span>,<span class="number">55056278</span>,<span class="number">55556726</span>,<span class="number">56054527</span>,<span class="number">56555312</span>,<span class="number">57060178</span>,<span class="number">57559660</span>,<span class="number">58061102</span>,<span class="number">58560779</span>,<span class="number">59060167</span>,<span class="number">59564033</span>,<span class="number">60057168</span>,<span class="number">60559019</span>,<span class="number">61060773</span>,<span class="number">61558121</span>,<span class="number">62056275</span>,<span class="number">62554179</span>,<span class="number">63053854</span>,<span class="number">63560321</span>,<span class="number">64057793</span>,<span class="number">64560045</span>,<span class="number">65062411</span>,<span class="number">65562338</span>,<span class="number">66066909</span>,<span class="number">66572917</span>,<span class="number">67074121</span>,<span class="number">67574933</span>,<span class="number">68077204</span>,<span class="number">68576836</span>,<span class="number">69074813</span>,<span class="number">69578219</span>,<span class="number">70077204</span>,<span class="number">70572325</span>,<span class="number">71072154</span>,<span class="number">71571244</span>,<span class="number">72070164</span>,<span class="number">72572034</span>,<span class="number">73073858</span>,<span class="number">73576657</span>,<span class="number">74076618</span>,<span class="number">74575254</span>,<span class="number">75074286</span>,<span class="number">75578103</span>,<span class="number">76080479</span>,<span class="number">76581009</span>,<span class="number">77082752</span>,<span class="number">77586589</span>,<span class="number">78083423</span>,<span class="number">78588163</span>,<span class="number">79089032</span>,<span class="number">79587502</span>,<span class="number">80089334</span>,<span class="number">80589335</span>,<span class="number">81086972</span>,<span class="number">81585288</span>,<span class="number">82082869</span>,<span class="number">82577797</span>,<span class="number">83075877</span>,<span class="number">83574667</span>,<span class="number">84074594</span>,<span class="number">84578690</span>,<span class="number">85076566</span>,<span class="number">85577765</span>,<span class="number">86077885</span>,<span class="number">86575098</span>,<span class="number">87071797</span>,<span class="number">87569837</span>,<span class="number">88066475</span>,<span class="number">88565277</span>,<span class="number">89061258</span>,<span class="number">89557867</span>,<span class="number">90060817</span>,<span class="number">90559357</span>,<span class="number">91057197</span>,<span class="number">91554797</span>,<span class="number">92059329</span>,<span class="number">92557144</span>,<span class="number">93053611</span>,<span class="number">93558722</span>,<span class="number">94066087</span>,<span class="number">94568344</span>,<span class="number">95067617</span>,<span class="number">95568007</span>,<span class="number">96069983</span>,<span class="number">96578839</span>,<span class="number">97082646</span>,<span class="number">97582000</span>,<span class="number">98083970</span>,<span class="number">98584271</span>,<span class="number">99089614</span>,<span class="number">99588123</span>,<span class="number">100089173</span>,<span class="number">100587587</span>,<span class="number">101080653</span>,<span class="number">101581033</span>,<span class="number">102077740</span>,<span class="number">102578453</span>,<span class="number">103084620</span>,<span class="number">103581261</span>,<span class="number">104078916</span>,<span class="number">104578791</span>,<span class="number">105080524</span>,<span class="number">105576391</span>,<span class="number">106075637</span>,<span class="number">106578726</span>,<span class="number">107076332</span>,<span class="number">107578420</span>,<span class="number">108087162</span>,<span class="number">108592028</span>,<span class="number">109088096</span>,<span class="number">109590435</span>,<span class="number">110081437</span>,<span class="number">110584146</span>,<span class="number">111084446</span>,<span class="number">111582688</span>,<span class="number">112082235</span>,<span class="number">112579315</span>,<span class="number">113075875</span>,<span class="number">113580176</span>,<span class="number">114079359</span>,<span class="number">114578150</span>,<span class="number">115071718</span>,<span class="number">115569496</span>,<span class="number">116070241</span>,<span class="number">116572062</span>,<span class="number">117077203</span>,<span class="number">117584728</span>,<span class="number">118087024</span>,<span class="number">118588258</span>,<span class="number">119089313</span>,<span class="number">119593213</span>,<span class="number">120091493</span>,<span class="number">120589824</span>,<span class="number">121090065</span>,<span class="number">121591532</span>,<span class="number">122096449</span>,<span class="number">122603663</span>,<span class="number">123105791</span>,<span class="number">123604624</span>,<span class="number">124099108</span>,<span class="number">124603005</span>,<span class="number">125100277</span>,<span class="number">125599822</span>,<span class="number">126098295</span>,<span class="number">126601495</span>,<span class="number">127097435</span>,<span class="number">127598938</span>,<span class="number">128098749</span>,<span class="number">128598478</span>,<span class="number">129099927</span>,<span class="number">129606265</span>,<span class="number">130104566</span>,<span class="number">130608500</span>,<span class="number">131101704</span>,<span class="number">131599111</span>,<span class="number">132104529</span>,<span class="number">132606644</span>,<span class="number">133105067</span>,<span class="number">133613967</span>,<span class="number">134112909</span>,<span class="number">134614468</span>,<span class="number">135114812</span>,<span class="number">135611589</span>,<span class="number">136107892</span>,<span class="number">136605753</span>,<span class="number">137105533</span>,<span class="number">137604957</span>,<span class="number">138104641</span>,<span class="number">138612280</span>,<span class="number">139114170</span>,<span class="number">139611189</span>,<span class="number">140110603</span>,<span class="number">140616828</span>,<span class="number">141115404</span>,<span class="number">141616541</span>,<span class="number">142117990</span>,<span class="number">142613775</span>,<span class="number">143106656</span>,<span class="number">143615170</span>,<span class="number">144114855</span>,<span class="number">144614440</span>,<span class="number">145118771</span>,<span class="number">145613726</span>,<span class="number">146116601</span>,<span class="number">146615821</span>,<span class="number">147114827</span>,<span class="number">147616701</span>,<span class="number">148117857</span>,<span class="number">148619782</span>,<span class="number">149119782</span>,<span class="number">149619012</span>,<span class="number">150119937</span>,<span class="number">150621712</span>,<span class="number">151122090</span>,<span class="number">151619911</span>,<span class="number">152113038</span>,<span class="number">152614526</span>,<span class="number">153117304</span>,<span class="number">153617158</span>,<span class="number">154118720</span>,<span class="number">154618656</span>,<span class="number">155117508</span>,<span class="number">155615238</span>,<span class="number">156115832</span>,<span class="number">156613957</span>,<span class="number">157108725</span>,<span class="number">157608613</span>,<span class="number">158110685</span>,<span class="number">158607152</span>,<span class="number">159109836</span>,<span class="number">159609212</span>,<span class="number">160106698</span>,<span class="number">160604579</span>,<span class="number">161105359</span>,<span class="number">161609777</span>,<span class="number">162107537</span>,<span class="number">162605678</span>,<span class="number">163105696</span>,<span class="number">163606181</span>,<span class="number">164109508</span>,<span class="number">164610471</span>,<span class="number">165108248</span>,<span class="number">165606553</span>,<span class="number">166105383</span>,<span class="number">166604291</span>,<span class="number">167104867</span>,<span class="number">167605345</span>,<span class="number">168104812</span>,<span class="number">168604079</span>,<span class="number">169099355</span>,<span class="number">169602580</span>,<span class="number">170101751</span>,<span class="number">170601744</span>,<span class="number">171099771</span>,<span class="number">171601946</span>,<span class="number">172099893</span>,<span class="number">172599641</span>,<span class="number">173092341</span>,<span class="number">173589384</span>,<span class="number">174086057</span>,<span class="number">174584382</span>,<span class="number">175085228</span>,<span class="number">175581054</span>&#125;;</span><br><span class="line">li numst[<span class="number">352</span>] = &#123;<span class="number">1611516670</span>,<span class="number">24831098818</span>,<span class="number">85091177611</span>,<span class="number">241479741103</span>,<span class="number">647343511917</span>,<span class="number">6995323118</span>,<span class="number">38803296781</span>,<span class="number">121352198450</span>,<span class="number">335585309480</span>,<span class="number">891568792743</span>,<span class="number">14370630249</span>,<span class="number">57943890614</span>,<span class="number">171026377942</span>,<span class="number">464501064994</span>,<span class="number">1473880836</span>,<span class="number">24473902285</span>,<span class="number">84164171463</span>,<span class="number">239073950242</span>,<span class="number">641099940086</span>,<span class="number">6806229870</span>,<span class="number">38312556854</span>,<span class="number">120078616969</span>,<span class="number">332280076921</span>,<span class="number">882990965157</span>,<span class="number">14112718818</span>,<span class="number">57274551969</span>,<span class="number">169289292334</span>,<span class="number">459992934005</span>,<span class="number">1337854506</span>,<span class="number">24120883462</span>,<span class="number">83248007737</span>,<span class="number">236696297515</span>,<span class="number">634929391393</span>,<span class="number">6620357676</span>,<span class="number">37830176352</span>,<span class="number">118826730177</span>,<span class="number">329031146994</span>,<span class="number">874559255859</span>,<span class="number">13856007495</span>,<span class="number">56608327843</span>,<span class="number">167560289742</span>,<span class="number">455505780300</span>,<span class="number">1202088386</span>,<span class="number">23768539351</span>,<span class="number">82333594782</span>,<span class="number">234323188514</span>,<span class="number">628770636033</span>,<span class="number">6435063656</span>,<span class="number">37349296386</span>,<span class="number">117578737596</span>,<span class="number">325792323073</span>,<span class="number">866153773131</span>,<span class="number">13603643125</span>,<span class="number">55953385061</span>,<span class="number">165860564948</span>,<span class="number">451094609069</span>,<span class="number">1069184517</span>,<span class="number">23423623727</span>,<span class="number">81438460553</span>,<span class="number">232000112395</span>,<span class="number">622741727028</span>,<span class="number">6253085456</span>,<span class="number">36877021659</span>,<span class="number">116353077724</span>,<span class="number">322611458168</span>,<span class="number">857898708083</span>,<span class="number">13354228762</span>,<span class="number">55306098243</span>,<span class="number">164180708576</span>,<span class="number">446735001036</span>,<span class="number">937685173</span>,<span class="number">23082353134</span>,<span class="number">80552785887</span>,<span class="number">229701585730</span>,<span class="number">616776528825</span>,<span class="number">6072677726</span>,<span class="number">36408822720</span>,<span class="number">115137995242</span>,<span class="number">319458043535</span>,<span class="number">849714882133</span>,<span class="number">13107744445</span>,<span class="number">54666415645</span>,<span class="number">162520587621</span>,<span class="number">442426611046</span>,<span class="number">807311470</span>,<span class="number">22744003927</span>,<span class="number">79674693251</span>,<span class="number">227422736603</span>,<span class="number">610862399010</span>,<span class="number">5893434651</span>,<span class="number">35943646365</span>,<span class="number">113930757179</span>,<span class="number">316324986992</span>,<span class="number">841583890229</span>,<span class="number">12861712571</span>,<span class="number">54027907086</span>,<span class="number">160863512855</span>,<span class="number">438126126427</span>,<span class="number">677744489</span>,<span class="number">22407748132</span>,<span class="number">78802032994</span>,<span class="number">225157985322</span>,<span class="number">604984856037</span>,<span class="number">5716565771</span>,<span class="number">35484631509</span>,<span class="number">112739509636</span>,<span class="number">313233429815</span>,<span class="number">833560598601</span>,<span class="number">12619930630</span>,<span class="number">53400428095</span>,<span class="number">159235062884</span>,<span class="number">433899929956</span>,<span class="number">549348706</span>,<span class="number">22074532063</span>,<span class="number">77937262116</span>,<span class="number">222913708970</span>,<span class="number">599160450170</span>,<span class="number">5540033707</span>,<span class="number">35026490825</span>,<span class="number">111550530977</span>,<span class="number">310147760736</span>,<span class="number">825552588218</span>,<span class="number">12376359574</span>,<span class="number">52768306127</span>,<span class="number">157594563185</span>,<span class="number">429642460847</span>,<span class="number">421224956</span>,<span class="number">21742021880</span>,<span class="number">77074322838</span>,<span class="number">220674185952</span>,<span class="number">593348380684</span>,<span class="number">5364465484</span>,<span class="number">34570851523</span>,<span class="number">110368043254</span>,<span class="number">307078936923</span>,<span class="number">817588294774</span>,<span class="number">12137286578</span>,<span class="number">52147857402</span>,<span class="number">155984357764</span>,<span class="number">425463613204</span>,<span class="number">295498034</span>,<span class="number">21415731952</span>,<span class="number">76227526294</span>,<span class="number">218476557046</span>,<span class="number">587645035156</span>,<span class="number">5192879414</span>,<span class="number">34125546861</span>,<span class="number">109212377002</span>,<span class="number">304079721068</span>,<span class="number">809804649437</span>,<span class="number">11901289737</span>,<span class="number">51535392117</span>,<span class="number">154394871503</span>,<span class="number">421338536015</span>,<span class="number">170920662</span>,<span class="number">21092425584</span>,<span class="number">75388473090</span>,<span class="number">216299023615</span>,<span class="number">581993842114</span>,<span class="number">5021923689</span>,<span class="number">33681877906</span>,<span class="number">108060955255</span>,<span class="number">301091520582</span>,<span class="number">802049592223</span>,<span class="number">11668023988</span>,<span class="number">50930014590</span>,<span class="number">152823779731</span>,<span class="number">417261196672</span>,<span class="number">47523507</span>,<span class="number">20772181826</span>,<span class="number">74557367833</span>,<span class="number">214142117131</span>,<span class="number">576396181355</span>,<span class="number">4853507682</span>,<span class="number">33244800104</span>,<span class="number">106926639410</span>,<span class="number">298147713933</span>,<span class="number">794409746597</span>,<span class="number">11435650672</span>,<span class="number">50326953208</span>,<span class="number">151258698876</span>,<span class="number">413199457023</span>,<span class="number">1092995098244</span>,<span class="number">20453692433</span>,<span class="number">73730815694</span>,<span class="number">211997026857</span>,<span class="number">570829185964</span>,<span class="number">4685264556</span>,<span class="number">32808171177</span>,<span class="number">105793488505</span>,<span class="number">295206930517</span>,<span class="number">786777746632</span>,<span class="number">11206260411</span>,<span class="number">49731633517</span>,<span class="number">149713708985</span>,<span class="number">409189858068</span>,<span class="number">1082589280689</span>,<span class="number">20139991649</span>,<span class="number">72916691179</span>,<span class="number">209884189289</span>,<span class="number">565345893787</span>,<span class="number">4518737141</span>,<span class="number">32375994660</span>,<span class="number">104671892500</span>,<span class="number">292296134838</span>,<span class="number">779223572048</span>,<span class="number">10978265333</span>,<span class="number">49139934610</span>,<span class="number">148178116403</span>,<span class="number">405204647340</span>,<span class="number">1072246754882</span>,<span class="number">19827002537</span>,<span class="number">72104413141</span>,<span class="number">207776143636</span>,<span class="number">559875037177</span>,<span class="number">4354683110</span>,<span class="number">31950237454</span>,<span class="number">103566955958</span>,<span class="number">289428573982</span>,<span class="number">771781602051</span>,<span class="number">10752858133</span>,<span class="number">48554951837</span>,<span class="number">146659953560</span>,<span class="number">401264670349</span>,<span class="number">1062021621551</span>,<span class="number">19518274761</span>,<span class="number">71303194772</span>,<span class="number">205696800289</span>,<span class="number">554478669836</span>,<span class="number">4191483496</span>,<span class="number">31526697331</span>,<span class="number">102467773271</span>,<span class="number">286575945643</span>,<span class="number">764378384800</span>,<span class="number">10530470029</span>,<span class="number">47977804257</span>,<span class="number">145162124809</span>,<span class="number">397377465370</span>,<span class="number">1051933443521</span>,<span class="number">19213652728</span>,<span class="number">70512631458</span>,<span class="number">203645109528</span>,<span class="number">549154066966</span>,<span class="number">4030509852</span>,<span class="number">31108934194</span>,<span class="number">101383583168</span>,<span class="number">283762226666</span>,<span class="number">757076146220</span>,<span class="number">10309979851</span>,<span class="number">47405582216</span>,<span class="number">143677078963</span>,<span class="number">393523435027</span>,<span class="number">1041931361613</span>,<span class="number">18910272345</span>,<span class="number">69725290790</span>,<span class="number">201601781662</span>,<span class="number">543851168197</span>,<span class="number">3869893989</span>,<span class="number">30692099632</span>,<span class="number">100301802920</span>,<span class="number">280954761586</span>,<span class="number">749790137907</span>,<span class="number">10089997457</span>,<span class="number">46834678258</span>,<span class="number">142195453631</span>,<span class="number">389678281232</span>,<span class="number">1031952315675</span>,<span class="number">18609763453</span>,<span class="number">68945402068</span>,<span class="number">199577793939</span>,<span class="number">538598461112</span>,<span class="number">3711222251</span>,<span class="number">30280310451</span>,<span class="number">99233116795</span>,<span class="number">278181278692</span>,<span class="number">742592321221</span>,<span class="number">9872154607</span>,<span class="number">46269326711</span>,<span class="number">140728238241</span>,<span class="number">385870524711</span>,<span class="number">1022070324749</span>,<span class="number">18311382009</span>,<span class="number">68171034631</span>,<span class="number">197568134878</span>,<span class="number">533382940567</span>,<span class="number">3554026557</span>,<span class="number">29872351977</span>,<span class="number">98174372077</span>,<span class="number">275433596512</span>,<span class="number">735461463758</span>,<span class="number">9655697881</span>,<span class="number">45707572329</span>,<span class="number">139270358519</span>,<span class="number">382086996623</span>,<span class="number">1012251211594</span>,<span class="number">18014204912</span>,<span class="number">67399792486</span>,<span class="number">195566586555</span>,<span class="number">528188468873</span>,<span class="number">3397755113</span>,<span class="number">29466792348</span>,<span class="number">97121853126</span>,<span class="number">272702071066</span>,<span class="number">728372535169</span>,<span class="number">9442541797</span>,<span class="number">45154383935</span>,<span class="number">137834709208</span>,<span class="number">378361160925</span>,<span class="number">1002581823366</span>,<span class="number">17722589590</span>,<span class="number">66642984633</span>,<span class="number">193602498691</span>,<span class="number">523091215660</span>,<span class="number">3243839556</span>,<span class="number">29067346493</span>,<span class="number">96085200428</span>,<span class="number">270011722255</span>,<span class="number">721390470774</span>,<span class="number">9232083997</span>,<span class="number">44608198160</span>,<span class="number">136417233148</span>,<span class="number">374682489219</span>,<span class="number">993034836731</span>,<span class="number">17435952907</span>,<span class="number">65899097615</span>,<span class="number">191671943332</span>,<span class="number">518080986662</span>,<span class="number">3092594895</span>,<span class="number">28674832371</span>,<span class="number">95066537244</span>,<span class="number">267368060404</span>,<span class="number">714529568823</span>,<span class="number">9025028345</span>,<span class="number">44070841770</span>,<span class="number">135022671628</span>,<span class="number">371063286307</span>,<span class="number">983642184332</span>,<span class="number">17151396830</span>,<span class="number">65160610118</span>,<span class="number">189755401031</span>,<span class="number">513107125545</span>,<span class="number">2941349750</span>,<span class="number">28282316870</span>,<span class="number">94047870750</span>,<span class="number">264724390129</span>,<span class="number">707668644954</span>,<span class="number">8817435949</span>,<span class="number">43532092696</span>,<span class="number">133624495703</span>,<span class="number">367434702789</span>,<span class="number">974225187667</span>,<span class="number">16866112488</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> li cntlen0 = <span class="number">91029304</span>;</span><br><span class="line">li cntlen[<span class="number">184</span>] = &#123;<span class="number">175147926</span>,<span class="number">494199</span>,<span class="number">990883</span>,<span class="number">1488493</span>,<span class="number">1988066</span>,<span class="number">2488177</span>,<span class="number">2987803</span>,<span class="number">3488423</span>,<span class="number">3990954</span>,<span class="number">4490335</span>,<span class="number">4989279</span>,<span class="number">5483076</span>,<span class="number">5985470</span>,<span class="number">6486749</span>,<span class="number">6985593</span>,<span class="number">7480009</span>,<span class="number">7978158</span>,<span class="number">8478228</span>,<span class="number">8978484</span>,<span class="number">9477328</span>,<span class="number">9983339</span>,<span class="number">10483788</span>,<span class="number">10984312</span>,<span class="number">11486584</span>,<span class="number">11988069</span>,<span class="number">12483487</span>,<span class="number">12980612</span>,<span class="number">13484221</span>,<span class="number">13985928</span>,<span class="number">14486321</span>,<span class="number">14984746</span>,<span class="number">15488053</span>,<span class="number">15990882</span>,<span class="number">16490934</span>,<span class="number">16990461</span>,<span class="number">17487178</span>,<span class="number">17985728</span>,<span class="number">18484928</span>,<span class="number">18983358</span>,<span class="number">19486605</span>,<span class="number">19988257</span>,<span class="number">20486893</span>,<span class="number">20988439</span>,<span class="number">21493756</span>,<span class="number">21986340</span>,<span class="number">22485961</span>,<span class="number">22985712</span>,<span class="number">23486190</span>,<span class="number">23984067</span>,<span class="number">24482873</span>,<span class="number">24980216</span>,<span class="number">25480680</span>,<span class="number">25977956</span>,<span class="number">26484995</span>,<span class="number">26986934</span>,<span class="number">27486347</span>,<span class="number">27985816</span>,<span class="number">28473382</span>,<span class="number">28970701</span>,<span class="number">29470271</span>,<span class="number">29971110</span>,<span class="number">30471028</span>,<span class="number">30974428</span>,<span class="number">31476082</span>,<span class="number">31976721</span>,<span class="number">32478701</span>,<span class="number">32977440</span>,<span class="number">33477508</span>,<span class="number">33973523</span>,<span class="number">34474042</span>,<span class="number">34971435</span>,<span class="number">35469237</span>,<span class="number">35971392</span>,<span class="number">36472850</span>,<span class="number">36971154</span>,<span class="number">37473103</span>,<span class="number">37964019</span>,<span class="number">38464746</span>,<span class="number">38964627</span>,<span class="number">39463808</span>,<span class="number">39962816</span>,<span class="number">40465803</span>,<span class="number">40969617</span>,<span class="number">41468710</span>,<span class="number">41968070</span>,<span class="number">42473235</span>,<span class="number">42976456</span>,<span class="number">43472030</span>,<span class="number">43970901</span>,<span class="number">44471423</span>,<span class="number">44967153</span>,<span class="number">45467670</span>,<span class="number">45969157</span>,<span class="number">46470866</span>,<span class="number">46968418</span>,<span class="number">47466890</span>,<span class="number">47968989</span>,<span class="number">48470291</span>,<span class="number">48968485</span>,<span class="number">49469124</span>,<span class="number">49973216</span>,<span class="number">50470784</span>,<span class="number">50975790</span>,<span class="number">51478372</span>,<span class="number">51979595</span>,<span class="number">52478367</span>,<span class="number">52980211</span>,<span class="number">53478568</span>,<span class="number">53976679</span>,<span class="number">54465631</span>,<span class="number">54964748</span>,<span class="number">55466557</span>,<span class="number">55967758</span>,<span class="number">56473994</span>,<span class="number">56978322</span>,<span class="number">57480470</span>,<span class="number">57981487</span>,<span class="number">58483864</span>,<span class="number">58982896</span>,<span class="number">59481939</span>,<span class="number">59985790</span>,<span class="number">60485451</span>,<span class="number">60983033</span>,<span class="number">61491780</span>,<span class="number">61992158</span>,<span class="number">62488509</span>,<span class="number">62987230</span>,<span class="number">63490451</span>,<span class="number">63993857</span>,<span class="number">64488542</span>,<span class="number">64989687</span>,<span class="number">65495650</span>,<span class="number">65998941</span>,<span class="number">66494917</span>,<span class="number">66991888</span>,<span class="number">67493944</span>,<span class="number">67994780</span>,<span class="number">68489535</span>,<span class="number">68989528</span>,<span class="number">69488748</span>,<span class="number">69988720</span>,<span class="number">70492835</span>,<span class="number">70992569</span>,<span class="number">71492247</span>,<span class="number">71991765</span>,<span class="number">72492411</span>,<span class="number">72992901</span>,<span class="number">73483871</span>,<span class="number">73985351</span>,<span class="number">74482916</span>,<span class="number">74980112</span>,<span class="number">75482519</span>,<span class="number">75978841</span>,<span class="number">76477890</span>,<span class="number">76979292</span>,<span class="number">77482207</span>,<span class="number">77982456</span>,<span class="number">78485746</span>,<span class="number">78982003</span>,<span class="number">79482319</span>,<span class="number">79977390</span>,<span class="number">80473434</span>,<span class="number">80976273</span>,<span class="number">81474802</span>,<span class="number">81978724</span>,<span class="number">82477936</span>,<span class="number">82978736</span>,<span class="number">83478631</span>,<span class="number">83980153</span>,<span class="number">84481313</span>,<span class="number">84979857</span>,<span class="number">85479343</span>,<span class="number">85979130</span>,<span class="number">86477342</span>,<span class="number">86977152</span>,<span class="number">87472621</span>,<span class="number">87968703</span>,<span class="number">88467802</span>,<span class="number">88965777</span>,<span class="number">89465792</span>,<span class="number">89965023</span>,<span class="number">90463756</span>,<span class="number">90964902</span>,<span class="number">91460469</span>&#125;;</span><br><span class="line">li numlen[<span class="number">184</span>] = &#123;<span class="number">516914</span>,<span class="number">20650189014</span>,<span class="number">74240768887</span>,<span class="number">213320471137</span>,<span class="number">574263823815</span>,<span class="number">4787889955</span>,<span class="number">33074507269</span>,<span class="number">106484690902</span>,<span class="number">297000757453</span>,<span class="number">791433134353</span>,<span class="number">11347508705</span>,<span class="number">50098204813</span>,<span class="number">150665044668</span>,<span class="number">411658789573</span>,<span class="number">1088996717416</span>,<span class="number">20333317063</span>,<span class="number">73418414371</span>,<span class="number">211186274752</span>,<span class="number">568725099726</span>,<span class="number">4621442711</span>,<span class="number">32642538921</span>,<span class="number">105363635318</span>,<span class="number">294091364163</span>,<span class="number">783882599030</span>,<span class="number">11118953800</span>,<span class="number">49505053095</span>,<span class="number">149125681925</span>,<span class="number">407663794807</span>,<span class="number">1078628800049</span>,<span class="number">20018803006</span>,<span class="number">72602179030</span>,<span class="number">209067959091</span>,<span class="number">563227591537</span>,<span class="number">4454720767</span>,<span class="number">32209857666</span>,<span class="number">104240729349</span>,<span class="number">291177168779</span>,<span class="number">776319601703</span>,<span class="number">10890588601</span>,<span class="number">48912393781</span>,<span class="number">147587596515</span>,<span class="number">403672114127</span>,<span class="number">1068269484544</span>,<span class="number">19706533656</span>,<span class="number">71791769459</span>,<span class="number">206964762495</span>,<span class="number">557769319218</span>,<span class="number">4290068946</span>,<span class="number">31782549017</span>,<span class="number">103131766532</span>,<span class="number">288299158592</span>,<span class="number">768850512682</span>,<span class="number">10664438220</span>,<span class="number">48325482040</span>,<span class="number">146064427222</span>,<span class="number">399719144522</span>,<span class="number">1058010632332</span>,<span class="number">19397564493</span>,<span class="number">70989924483</span>,<span class="number">204883792787</span>,<span class="number">552368730897</span>,<span class="number">4127272583</span>,<span class="number">31360055575</span>,<span class="number">102035300196</span>,<span class="number">285453580169</span>,<span class="number">761465592132</span>,<span class="number">10441333753</span>,<span class="number">47746475595</span>,<span class="number">144561774556</span>,<span class="number">395819420123</span>,<span class="number">1047889963499</span>,<span class="number">19091127624</span>,<span class="number">70194651191</span>,<span class="number">202819878392</span>,<span class="number">547012405305</span>,<span class="number">3966062967</span>,<span class="number">30941680007</span>,<span class="number">100949520763</span>,<span class="number">282635736438</span>,<span class="number">754152648826</span>,<span class="number">10220465107</span>,<span class="number">47173271267</span>,<span class="number">143074179249</span>,<span class="number">391958773382</span>,<span class="number">1037870710119</span>,<span class="number">18789724876</span>,<span class="number">69412442670</span>,<span class="number">200789870231</span>,<span class="number">541744073754</span>,<span class="number">3806695412</span>,<span class="number">30528085091</span>,<span class="number">99876148217</span>,<span class="number">279850091360</span>,<span class="number">746923268357</span>,<span class="number">10002150769</span>,<span class="number">46606695936</span>,<span class="number">141603787729</span>,<span class="number">388142773853</span>,<span class="number">1027967326352</span>,<span class="number">18490265571</span>,<span class="number">68635277779</span>,<span class="number">198772951171</span>,<span class="number">536509711863</span>,<span class="number">3648674112</span>,<span class="number">30117984164</span>,<span class="number">98811843402</span>,<span class="number">277087978900</span>,<span class="number">739754960399</span>,<span class="number">9785985038</span>,<span class="number">46045696942</span>,<span class="number">140147868236</span>,<span class="number">384364333153</span>,<span class="number">1018161416409</span>,<span class="number">18194286218</span>,<span class="number">67867144325</span>,<span class="number">196779470429</span>,<span class="number">531336176853</span>,<span class="number">3492522697</span>,<span class="number">29712735640</span>,<span class="number">97760131531</span>,<span class="number">274358548202</span>,<span class="number">732671469307</span>,<span class="number">9572703304</span>,<span class="number">45492182566</span>,<span class="number">138711373191</span>,<span class="number">380636302745</span>,<span class="number">1008486331820</span>,<span class="number">17900935152</span>,<span class="number">67105832025</span>,<span class="number">194803692470</span>,<span class="number">526208585828</span>,<span class="number">3337248365</span>,<span class="number">29309763482</span>,<span class="number">96714327280</span>,<span class="number">271644449204</span>,<span class="number">725627766979</span>,<span class="number">9360338837</span>,<span class="number">44941048652</span>,<span class="number">137281055555</span>,<span class="number">376924304261</span>,<span class="number">998852854893</span>,<span class="number">17611429352</span>,<span class="number">66354498813</span>,<span class="number">192853812778</span>,<span class="number">521148206276</span>,<span class="number">3184165505</span>,<span class="number">28912478890</span>,<span class="number">95683283946</span>,<span class="number">268968658210</span>,<span class="number">718683482800</span>,<span class="number">9149398605</span>,<span class="number">44393610861</span>,<span class="number">135860330525</span>,<span class="number">373237200776</span>,<span class="number">989283985222</span>,<span class="number">17322714012</span>,<span class="number">65605217162</span>,<span class="number">190909256928</span>,<span class="number">516101642983</span>,<span class="number">3031826579</span>,<span class="number">28517124738</span>,<span class="number">94657250065</span>,<span class="number">266305867583</span>,<span class="number">711772937533</span>,<span class="number">8941886748</span>,<span class="number">43855070484</span>,<span class="number">134462696085</span>,<span class="number">369610022577</span>,<span class="number">979870636290</span>,<span class="number">17037911196</span>,<span class="number">64866088952</span>,<span class="number">188991051429</span>,<span class="number">511123464485</span>,<span class="number">2882089052</span>,<span class="number">28128521923</span>,<span class="number">93648737970</span>,<span class="number">263688550111</span>,<span class="number">704980405206</span>,<span class="number">8736218959</span>,<span class="number">43321316142</span>,<span class="number">133077482701</span>,<span class="number">366015079862</span>,<span class="number">970540944452</span>,<span class="number">16755472618</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    li n;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    n--;</span><br><span class="line">    li res;</span><br><span class="line">    <span class="keyword">if</span>(n &lt;= st)</span><br><span class="line">    &#123;</span><br><span class="line">        res = cntst[n / <span class="number">1000000</span>];</span><br><span class="line">        li rest = n % <span class="number">1000000</span>;</span><br><span class="line">        li v0 = numst[n / <span class="number">1000000</span>];</span><br><span class="line">        <span class="keyword">while</span>(rest--)</span><br><span class="line">        &#123;</span><br><span class="line">            v0 = nxt(v0);</span><br><span class="line">            res += (<span class="number">1</span> - (v0 &amp; <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        res = cntlen[<span class="number">0</span>];</span><br><span class="line">        n -= st;</span><br><span class="line">        res += (n / len) * cntlen0;</span><br><span class="line">        n %= len;</span><br><span class="line">        res += (n / <span class="number">1000000</span> != <span class="number">0</span>) * cntlen[n / <span class="number">1000000</span>];</span><br><span class="line">        li v0 = numlen[n / <span class="number">1000000</span>];</span><br><span class="line">        li rest = n % <span class="number">1000000</span>;</span><br><span class="line">        <span class="keyword">while</span>(rest--)</span><br><span class="line">        &#123;</span><br><span class="line">            v0 = nxt(v0);</span><br><span class="line">            res += (<span class="number">1</span> - (v0 &amp; <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/24/%E7%82%B9%E5%88%86%E6%B2%BB%E9%A2%98%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/24/%E7%82%B9%E5%88%86%E6%B2%BB%E9%A2%98%E9%9B%86/" itemprop="url">点分治题集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-24T13:21:57+08:00">
                2020-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BB%83%E4%B9%A0%E9%A2%98%E9%9B%86/" itemprop="url" rel="index">
                    <span itemprop="name">练习题集</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="模版题"><a href="#模版题" class="headerlink" title="模版题"></a>模版题</h2><ul>
<li><p>洛谷 P3806 [模板]点分治1</p>
</li>
<li><p>洛谷 P4178 Tree</p>
</li>
<li><p>洛谷 P2634 [国家集训队]聪聪可可</p>
</li>
<li><p>洛谷 P4149 [IOI2011]Race‘</p>
</li>
</ul>
<h1 id="洛谷-P2664-树上游戏"><a href="#洛谷-P2664-树上游戏" class="headerlink" title="[洛谷 P2664] 树上游戏"></a><a href="https://www.luogu.com.cn/problem/P2664" target="_blank" rel="noopener">[洛谷 P2664] 树上游戏</a></h1><h3 id="点分治-容斥"><a href="#点分治-容斥" class="headerlink" title="点分治+容斥"></a>点分治+容斥</h3><p>点分治后正向和反向分别DP一次（一个方向的DP仅能统计当前子树到之前遍历过的子树的贡献）<br>然后删除重复统计的部分</p>
<p>统计过程中一个点的能在当前分治过程中产生新的贡献当且仅当当前点到当前树根的路径上没有与当前点同色的点，而它能够产生的贡献就是其它子树中到达树根的路径上没有当前颜色的点的数量</p>
<h1 id="WC2010-重建计划"><a href="#WC2010-重建计划" class="headerlink" title="[WC2010] 重建计划"></a><a href="https://www.luogu.com.cn/problem/P4292" target="_blank" rel="noopener">[WC2010] 重建计划</a></h1><h3 id="点分治-二分"><a href="#点分治-二分" class="headerlink" title="点分治+二分"></a>点分治+二分</h3><p>对于二分答案，将每个点的权值减去当前的答案</p>
<p>若存在满足当前答案的方案，那么存在一条路径，使得新的权值之和不小于0</p>
<p>使用单调队列维护路径长度在 $[L,U]$，方法类似于滑动窗口维护某一段区间的最大值</p>
<h1 id="HDU4812-D-Tree"><a href="#HDU4812-D-Tree" class="headerlink" title="[HDU4812] D Tree"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4812" target="_blank" rel="noopener">[HDU4812] D Tree</a></h1><h3 id="点分治-数学逆元"><a href="#点分治-数学逆元" class="headerlink" title="点分治+数学逆元"></a>点分治+数学逆元</h3><p>由于模数不大，可以记录从树根到每一个节点 $p$ 的乘积的值 $v_p$（不能在DP过程中记录，在每一棵子树DP结束后记录）<br>当我们在某一个子树中跑DP时，对于单个点 $u$ 的统计相当于询问之前走过的记录中是否存在一个在其它子树中的点 $v$ 使得 $v_u \cdot v_v \cdot v_{root}^{-1}=K$(树根的值被统计了两次)<br>在当前子树跑完之后我们将其中的值 $v_p$ 再合并到记录中</p>
<p>对于询问，相当于在记录中寻找 $v_v = K \cdot v_u^{-1}\cdot v_{root}$，可预处理</p>
<h1 id="SPOJ1825-Free-tour-II"><a href="#SPOJ1825-Free-tour-II" class="headerlink" title="[SPOJ1825] Free tour II"></a><a href="https://www.spoj.com/problems/FTOUR2/" target="_blank" rel="noopener">[SPOJ1825] Free tour II</a></h1><p>基本同上，记录的值变为走过k个拥挤点的最大贡献</p>
<h1 id="HDU5977-Garden-of-Eden"><a href="#HDU5977-Garden-of-Eden" class="headerlink" title="[HDU5977] Garden of Eden"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5977" target="_blank" rel="noopener">[HDU5977] Garden of Eden</a></h1><p>k的值很小，在点分治过程中记录对应每一个点经过苹果种类的二进制状态</p>
<p>在统计时值得注意的一点是，对于一个状态 $sta$ 而言，我们统计的是所有满足 $sta|t=(11…1)_2$ 的 $t$ 状态对应的值之和，为了统计方便，我们应该在每次DP完合并时将状态 $sta$ 的值统计到其每一个子集上去，使用 $bitmask$ 即可，对于每一个状态 $sta$ ，时间复杂度上界为 $O(2^k)$ 。</p>
<p>对于单次DP，其最大的状态数有 $2^k$ 个，时间复杂度最大为 $O(3^k)$ ，这种情况下它对应的子树的点数应该不小于 $2^k$ 。均摊下来每一层分治的最坏复杂度上界为 $O(n\cdot \frac{3^k}{2^k}) = O(n\cdot \frac{3}{2}^k)$ ，最终复杂度为 $O(n\cdot logn\cdot \frac{3}{2}^k)$ ，但是实际情况下界非常松。</p>
<h3 id="下列题目处理十分类似"><a href="#下列题目处理十分类似" class="headerlink" title="下列题目处理十分类似"></a>下列题目处理十分类似</h3><ul>
<li><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5909" target="_blank" rel="noopener">[HDU5909]Tree Cutting</a></li>
<li><a href="https://www.luogu.com.cn/problem/P3727" target="_blank" rel="noopener">[Luogu3727]曼哈顿计划E</a></li>
<li><a href="https://loj.ac/problem/2259" target="_blank" rel="noopener">[FJOI2014]最短路径树问题</a></li>
</ul>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/06/2020-%E5%A4%9A%E6%A0%A1-7-I/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/06/2020-%E5%A4%9A%E6%A0%A1-7-I/" itemprop="url">2020-多校-7-I</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-06T11:11:15+08:00">
                2020-09-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%9A%E6%A0%A1-7/" itemprop="url" rel="index">
                    <span itemprop="name">多校-7</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>构造包含 $[1,n]\leq 10^5$ 序列，使得最长上升序列长度为 $x$ ，最长下降序列长度为 $y$ ，满足字典序最小</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>无解的情况：</p>
<p>$x\cdot y &lt; n$ 或 $x+y &gt; n + 1$</p>
<p>有解：</p>
<p>试图让上升序列尽量靠前且字典序更小。</p>
<p>将序列分为 $x$ 块，每一块满足前一块的元素均小于后一块的元素，且前一块的元素个数不大于后一块，每一块的元素降序排列。</p>
<p>也就是尽量将元素往后填充，直到当前元素块构成了最长下降序列。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> p[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("In.txt", "r", stdin);</span></span><br><span class="line">    <span class="comment">// freopen("Out.txt", "w", stdout);</span></span><br><span class="line">    <span class="keyword">int</span> T, n, x, y;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;x, &amp;y);</span><br><span class="line">        <span class="keyword">if</span>(x + y &gt; n + <span class="number">1</span>|| <span class="number">1L</span>L * x * y &lt; n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"NO"</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"YES"</span>);</span><br><span class="line">        fore(i, <span class="number">1</span>, n) p[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> rem = n - x, cnt = (y == <span class="number">1</span>) ? <span class="number">0</span> : rem / (y - <span class="number">1</span>), more = (y == <span class="number">1</span>) ? <span class="number">0</span> : ((rem % (y - <span class="number">1</span>)) != <span class="number">0</span>);</span><br><span class="line">        fore(i, <span class="number">1</span>, cnt)</span><br><span class="line">            p[n - i * y + <span class="number">1</span>] = n - (i - <span class="number">1</span>) * y;</span><br><span class="line">        <span class="keyword">if</span>(more)</span><br><span class="line">            p[n - cnt * y - (rem % (y - <span class="number">1</span>))] = n - cnt * y;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(!p[i])p[i] = i, i++;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!p[i]) p[i] = p[i - <span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        Fore(j, <span class="number">1</span>, n) <span class="built_in">printf</span>(<span class="string">"%d "</span>, p[j]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, p[n]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/05/2020-%E5%A4%9A%E6%A0%A1-7-H/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/05/2020-%E5%A4%9A%E6%A0%A1-7-H/" itemprop="url">2020-多校-7-H</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-05T23:53:59+08:00">
                2020-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%9A%E6%A0%A1-7/" itemprop="url" rel="index">
                    <span itemprop="name">多校-7</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>有21个元素，标号从0到20。现在给定 $n\leq 10^6$ 个组，每个组包含两个数字， $(b)_{10} = (b_0b_1b_2…b_{20})_2$ 其二进制代表是否需要第 $k$ 个元素和 $p$ 代表其贡献。多个组可同时选择当且仅当其需要的元素均不重复（即每个元素最多可以使用一次），同时选择多个组时贡献为 $\prod p_i$</p>
<p>现有 $m\leq 10^6$ 个询问，每次询问包含一个数字 $(x)_{10} = (x_1x_2…x_{20})_2$ ，问使用完且仅使用当前组的元素可以得到多少种方案，将这些方案的贡献相加后$\mod 998244353$ 输出。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>显然要便利所有的 $2^{21}-1$ 种方案</p>
<p>朴素的想法是bitmask，其复杂度为 $\sum_{i=0}^{2^{21}-1}\sum_{k\in i}1=\sum_{i=0}^{20}C_{20}^i2^i=3^{21}$</p>
<p>显然不行（但是其实是有人计划通了的，果然人只要极端愤怒，就没有什么不可能的）</p>
<h3 id="这里用到子集卷积"><a href="#这里用到子集卷积" class="headerlink" title="这里用到子集卷积"></a>这里用到子集卷积</h3><p>考虑bitmask过程中组合为 $i$ 的最终贡献为 $P_i=\sum_{k\in i}a_kb_{i-k}$（$a,b$ 为组合为 $k,i-k$ 的最终贡献）</p>
<p>令多项式 $A(x) = \sum a_ix^i, B(x) = \sum b_ix^i$</p>
<p>则有 $P(x) = \sum_ix^i\sum_{j\in i}a_kb_{i-k}$，满足 $k|(i-k)=i,|k|+|i-k|=|i|,|i|$ 为组合的元素数（集合大小）</p>
<p>用子集卷积即可。为避免重复计算，应当将初始的 $b$ 分类，按照 $b$ 包含的最高位分类 $A_0,A_1,A_2…$ 依次卷积。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">21</span>, mod = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> siz[MAXN + <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = getchar(); <span class="keyword">int</span> o;</span><br><span class="line">    <span class="keyword">while</span>(c &gt; <span class="number">57</span> || c &lt; <span class="number">48</span>) c = getchar();</span><br><span class="line">    <span class="keyword">for</span>(o = <span class="number">0</span>; c &gt; <span class="number">47</span> &amp;&amp; c &lt; <span class="number">58</span>; c = getchar())</span><br><span class="line">        o = (o &lt;&lt; <span class="number">1</span>)+(o &lt;&lt; <span class="number">3</span>)+(c - <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fwt</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;A, <span class="keyword">int</span> type = <span class="number">1</span>, <span class="keyword">int</span> base = <span class="number">20</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = (<span class="number">1</span> &lt;&lt; base);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len; i &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>, t = i &lt;&lt; <span class="number">1</span>; j &lt; len; j += t)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = j, K = j + i; k &lt; K; ++k)</span><br><span class="line">                A[k + i] = (A[k + i] + type * A[k]) % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">Merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; A, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;B, <span class="keyword">int</span> base)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">1</span> &lt;&lt; base;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">ret</span><span class="params">(len)</span></span>;</span><br><span class="line">    vector&lt;vector&lt;int&gt; &gt; SA(base + 1, vector&lt;int&gt;(len, 0)), SB = SA, SC = SA;</span><br><span class="line">    Fore(i, <span class="number">0</span>, len)</span><br><span class="line">        SA[siz[i]][i] = A[i], SB[siz[i]][i] = B[i];</span><br><span class="line">    fore(i, <span class="number">0</span>, base)</span><br><span class="line">    &#123;</span><br><span class="line">        fwt(SA[i], <span class="number">1</span>, base);</span><br><span class="line">        fwt(SB[i], <span class="number">1</span>, base);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> S = <span class="number">0</span>; S &lt; len; S++)</span><br><span class="line">            fore(j, <span class="number">0</span>, i)</span><br><span class="line">                SC[i][S] = (SC[i][S] + <span class="number">1L</span>L * SA[j][S] * SB[i - j][S] % mod) % mod;</span><br><span class="line">        fwt(SC[i], <span class="number">-1</span>, base);</span><br><span class="line">    &#125;</span><br><span class="line">    Fore(S, <span class="number">0</span>, len) ret[S] = SC[siz[S]][S];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">PRO</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fore(i, <span class="number">1</span>, MAXN) siz[i] = siz[i - (i &amp; -i)] + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;ret(MAXN + <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">    ret[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    fore(i, <span class="number">0</span>, <span class="number">20</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">1</span> &lt;&lt; i;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; A = <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(ret.begin(), ret.begin() + len);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; B = <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(p.begin() + len, p.begin() + (len * <span class="number">2</span>));</span><br><span class="line">        A = Merge(A, B, i);</span><br><span class="line">        Fore(j, <span class="number">0</span>, len) ret[j + len] = A[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">v</span><span class="params">(MAXN + <span class="number">5</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen("H.in", "r", stdin);</span></span><br><span class="line">    <span class="comment">// freopen("Out.txt", "w", stdout);</span></span><br><span class="line">    <span class="keyword">int</span> n = input(), p, b;</span><br><span class="line">    fore(i, <span class="number">1</span>, n)</span><br><span class="line">    &#123;</span><br><span class="line">        p = input(); b = input();</span><br><span class="line">        v[b] = (v[b] + p) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res = PRO(v);</span><br><span class="line">    <span class="keyword">int</span> m = input();</span><br><span class="line">    <span class="keyword">while</span>(m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> q = input();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, (res[q] + mod)%mod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/05/2020-%E5%A4%9A%E6%A0%A1-7-D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="潘曲阳 朱霖淇 刘浩钊">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Railroad Guerrilla">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/05/2020-%E5%A4%9A%E6%A0%A1-7-D/" itemprop="url">2020-多校-7-D</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-05T23:25:17+08:00">
                2020-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%9A%E6%A0%A1-7/" itemprop="url" rel="index">
                    <span itemprop="name">多校-7</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p>给定一个区间 [0,t] ，每次随机取两个数字 $v_1, v_2$ （可以相等）， 给定 $a, c, m$ ，构造一个序列满足</p>
<script type="math/tex; mode=display">X_0 = v_1+v_2, X_{i+1} = a\cdot X_i + c \mod m(i>=0)</script><p>问 $X_{v_1-v_2}$ 为偶数的概率有多大？</p>
<p>其中 $1\leq t\leq \frac{m}{2}, m \leq 10^6, a, c\leq m$</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="计算概率"><a href="#计算概率" class="headerlink" title="计算概率"></a>计算概率</h3><p>首先，确定一个 $X_0 = v_1 + v_2$ ，对其而言随机选择到 $X_0$ 的概率为 $P_1 = \frac{min(2 * t - X_0, X_0) + 1}{(t+1)^2}$</p>
<p>其次，$v_1-v_2$ 的最大值为 $v_m = min(2 \cdot t - X_0, X_0)$，</p>
<p>则 $v_1 - v_2$ 为 $\{-v_m, -v_m + 2, -v_m + 4,…,v_m - 2, v_m\}$ 中等概率选择的某一个</p>
<p>对于 $X_m$ 为偶数，则 $｜v_1 - v_2｜ = 0$ 的可能性为 $\frac{1}{(v_m + 1)/2}$ （分母取整）</p>
<p>=其它值的可能性均为$\frac{2}{(v_m + 1)/2}$ （分母取整）</p>
<p>而对于 $X_m$ 为奇数，则$｜v_1 - v_2｜$ 的取值的可能性均为$\frac{2}{(v_m + 1)/2}$</p>
<p>对应的可能性乘以 $P_1$ 乘以在这些 $|v_1-v_2|$ 对应的 $X_{|v_1-v_2|}$ 的偶数的个数再累加即为最终的概率</p>
<h3 id="计算奇偶的分布"><a href="#计算奇偶的分布" class="headerlink" title="计算奇偶的分布"></a>计算奇偶的分布</h3><p>我们实际上只需要计算 $X_0, X_2, … , X_{v_m}$ 的奇偶的个数即可，每一次步长均为2</p>
<p>记 $nexnum[x][i]$ 为从 $x$ 出发走 $2^i$ 步到达的数字</p>
<p>$cnt[x][i]$ 为从 $x$ 出发，一共经过包括 $x$ 在内的 $2^i$ 个数字的偶数的个数，即可利用倍增计算</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fore(i, a, b) for(int i = a; i &lt;= b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Fore(i, a, b) for(int i = a; i &lt; b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1e6</span> + <span class="number">5</span>, LOGM = <span class="number">22</span>;</span><br><span class="line"><span class="keyword">inline</span> li __gcd(li a, li b)&#123;<span class="keyword">return</span> b == <span class="number">0</span> ? a : __gcd(b, a % b);&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Frac</span> &#123;</span></span><br><span class="line">    li a, b;</span><br><span class="line">    <span class="function">li <span class="title">sign</span><span class="params">(li x)</span> </span>&#123; <span class="keyword">return</span> (x &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">-1</span>); &#125;</span><br><span class="line">    inline Frac() : a(0), b(1) &#123;&#125;</span><br><span class="line">    inline Frac(li x) : a(x), b(1) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="title">Frac</span><span class="params">(li x, li y)</span> </span>&#123;</span><br><span class="line">        li m = __gcd(<span class="built_in">abs</span>(x), <span class="built_in">abs</span>(y));</span><br><span class="line">        a = x / m * sign(y);</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="number">0</span>)</span><br><span class="line">            b = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            b = <span class="built_in">abs</span>(y / m);</span><br><span class="line">    &#125;</span><br><span class="line">    Frac <span class="keyword">operator</span>+(<span class="keyword">const</span> Frac &amp;f) &#123;</span><br><span class="line">        li m = __gcd(b, f.b);</span><br><span class="line">        <span class="keyword">return</span> Frac(f.b / m * a + b / m * f.a, b / m * f.b);</span><br><span class="line">    &#125;</span><br><span class="line">    Frac <span class="keyword">operator</span>*(<span class="keyword">const</span> Frac &amp;f) &#123;</span><br><span class="line">        li m1 = __gcd(<span class="built_in">abs</span>(a), f.b);</span><br><span class="line">        li m2 = __gcd(b, <span class="built_in">abs</span>(f.a));</span><br><span class="line">        <span class="keyword">return</span> Frac((a / m1) * (f.a / m2), (b / m2) * (f.b / m1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">li t, a, c, m;</span><br><span class="line">li nexnum[MAXM][LOGM], ji[MAXM][LOGM];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PRO</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fore(i, <span class="number">0</span>, m)</span><br><span class="line">    &#123;</span><br><span class="line">        nexnum[i][<span class="number">0</span>] = (a * a * i + a * c + c) % m;</span><br><span class="line">        ji[i][<span class="number">0</span>] = i &amp; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Fore(j, <span class="number">1</span>, LOGM)</span><br><span class="line">    fore(i, <span class="number">0</span>, m)</span><br><span class="line">        &#123;</span><br><span class="line">            nexnum[i][j] = nexnum[nexnum[i][j - <span class="number">1</span>]][j - <span class="number">1</span>];</span><br><span class="line">            ji[i][j] = ji[i][j - <span class="number">1</span>] + ji[nexnum[i][j - <span class="number">1</span>]][j - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld%lld"</span>, &amp;t, &amp;a, &amp;c, &amp;m);</span><br><span class="line">        PRO();</span><br><span class="line">        Frac res;</span><br><span class="line">        <span class="keyword">for</span>(li sum = <span class="number">0</span>; sum &lt;= <span class="number">2</span> * t; sum++)</span><br><span class="line">        &#123;</span><br><span class="line">            li mina = <span class="number">0</span>, maxa = (min(<span class="number">2</span>*t - sum, sum) + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            li res_ji, all = (maxa &lt;&lt; <span class="number">1</span>) + ((sum &amp; <span class="number">1</span>) == <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(sum &amp; <span class="number">1</span>)</span><br><span class="line">                res_ji = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                res_ji = sum&amp;<span class="number">1</span>;</span><br><span class="line">            li start_num = (sum &amp; <span class="number">1</span>) ? (a * sum + c)%m : nexnum[sum][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LOGM &amp;&amp; maxa; i++)</span><br><span class="line">                <span class="keyword">if</span>(maxa &amp; (<span class="number">1</span> &lt;&lt; i))</span><br><span class="line">                &#123;</span><br><span class="line">                    maxa ^= (<span class="number">1</span> &lt;&lt; i);</span><br><span class="line">                    res_ji += ji[start_num][i] * <span class="number">2</span>;</span><br><span class="line">                    start_num = nexnum[start_num][i];</span><br><span class="line">                &#125;</span><br><span class="line">            Frac posi = Frac(min(<span class="number">2</span>*t - sum, sum) + <span class="number">1</span>, (t + <span class="number">1</span>) * (t + <span class="number">1</span>)) * Frac(res_ji, all);</span><br><span class="line">            res = res + posi;</span><br><span class="line">        &#125;</span><br><span class="line">        res.a = res.b - res.a;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld/%lld\n"</span>, res.a, res.b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">潘曲阳 朱霖淇 刘浩钊</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">潘曲阳 朱霖淇 刘浩钊</span>

  
</div>

<!--

  <div class="powered-by">Powered by <a>HAHA  </a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>

-->



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  


  

  <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
  <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
  <script async src="/js/cursor/explosion.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
